var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,b,d,h){if(b){d=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var l=a[h];l in d||(d[l]={});d=d[l]}a=a[a.length-1];h=d[a];b=b(h);b!=h&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,d,h){var b=this.length||0;0>d&&(d=Math.max(0,b+d));if(null==h||h>b)h=b;h=Number(h);0>h&&(h=Math.max(0,b+h));for(d=Number(d||0);d<h;d++)this[d]=a;return this}},"es6-impl","es3");
var Vector4=function(a,b,d,h){this.x=a;this.y=b;this.z=d;this.w=h};Vector4.prototype.toArray=function(){var a=Array(4);a[0]=this.x;a[1]=this.y;a[2]=this.z;a[3]=this.w;return a};Vector4.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this};Vector4.prototype.set=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};Vector4.prototype.cpy=function(){return new Vector4(this.x,this.y,this.z,this.w)};
Vector4.prototype.len=function(){var a=this.x,b=this.y,d=this.z;return Math.sqrt(a*a+b*b+d*d)};Vector4.prototype.max=function(){return Math.max(this.x,Math.max(this.y,this.z))};Vector4.prototype.min=function(){return Math.min(this.x,Math.min(this.y,this.z))};Vector4.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w=0;return this};Vector4.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w=0;return this};
Vector4.prototype.addScl=function(a){this.x+=a;this.y+=a;this.z+=a;this.w=0;return this};Vector4.prototype.subScl=function(a){this.x-=a;this.y-=a;this.z-=a;this.w=0;return this};Vector4.prototype.mul=function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;this.w=0;return this};Vector4.prototype.mulScl=function(a){this.x*=a;this.y*=a;this.z*=a;this.w=0;return this};Vector4.prototype.div=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;this.w=0;return this};
Vector4.prototype.divScl=function(a){this.x/=a;this.y/=a;this.z/=a;this.w=0;return this};Vector4.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};Vector4.prototype.cross=function(a){var b=this.x,d=this.y,h=this.z,l=a.x,m=a.y;a=a.z;this.x=d*a-h*m;this.y=h*l-b*a;this.z=b*m-d*l;this.w=0;return this};Vector4.prototype.ang=function(a){var b=this.dot(a),d=this.len();a=a.len();return 0===d*a?0:Math.acos(b/(d*a))};
Vector4.prototype.nor=function(){var a=this.len();0<a&&(this.x/=a,this.y/=a,this.z/=a,this.w/=a);return this};Vector4.prototype.dst=function(a){var b=a.x-this.x,d=a.y-this.y;a=a.z-this.z;return Math.sqrt(b*b+d*d+a*a)};Vector4.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z};Vector4.prototype.epsilonEquals=function(a,b){return Math.abs(this.x-a.x)<=b&&Math.abs(this.y-a.y)<=b&&Math.abs(this.z-a.z)<=b?!0:!1};var Vector3=function(a,b,d){Vector4.call(this,a,b,d,0)};
Vector3.prototype=new Vector4;Vector3.prototype.constructor=Vector3;var Vector2=function(a,b){Vector3.call(this,a,b,0)};Vector2.prototype=new Vector3;Vector2.prototype.constructor=Vector2;var Matrix4=function(a,b,d,h){this.data=Array(16);this.transposed=null;this.setRows(a,b,d,h)};Matrix4.prototype.cpy=function(){var a=Matrix4.zeros();a.data=this.data.slice();return a};Matrix4.prototype.getData=function(){return this.data};Matrix4.prototype.setData=function(a){this.data=a};
Matrix4.prototype.get=function(a,b){return this.data[a+4*b]};Matrix4.prototype.set=function(a,b,d){this.data[a+4*b]=d};Matrix4.prototype.setRows=function(a,b,d,h){var l=Array(4);l[0]=a.toArray();l[1]=b.toArray();l[2]=d.toArray();l[3]=h.toArray();for(a=0;4>a;a++)for(b=0;4>b;b++)this.set(a,b,l[a][b])};Matrix4.prototype.transpose=function(){if(null===this.transposed){this.transposed=Matrix4.zeros();for(var a=0;4>a;a++)for(var b=0;4>b;b++)this.transposed.set(b,a,this.get(a,b))}return this.transposed};
Matrix4.mulMM=function(a,b){for(var d=this.zeros(),h=0;4>h;h++)for(var l=0;4>l;l++)for(var m=0;4>m;m++)d.set(h,l,d.get(h,l)+a.get(h,m)*b.get(m,l));return d};Matrix4.mulMV=function(a,b){for(var d=b.toArray(),h=Array(4),l=0;4>l;l++)for(var m=h[l]=0;4>m;m++)h[l]+=a.get(l,m)*d[m];d=new Vector4(0,0,0,0);d.fromArray(h);return d};Matrix4.zeros=function(){return new Matrix4(new Vector4(0,0,0,0),new Vector4(0,0,0,0),new Vector4(0,0,0,0),new Vector4(0,0,0,0))};
Matrix4.identity=function(){return new Matrix4(new Vector4(1,0,0,0),new Vector4(0,1,0,0),new Vector4(0,0,1,0),new Vector4(0,0,0,1))};Matrix4.translation=function(a){return new Matrix4(new Vector4(1,0,0,a.x),new Vector4(0,1,0,a.y),new Vector4(0,0,1,a.z),new Vector4(0,0,0,1))};
Matrix4.rotation=function(a){var b=Matrix4.identity();0!==a.x?(a=Math.PI/180*a.x,b=new Matrix4(new Vector4(1,0,0,0),new Vector4(0,Math.cos(a),-Math.sin(a),0),new Vector4(0,Math.sin(a),Math.cos(a),0),new Vector4(0,0,0,1))):0!==a.y?(a=Math.PI/180*a.y,b=new Matrix4(new Vector4(Math.cos(a),0,Math.sin(a),0),new Vector4(0,1,0,0),new Vector4(-Math.sin(a),0,Math.cos(a),0),new Vector4(0,0,0,1))):0!==a.z&&(a=Math.PI/180*a.z,b=new Matrix4(new Vector4(Math.cos(a),-Math.sin(a),0,0),new Vector4(Math.sin(a),Math.cos(a),
0,0),new Vector4(0,0,1,0),new Vector4(0,0,0,1)));return b};Matrix4.scale=function(a){return new Matrix4(new Vector4(a.x,0,0,0),new Vector4(0,a.y,0,0),new Vector4(0,0,a.z,0),new Vector4(0,0,0,1))};Matrix4.ortho=function(a,b,d,h,l,m){return new Matrix4(new Vector4(2/(b-a),0,0,-((b+a)/(b-a))),new Vector4(0,2/(h-d),0,-((h+d)/(h-d))),new Vector4(0,0,-2/(m-l),-((m+l)/(m-l))),new Vector4(0,0,0,1))};
Matrix4.perspective=function(a,b,d,h){h=a*Math.tan(Math.PI/180*(h/2));var l=-h;d*=h;var m=-d;return new Matrix4(new Vector4(2*a/(d-m),0,(d+m)/(d-m),0),new Vector4(0,2*a/(h-l),(h+l)/(h-l),0),new Vector4(0,0,(b+a)/(b-a),0),new Vector4(0,0,-1,0))};Matrix4.prototype.print=function(){string="";for(var a=0;4>a;a++){for(var b=0;4>b;b++)string+=this.get(a,b)+" ";string+="\n"}console.log(string)};var GeometryUtil=function(){};
GeometryUtil.testRectanglePoint=function(a,b,d,h,l){return a.x-l<h.x&&a.y+l>h.y&&a.x+b+l>h.x&&a.y-d-l<h.y};GeometryUtil.testSphereSphere=function(a,b,d,h){return a.dst(b)<d+h};GeometryUtil.midPoint=function(a,b){return new Vector3((a.x+b.x)/2,(a.y+b.y)/2,(a.z+b.z)/2)};GeometryUtil.closestPointInSegment=function(a,b,d){var h=d.cpy().sub(b);if(0===h.x&&0===h.y&&0===h.z)return b;a=a.cpy().sub(b).dot(h)/h.dot(h);return 0>a?b:1<a?d:b.cpy().add(h.mulScl(a))};
GeometryUtil.sqDistanceToSegment=function(a,b,d){b=GeometryUtil.closestPointInSegment(a,b,d);a=a.cpy().sub(b);return a.dot(a)};GeometryUtil.distanceToSegment=function(a,b,d){return Math.sqrt(GeometryUtil.sqDistanceToSegment(a,b,d))};GeometryUtil.closestPointInSphere=function(a,b,d){a=a.cpy().sub(b).nor().mulScl(d);return b.cpy().add(a)};var Color=function(a,b,d,h){this.r=a;this.g=b;this.b=d;this.a=h};Color.NONE=new Color(0,0,0,0);Color.RED=new Color(1,0,0,1);Color.GREEN=new Color(0,1,0,1);
Color.BLUE=new Color(0,0,1,1);Color.random=function(){return new Color(Math.random(),Math.random(),Math.random(),1)};Color.prototype.toArray=function(){var a=Array(4);a[0]=this.r;a[1]=this.g;a[2]=this.b;a[3]=this.a;return a};Color.prototype.equals=function(a){return this.r===vec.r&&this.g===vec.g&&this.b===vec.b&&this.a===vec.a};var Texture=function(a,b){this.name=a;this.data=b};Texture.prototype.getData=function(){return this.data};Texture.prototype.getName=function(){return this.name};
Texture.prototype.getWidth=function(){return this.data.width};Texture.prototype.getHeight=function(){return this.data.height};var RenderContext=function(){this.camera=null};RenderContext.prototype.getCamera=function(){return this.camera};RenderContext.prototype.setCamera=function(a){this.camera=a};var Shader=function(){this.programID=gl.createProgram();this.fragShaderID=this.vertShaderID=0;this.compiled=!1};Shader.defaultShader=null;Shader.debugShader=null;Shader.vs="uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;attribute vec4 position;attribute vec4 color; attribute vec2 texcoord;varying lowp vec4 vColor;varying vec2 vTexcoord;void main() {  gl_Position = projectionMatrix*viewMatrix*modelMatrix*position;  vTexcoord = texcoord;  vColor = color;}";
Shader.fs="precision mediump float;varying vec2 vTexcoord;varying lowp vec4 vColor;varying lowp vec4 vAlphaColor;uniform int hasTexture;uniform sampler2D uSampler;uniform vec4 alphacolor;uniform float regionX;uniform float regionY;uniform float regionWidth;uniform float regionHeight;uniform float animationX;uniform float animationY;uniform float animationWidth;uniform float animationHeight;void main() {    if(hasTexture == 1){        vec2 aux_texcoord = vTexcoord;        aux_texcoord.x = aux_texcoord.x*regionWidth + regionX;        aux_texcoord.y = aux_texcoord.y*regionHeight + regionY;        aux_texcoord.x = aux_texcoord.x*animationWidth + animationX;        aux_texcoord.y = aux_texcoord.y*animationHeight + animationY;        vec4 texColor = texture2D(uSampler, aux_texcoord);        gl_FragColor = texColor + vColor;    }else{        gl_FragColor = vColor;    }    if(gl_FragColor.r == alphacolor.r && gl_FragColor.g == alphacolor.g && gl_FragColor.b == alphacolor.b && gl_FragColor.a == alphacolor.a){        gl_FragColor.a = 0.0;    }}";
Shader.vsDebug="uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;attribute vec4 position;attribute vec4 color;varying lowp vec4 vColor;void main() {    gl_Position = projectionMatrix*viewMatrix*modelMatrix*position;    vColor = color;}";Shader.fsDebug="precision mediump float;varying lowp vec4 vColor;void main() {    gl_FragColor = vColor;}";Shader.prototype.isCompiled=function(){return this.compiled};Shader.prototype.getProgramid=function(){return this.programID};
Shader.prototype.addVertexShader=function(a){var b=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(b,a);this.vertShaderID=b};Shader.prototype.addFragmentShader=function(a){var b=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(b,a);this.fragShaderID=b};Shader.prototype.addAttribute=function(a,b){gl.bindAttribLocation(this.programID,a,b)};Shader.prototype.addMatrix=function(a,b){matrixLocation=gl.getUniformLocation(this.programID,b);gl.uniformMatrix4fv(matrixLocation,!1,new Float32Array(a.getData()))};
Shader.prototype.addMatrixArray=function(a,b){matrixLocation=gl.getUniformLocation(this.programID,b);for(var d=[],h=$jscomp.makeIterator(a),l=h.next();!l.done;l=h.next())d=d.concat(matrix.getData());gl.uniformMatrix4fv(matrixLocation,!1,new Float32Array(d))};Shader.prototype.addInt=function(a,b){valueLocation=gl.getUniformLocation(this.programID,b);gl.uniform1i(valueLocation,a)};
Shader.prototype.addFloat=function(a,b){valueLocation=gl.getUniformLocation(this.programID,b);gl.uniform1f(valueLocation,a)};Shader.prototype.addFloatVector=function(a,b){valueLocation=gl.getUniformLocation(this.programID,b);gl.uniform4fv(valueLocation,new Float32Array(a))};
Shader.prototype.compile=function(){this.isCompiled()||(gl.compileShader(this.fragShaderID),gl.getShaderParameter(this.fragShaderID,gl.COMPILE_STATUS),gl.getShaderInfoLog(this.fragShaderID),gl.compileShader(this.vertShaderID),gl.getShaderParameter(this.vertShaderID,gl.COMPILE_STATUS),gl.getShaderInfoLog(this.vertShaderID),gl.attachShader(this.programID,this.fragShaderID),gl.attachShader(this.programID,this.vertShaderID),gl.linkProgram(this.programID),this.compiled=!0)};Shader.prototype.enable=function(){gl.useProgram(this.programID)};
Shader.prototype.disable=function(){gl.useProgram(null)};
Shader.create=function(a){var b=null;"default"===a?(null===Shader.defaultShader&&(Shader.defaultShader=new Shader,Shader.defaultShader.addVertexShader(Shader.vs),Shader.defaultShader.addFragmentShader(Shader.fs),Shader.defaultShader.addAttribute(0,"position"),Shader.defaultShader.addAttribute(2,"color"),Shader.defaultShader.addAttribute(1,"texcoord")),b=Shader.defaultShader):"debug"===a&&(null===Shader.debugShader&&(Shader.debugShader=new Shader,Shader.debugShader.addVertexShader(Shader.vsDebug),
Shader.debugShader.addFragmentShader(Shader.fsDebug),Shader.debugShader.addAttribute(0,"position"),Shader.debugShader.addAttribute(1,"color")),b=Shader.debugShader);return b};var Material=function(){this.shader=this.texture=null;this.color=Color.NONE};Material.prototype.getTexture=function(){return this.texture};Material.prototype.setTexture=function(a){this.texture=a};Material.prototype.getShader=function(){return this.shader};Material.prototype.setShader=function(a){this.shader=a};
Material.prototype.setColor=function(a){this.color=a};Material.prototype.getColor=function(){return this.color};Material.prototype.enable=function(){this.shader.enable();this.shader.addInt(0,"thereIsTexture");null!==this.texture&&(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,this.textureID),this.shader.addInt(1,"hasTexture"),this.shader.addInt(0,"uSampler"),this.reset())};Material.prototype.disable=function(){gl.bindTexture(gl.TEXTURE_2D,null);this.shader.disable()};
Material.prototype.reset=function(){this.shader.addFloat(0,"animationX");this.shader.addFloat(0,"animationY");this.shader.addFloat(1,"animationWidth");this.shader.addFloat(1,"animationHeight");this.shader.addFloat(0,"regionX");this.shader.addFloat(0,"regionY");this.shader.addFloat(1,"regionWidth");this.shader.addFloat(1,"regionHeight")};
Material.prototype.bind=function(){this.shader=Shader.create("default");this.shader.compile();null!==this.texture&&(this.textureID=gl.createTexture(),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,this.textureID),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this.texture.getData()),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null))};var Animation=function(){this.frames=[];this.currentFrame=0;this.speed=1;this.lastTime=0};
Animation.create=function(a,b,d,h,l,m,w){var p=new Animation;p.setSpeed(w);var u=w=0;b?w=1:u=1;d&&(w*=-1,u*=-1);var J=0;b=a;var F=1;d&&(J=a-1,b=0,F=-1);for(a=J;a!==b;a+=F)d=new Vector2(0,0),d.add(h),0!==w&&(d.x+=a*l),0!==u&&(d.y+=a*m),J=new AnimationFrame,J.set(d,l,m),p.addFrame(J);return p};Animation.prototype.setSpeed=function(a){this.speed=a};Animation.prototype.addFrame=function(a){this.frames.push(a)};Animation.prototype.getNumberOfFrames=function(){return this.frames.length};
Animation.prototype.getCurrentFrameNumber=function(){return this.currentFrame};Animation.prototype.getNextFrame=function(){var a=1/this.speed,b=Time.now();b-this.lastTime>=a&&(this.lastTime=b,this.currentFrame=(this.currentFrame+1)%this.frames.length);return this.frames[this.currentFrame]};var AnimationFrame=function(){this.position=new Vector2(0,0);this.height=this.width=1};AnimationFrame.prototype.set=function(a,b,d){this.position=a;this.width=b;this.height=d};
AnimationFrame.prototype.getPosition=function(){return this.position};AnimationFrame.prototype.getWidth=function(){return this.width};AnimationFrame.prototype.getHeight=function(){return this.height};var Mesh=function(a){this.numVertices=a;this.vertices=[];this.normals=[];this.faces=[];this.texCoord=[];this.txIndex=this.fIndex=this.nIndex=this.vIndex=0;this.max=new Vector3(0,0,0)};
Mesh.prototype.addVertex=function(a){this.vertices[this.vIndex]=a.x;this.vIndex++;this.vertices[this.vIndex]=a.y;this.vIndex++;this.vertices[this.vIndex]=a.z;this.vIndex++;this.vertices[this.vIndex]=a.w;this.vIndex++;var b=2*Math.abs(a.x),d=2*Math.abs(a.y);a=2*Math.abs(a.z);b>this.max.x&&(this.max.x=b);d>this.max.y&&(this.max.y=d);a>this.max.z&&(this.max.z=a)};
Mesh.prototype.addNormal=function(a){this.normals[this.nIndex]=a.x;this.nIndex++;this.normals[this.nIndex]=a.y;this.nIndex++;this.normals[this.nIndex]=a.z;this.nIndex++;this.normals[this.nIndex]=a.w;this.nIndex++};Mesh.prototype.addFace=function(a,b,d){this.faces[this.fIndex]=a;this.fIndex++;this.faces[this.fIndex]=b;this.fIndex++;this.faces[this.fIndex]=d;this.fIndex++};Mesh.prototype.addTexCoord=function(a,b){this.texCoord[this.txIndex]=a;this.txIndex++;this.texCoord[this.txIndex]=b;this.txIndex++};
Mesh.prototype.getVertex=function(a){return new Vector4(this.vertices[4*a],this.vertices[4*a+1],this.vertices[4*a+2],this.vertices[4*a+3])};Mesh.prototype.getNumVertices=function(){return this.vertices.length/4};Mesh.prototype.getNumFaces=function(){return this.faces.length/3};Mesh.prototype.getVerticesData=function(){return this.vertices};Mesh.prototype.getNormalsData=function(){return this.normals};Mesh.prototype.getFacesData=function(){return this.faces};Mesh.prototype.getTexCoordData=function(){return this.texCoord};
Mesh.prototype.getMax=function(){return this.max.cpy()};
var RectangleMesh=function(){Mesh.call(this,4);this.height=this.width=1;var a=this.width/2,b=this.height/2;Mesh.prototype.addVertex.call(this,new Vector4(-a,-b,0,1));Mesh.prototype.addVertex.call(this,new Vector4(a,-b,0,1));Mesh.prototype.addVertex.call(this,new Vector4(a,b,0,1));Mesh.prototype.addVertex.call(this,new Vector4(-a,b,0,1));Mesh.prototype.addTexCoord.call(this,0,0);Mesh.prototype.addTexCoord.call(this,1,0);Mesh.prototype.addTexCoord.call(this,1,1);Mesh.prototype.addTexCoord.call(this,
0,1);Mesh.prototype.addFace.call(this,0,1,2);Mesh.prototype.addFace.call(this,2,3,0)};RectangleMesh.prototype=new Mesh;RectangleMesh.prototype.constructor=RectangleMesh;
var CubeMesh=function(){Mesh.call(this,24);Mesh.prototype.addVertex.call(this,new Vector4(-.5,-.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,-.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,-.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,.5,-.5,1));Mesh.prototype.addVertex.call(this,
new Vector4(.5,-.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,-.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,-.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,-.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,
-.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,-.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(.5,-.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,-.5,-.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,-.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,.5,.5,1));Mesh.prototype.addVertex.call(this,new Vector4(-.5,.5,-.5,1));
Mesh.prototype.addTexCoord.call(this,0,1);Mesh.prototype.addTexCoord.call(this,0,0);Mesh.prototype.addTexCoord.call(this,1,0);Mesh.prototype.addTexCoord.call(this,1,1);Mesh.prototype.addTexCoord.call(this,0,0);Mesh.prototype.addTexCoord.call(this,1,0);Mesh.prototype.addTexCoord.call(this,1,1);Mesh.prototype.addTexCoord.call(this,0,1);Mesh.prototype.addTexCoord.call(this,0,1);Mesh.prototype.addTexCoord.call(this,0,0);Mesh.prototype.addTexCoord.call(this,1,0);Mesh.prototype.addTexCoord.call(this,1,
1);Mesh.prototype.addTexCoord.call(this,1,1);Mesh.prototype.addTexCoord.call(this,0,1);Mesh.prototype.addTexCoord.call(this,0,0);Mesh.prototype.addTexCoord.call(this,1,0);Mesh.prototype.addTexCoord.call(this,1,0);Mesh.prototype.addTexCoord.call(this,1,1);Mesh.prototype.addTexCoord.call(this,0,1);Mesh.prototype.addTexCoord.call(this,0,0);Mesh.prototype.addTexCoord.call(this,0,0);Mesh.prototype.addTexCoord.call(this,1,0);Mesh.prototype.addTexCoord.call(this,1,1);Mesh.prototype.addTexCoord.call(this,
0,1);Mesh.prototype.addNormal.call(this,new Vector4(0,0,1,0));Mesh.prototype.addNormal.call(this,new Vector4(0,0,1,0));Mesh.prototype.addNormal.call(this,new Vector4(0,0,1,0));Mesh.prototype.addNormal.call(this,new Vector4(0,0,1,0));Mesh.prototype.addNormal.call(this,new Vector4(0,0,1,0));Mesh.prototype.addNormal.call(this,new Vector4(0,0,1,0));Mesh.prototype.addNormal.call(this,new Vector4(0,0,1,0));Mesh.prototype.addNormal.call(this,new Vector4(0,0,1,0));Mesh.prototype.addNormal.call(this,new Vector4(0,
1,0,0));Mesh.prototype.addNormal.call(this,new Vector4(0,1,0,0));Mesh.prototype.addNormal.call(this,new Vector4(0,1,0,0));Mesh.prototype.addNormal.call(this,new Vector4(0,1,0,0));Mesh.prototype.addNormal.call(this,new Vector4(0,1,0,0));Mesh.prototype.addNormal.call(this,new Vector4(0,1,0,0));Mesh.prototype.addNormal.call(this,new Vector4(0,1,0,0));Mesh.prototype.addNormal.call(this,new Vector4(0,1,0,0));Mesh.prototype.addNormal.call(this,new Vector4(1,0,0,0));Mesh.prototype.addNormal.call(this,new Vector4(1,
0,0,0));Mesh.prototype.addNormal.call(this,new Vector4(1,0,0,0));Mesh.prototype.addNormal.call(this,new Vector4(1,0,0,0));Mesh.prototype.addNormal.call(this,new Vector4(1,0,0,0));Mesh.prototype.addNormal.call(this,new Vector4(1,0,0,0));Mesh.prototype.addNormal.call(this,new Vector4(1,0,0,0));Mesh.prototype.addNormal.call(this,new Vector4(1,0,0,0));Mesh.prototype.addFace.call(this,0,1,2);Mesh.prototype.addFace.call(this,0,2,3);Mesh.prototype.addFace.call(this,4,5,6);Mesh.prototype.addFace.call(this,
4,6,7);Mesh.prototype.addFace.call(this,8,9,10);Mesh.prototype.addFace.call(this,8,10,11);Mesh.prototype.addFace.call(this,12,13,14);Mesh.prototype.addFace.call(this,12,14,15);Mesh.prototype.addFace.call(this,16,17,18);Mesh.prototype.addFace.call(this,16,18,19);Mesh.prototype.addFace.call(this,20,21,22);Mesh.prototype.addFace.call(this,20,22,23)};CubeMesh.prototype=new Mesh;CubeMesh.prototype.constructor=CubeMesh;
var SpriteBatch=function(a){this.material=a;this.renderers={};this.renderContext=null;this.vboColor=0};SpriteBatch.mesh=new RectangleMesh;SpriteBatch.vboPosition=0;SpriteBatch.vboElemIndices=0;SpriteBatch.vboTexture=0;SpriteBatch.vboNormal=0;SpriteBatch.vao=0;SpriteBatch.binded=!1;SpriteBatch.prototype.add=function(a){a.getId()in this.renderers||(this.renderers[a.getId()]=a)};
SpriteBatch.prototype.bind=function(){this.material.bind();SpriteBatch.binded||(SpriteBatch.binded=!0,SpriteBatch.vao=vao_ext.createVertexArrayOES(),vao_ext.bindVertexArrayOES(SpriteBatch.vao),gl.enableVertexAttribArray(0),SpriteBatch.vboPosition=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,SpriteBatch.vboPosition),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(SpriteBatch.mesh.getVerticesData()),gl.STATIC_DRAW),gl.vertexAttribPointer(0,4,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(1),SpriteBatch.vboTexture=
gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,SpriteBatch.vboTexture),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(SpriteBatch.mesh.getTexCoordData()),gl.STATIC_DRAW),gl.vertexAttribPointer(1,2,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(3),SpriteBatch.vboNormal=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,SpriteBatch.vboNormal),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(SpriteBatch.mesh.getNormalsData()),gl.STATIC_DRAW),gl.vertexAttribPointer(3,4,gl.FLOAT,!1,0,0),SpriteBatch.vboElemIndices=
gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,SpriteBatch.vboElemIndices),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(SpriteBatch.mesh.getFacesData()),gl.STATIC_DRAW),vao_ext.bindVertexArrayOES(null));gl.enableVertexAttribArray(2);this.vboColor=gl.createBuffer()};
SpriteBatch.prototype.update=function(a){this.renderContext=a;this.material.enable();this.material.getShader().addMatrix(this.renderContext.getCamera().getProjectionMatrix(),"projectionMatrix");this.material.getShader().addMatrix(this.renderContext.getCamera().getViewMatrix(),"viewMatrix");this.material.disable()};
SpriteBatch.prototype.render=function(a){this.material.enable();vao_ext.bindVertexArrayOES(SpriteBatch.vao);gl.enableVertexAttribArray(0);gl.enableVertexAttribArray(1);gl.enableVertexAttribArray(3);var b=this.renderContext.getCamera(),d;for(d in this.renderers){var h=this.renderers[d];if(h.getLayer()===a&&h.isEnabled()&&!h.isDestroyed()&&b.getFrustum().testSphere(h.getGameObject().getTransform().getPosition(),h.getRadius())){gl.enableVertexAttribArray(2);gl.bindBuffer(gl.ARRAY_BUFFER,this.vboColor);
for(var l=[],m=0;m<SpriteBatch.mesh.getVerticesData().length/4;m++)l=l.concat(h.getMaterial().getColor().toArray());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(l),gl.STATIC_DRAW);gl.vertexAttribPointer(2,4,gl.FLOAT,!1,0,0);h.gameObject.getTransform().generateMatrix();this.material.getShader().addMatrix(h.gameObject.getTransform().getMatrix(),"modelMatrix");h.updateMaterial(this.material);gl.drawElements(gl.TRIANGLES,3*SpriteBatch.mesh.getNumFaces(),gl.UNSIGNED_SHORT,0);this.material.reset()}}gl.disableVertexAttribArray(0);
gl.disableVertexAttribArray(1);gl.disableVertexAttribArray(2);gl.disableVertexAttribArray(3);this.material.disable()};gl=null;
var RenderEngine=function(){this.color=new Color(0,0,0,1);this.numLayers=0;var a=document.getElementById("glcanvas"),b=window.devicePixelRatio||1,d=Math.floor(a.clientHeight*b);a.width=Math.floor(a.clientWidth*b);a.height=d;try{gl=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(h){alert("Unable to initialize WebGL. Your browser may not support it.")}gl||(alert("Unable to initialize WebGL. Your browser may not support it."),gl=null);vao_ext=gl.getExtension("OES_vertex_array_object");
instance_ext=gl.getExtension("ANGLE_instanced_arrays");vao_ext||alert("ERROR: Your browser does not support WebGL 'VAO' extension");instance_ext||alert("ERROR: Your browser does not support WebGL 'ANGLE Instanced Rendering' extension");gl&&(gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.clearColor(this.color.r,this.color.g,this.color.b,this.color.a),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.enable(gl.CULL_FACE),gl.cullFace(gl.BACK),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),
gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT));this.clear();DebugRenderer.init()};RenderEngine.prototype.clear=function(){this.textureBatches={};this.noTextureBatch=new SpriteBatch(new Material);this.renderContext=null};RenderEngine.prototype.setClearColor=function(a){this.color.r=a.r;this.color.g=a.g;this.color.b=a.b;this.color.a=a.a;gl.clearColor(this.color.r,this.color.g,this.color.b,this.color.a)};
RenderEngine.prototype.addRenderers=function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;this.numLayers=Math.max(this.numLayers,b.getLayer());var d=b.getMaterial().getTexture();null!==d?(d=d.getName(),d in this.textureBatches||(this.textureBatches[d]=new SpriteBatch(b.getMaterial())),this.textureBatches[d].add(b)):this.noTextureBatch.add(b)}};RenderEngine.prototype.getRenderContext=function(){return this.renderContext};
RenderEngine.prototype.setRenderContext=function(a){this.renderContext=a};RenderEngine.prototype.update=function(){this.renderContext.getCamera().getFrustum().build();for(var a in this.textureBatches)this.textureBatches[a].update(this.renderContext);this.noTextureBatch.update(this.renderContext);DebugRenderer.update(this.renderContext)};RenderEngine.prototype.bind=function(){for(var a in this.textureBatches)this.textureBatches[a].bind();this.noTextureBatch.bind()};
RenderEngine.prototype.render=function(){for(var a=0;a<=this.numLayers;a++){for(var b in this.textureBatches)this.textureBatches[b].render(a);this.noTextureBatch.render(a)}DebugRenderer.render();DebugRenderer.clear()};var DebugRenderer=function(){};DebugRenderer.shader=null;DebugRenderer.modelMatrix=Matrix4.identity();DebugRenderer.list=[];DebugRenderer.getRenderers=function(){return DebugRenderer.list};DebugRenderer.clear=function(){DebugRenderer.list=[]};
DebugRenderer.init=function(){DebugRenderer.shader=Shader.create("debug");DebugRenderer.shader.compile()};DebugRenderer.setTransformationMatrix=function(a){DebugRenderer.modelMatrix=null===a?Matrix4.identity():a};DebugRenderer.update=function(a){DebugRenderer.shader.enable();DebugRenderer.shader.addMatrix(a.getCamera().getProjectionMatrix(),"projectionMatrix");DebugRenderer.shader.addMatrix(a.getCamera().getViewMatrix(),"viewMatrix");DebugRenderer.shader.disable()};
DebugRenderer.render=function(){for(var a=$jscomp.makeIterator(this.list),b=a.next();!b.done;b=a.next())b=b.value,b.bind(),b.render()};DebugRenderer.drawLine=function(a,b,d){DebugRenderer.list.push(new LineRenderer(DebugRenderer.shader,a,b,d,this.modelMatrix.cpy()))};var BaseObject=function(){this.id=BaseObject.lastId;BaseObject.lastId++};BaseObject.lastId=0;BaseObject.prototype.getId=function(){return this.id};
var GameObject=function(){BaseObject.call(this);this.parent=null;this.children=[];this.components=[];this.scene=null;this["static"]=!1;this.transform=this.name=null};GameObject.prototype=new BaseObject;GameObject.prototype.constructor=GameObject;GameObject.prototype.getTransform=function(){return this.transform};GameObject.prototype.getName=function(){return this.name};GameObject.prototype.setName=function(a){this.name=a};GameObject.prototype.getParent=function(){return this.parent};
GameObject.prototype.setParent=function(a){this.parent=a};GameObject.prototype.setStatic=function(a){this["static"]=a};GameObject.prototype.isStatic=function(){return this["static"]};GameObject.prototype.getScene=function(){return this.scene};GameObject.prototype.setScene=function(a){this.scene=a};GameObject.prototype.getChildren=function(){return this.children};
GameObject.prototype.setChildren=function(a){for(var b=$jscomp.makeIterator(a),d=b.next();!d.done;d=b.next())d.value.setParent(this);this.children=a};GameObject.prototype.getComponents=function(){return this.components};GameObject.prototype.enable=function(){for(var a=$jscomp.makeIterator(this.components),b=a.next();!b.done;b=a.next())b.value.enable()};GameObject.prototype.disable=function(){for(var a=$jscomp.makeIterator(this.components),b=a.next();!b.done;b=a.next())b.value.disable()};
GameObject.prototype.addChild=function(a){a.setParent(this);this.children.push(a)};GameObject.prototype.addComponent=function(a){a instanceof Transform&&null===this.transform&&(this.transform=a);a.setGameObject(this);this.components.push(a)};GameObject.prototype.getAllComponents=function(a){var b=[];component=this.getComponent(a);null!==component&&b.push(component);for(var d=$jscomp.makeIterator(this.children),h=d.next();!h.done;h=d.next())b=b.concat(h.value.getAllComponents(a));return b};
GameObject.prototype.getComponent=function(a){for(var b=$jscomp.makeIterator(this.components),d=b.next();!d.done;d=b.next())if(d=d.value,d instanceof a)return d;return null};GameObject.prototype.getComponentsInChildren=function(a){for(var b=[],d=$jscomp.makeIterator(this.children),h=d.next();!h.done;h=d.next())b=b.concat(h.value.getAllComponents(a));return b};GameObject.prototype.destroyChildren=function(){for(var a=$jscomp.makeIterator(this.children),b=a.next();!b.done;b=a.next())b.value.destroy()};
GameObject.prototype.destroyAllComponents=function(){for(var a=$jscomp.makeIterator(this.components),b=a.next();!b.done;b=a.next())b.value.destroy()};GameObject.prototype.destroy=function(){this.disable();this.scene.deleteObject(this);this.destroyAllComponents();this.destroyChildren()};var Component=function(){BaseObject.call(this);this.gameObject=null;this.enabled=!0;this.destroyed=!1};Component.prototype=new BaseObject;Component.prototype.constructor=Component;
Component.prototype.getGameObject=function(){return this.gameObject};Component.prototype.setGameObject=function(a){this.gameObject=a};Component.prototype.enable=function(){this.enabled=!0};Component.prototype.disable=function(){this.enabled=!1};Component.prototype.isEnabled=function(){return this.enabled};Component.prototype.getParent=function(){var a=this.gameObject.getParent();return null!==a?a.getComponent(this.constructor):null};Component.prototype.getChildren=function(){return this.gameObject.getComponentsInChildren(this.constructor)};
Component.prototype.destroy=function(){this.destroyed=!0};Component.prototype.isDestroyed=function(){return this.destroyed};var Box2D={};
(function(a,b){function d(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(a,b,d){d.get instanceof Function&&a.__defineGetter__(b,d.get);d.set instanceof Function&&a.__defineSetter__(b,d.set)});a.inherit=function(a,b){d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a};a.generateCallback=function(a,b){return function(){b.apply(a,arguments)}};
a.NVector=function(a){a===b&&(a=0);for(var d=Array(a||0),h=0;h<a;++h)d[h]=0;return d};a.is=function(a,d){return null===a?!1:d instanceof Function&&a instanceof d||a.constructor.__implements!=b&&a.constructor.__implements[d]?!0:!1};a.parseUInt=function(a){return Math.abs(parseInt(a))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"===typeof Box2D&&(Box2D={});"undefined"===typeof Box2D.Collision&&(Box2D.Collision={});
"undefined"===typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={});"undefined"===typeof Box2D.Common&&(Box2D.Common={});"undefined"===typeof Box2D.Common.Math&&(Box2D.Common.Math={});"undefined"===typeof Box2D.Dynamics&&(Box2D.Dynamics={});"undefined"===typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={});"undefined"===typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={});"undefined"===typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={});
(function(){function a(){a.b2AABB.apply(this,arguments)}function b(){b.b2Bound.apply(this,arguments)}function d(){d.b2BoundValues.apply(this,arguments);this.constructor===d&&this.b2BoundValues.apply(this,arguments)}function h(){h.b2Collision.apply(this,arguments)}function l(){l.b2ContactID.apply(this,arguments);this.constructor===l&&this.b2ContactID.apply(this,arguments)}function m(){m.b2ContactPoint.apply(this,arguments)}function w(){w.b2Distance.apply(this,arguments)}function p(){p.b2DistanceInput.apply(this,
arguments)}function u(){u.b2DistanceOutput.apply(this,arguments)}function J(){J.b2DistanceProxy.apply(this,arguments)}function F(){F.b2DynamicTree.apply(this,arguments);this.constructor===F&&this.b2DynamicTree.apply(this,arguments)}function x(){x.b2DynamicTreeBroadPhase.apply(this,arguments)}function z(){z.b2DynamicTreeNode.apply(this,arguments)}function v(){v.b2DynamicTreePair.apply(this,arguments)}function O(){O.b2Manifold.apply(this,arguments);this.constructor===O&&this.b2Manifold.apply(this,arguments)}
function P(){P.b2ManifoldPoint.apply(this,arguments);this.constructor===P&&this.b2ManifoldPoint.apply(this,arguments)}function e(){e.b2Point.apply(this,arguments)}function L(){L.b2RayCastInput.apply(this,arguments);this.constructor===L&&this.b2RayCastInput.apply(this,arguments)}function B(){B.b2RayCastOutput.apply(this,arguments)}function N(){N.b2Segment.apply(this,arguments)}function E(){E.b2SeparationFunction.apply(this,arguments)}function K(){K.b2Simplex.apply(this,arguments);this.constructor===
K&&this.b2Simplex.apply(this,arguments)}function C(){C.b2SimplexCache.apply(this,arguments)}function R(){R.b2SimplexVertex.apply(this,arguments)}function G(){G.b2TimeOfImpact.apply(this,arguments)}function I(){I.b2TOIInput.apply(this,arguments)}function S(){S.b2WorldManifold.apply(this,arguments);this.constructor===S&&this.b2WorldManifold.apply(this,arguments)}function M(){M.ClipVertex.apply(this,arguments)}function f(){f.Features.apply(this,arguments)}function k(){k.b2CircleShape.apply(this,arguments);
this.constructor===k&&this.b2CircleShape.apply(this,arguments)}function t(){t.b2EdgeChainDef.apply(this,arguments);this.constructor===t&&this.b2EdgeChainDef.apply(this,arguments)}function q(){q.b2EdgeShape.apply(this,arguments);this.constructor===q&&this.b2EdgeShape.apply(this,arguments)}function D(){D.b2MassData.apply(this,arguments)}function Q(){Q.b2PolygonShape.apply(this,arguments);this.constructor===Q&&this.b2PolygonShape.apply(this,arguments)}function y(){y.b2Shape.apply(this,arguments);this.constructor===
y&&this.b2Shape.apply(this,arguments)}function c(){c.b2Color.apply(this,arguments);this.constructor===c&&this.b2Color.apply(this,arguments)}function g(){g.b2Settings.apply(this,arguments)}function r(){r.b2Mat22.apply(this,arguments);this.constructor===r&&this.b2Mat22.apply(this,arguments)}function n(){n.b2Mat33.apply(this,arguments);this.constructor===n&&this.b2Mat33.apply(this,arguments)}function A(){A.b2Math.apply(this,arguments)}function H(){H.b2Sweep.apply(this,arguments)}function T(){T.b2Transform.apply(this,
arguments);this.constructor===T&&this.b2Transform.apply(this,arguments)}function U(){U.b2Vec2.apply(this,arguments);this.constructor===U&&this.b2Vec2.apply(this,arguments)}function V(){V.b2Vec3.apply(this,arguments);this.constructor===V&&this.b2Vec3.apply(this,arguments)}function W(){W.b2Body.apply(this,arguments);this.constructor===W&&this.b2Body.apply(this,arguments)}function X(){X.b2BodyDef.apply(this,arguments);this.constructor===X&&this.b2BodyDef.apply(this,arguments)}function Ea(){Ea.b2ContactFilter.apply(this,
arguments)}function Fa(){Fa.b2ContactImpulse.apply(this,arguments)}function Ga(){Ga.b2ContactListener.apply(this,arguments)}function Y(){Y.b2ContactManager.apply(this,arguments);this.constructor===Y&&this.b2ContactManager.apply(this,arguments)}function Z(){Z.b2DebugDraw.apply(this,arguments);this.constructor===Z&&this.b2DebugDraw.apply(this,arguments)}function Ha(){Ha.b2DestructionListener.apply(this,arguments)}function Ia(){Ia.b2FilterData.apply(this,arguments)}function aa(){aa.b2Fixture.apply(this,
arguments);this.constructor===aa&&this.b2Fixture.apply(this,arguments)}function ba(){ba.b2FixtureDef.apply(this,arguments);this.constructor===ba&&this.b2FixtureDef.apply(this,arguments)}function ca(){ca.b2Island.apply(this,arguments);this.constructor===ca&&this.b2Island.apply(this,arguments)}function Ja(){Ja.b2TimeStep.apply(this,arguments)}function da(){da.b2World.apply(this,arguments);this.constructor===da&&this.b2World.apply(this,arguments)}function Ka(){Ka.b2CircleContact.apply(this,arguments)}
function ea(){ea.b2Contact.apply(this,arguments);this.constructor===ea&&this.b2Contact.apply(this,arguments)}function fa(){fa.b2ContactConstraint.apply(this,arguments);this.constructor===fa&&this.b2ContactConstraint.apply(this,arguments)}function La(){La.b2ContactConstraintPoint.apply(this,arguments)}function Ma(){Ma.b2ContactEdge.apply(this,arguments)}function ga(){ga.b2ContactFactory.apply(this,arguments);this.constructor===ga&&this.b2ContactFactory.apply(this,arguments)}function Na(){Na.b2ContactRegister.apply(this,
arguments)}function Oa(){Oa.b2ContactResult.apply(this,arguments)}function ha(){ha.b2ContactSolver.apply(this,arguments);this.constructor===ha&&this.b2ContactSolver.apply(this,arguments)}function Pa(){Pa.b2EdgeAndCircleContact.apply(this,arguments)}function ia(){ia.b2NullContact.apply(this,arguments);this.constructor===ia&&this.b2NullContact.apply(this,arguments)}function Qa(){Qa.b2PolyAndCircleContact.apply(this,arguments)}function Ra(){Ra.b2PolyAndEdgeContact.apply(this,arguments)}function Sa(){Sa.b2PolygonContact.apply(this,
arguments)}function ja(){ja.b2PositionSolverManifold.apply(this,arguments);this.constructor===ja&&this.b2PositionSolverManifold.apply(this,arguments)}function Ta(){Ta.b2BuoyancyController.apply(this,arguments)}function Ua(){Ua.b2ConstantAccelController.apply(this,arguments)}function Va(){Va.b2ConstantForceController.apply(this,arguments)}function Wa(){Wa.b2Controller.apply(this,arguments)}function Xa(){Xa.b2ControllerEdge.apply(this,arguments)}function Ya(){Ya.b2GravityController.apply(this,arguments)}
function Za(){Za.b2TensorDampingController.apply(this,arguments)}function ka(){ka.b2DistanceJoint.apply(this,arguments);this.constructor===ka&&this.b2DistanceJoint.apply(this,arguments)}function la(){la.b2DistanceJointDef.apply(this,arguments);this.constructor===la&&this.b2DistanceJointDef.apply(this,arguments)}function ma(){ma.b2FrictionJoint.apply(this,arguments);this.constructor===ma&&this.b2FrictionJoint.apply(this,arguments)}function na(){na.b2FrictionJointDef.apply(this,arguments);this.constructor===
na&&this.b2FrictionJointDef.apply(this,arguments)}function oa(){oa.b2GearJoint.apply(this,arguments);this.constructor===oa&&this.b2GearJoint.apply(this,arguments)}function pa(){pa.b2GearJointDef.apply(this,arguments);this.constructor===pa&&this.b2GearJointDef.apply(this,arguments)}function $a(){$a.b2Jacobian.apply(this,arguments)}function qa(){qa.b2Joint.apply(this,arguments);this.constructor===qa&&this.b2Joint.apply(this,arguments)}function ra(){ra.b2JointDef.apply(this,arguments);this.constructor===
ra&&this.b2JointDef.apply(this,arguments)}function ab(){ab.b2JointEdge.apply(this,arguments)}function sa(){sa.b2LineJoint.apply(this,arguments);this.constructor===sa&&this.b2LineJoint.apply(this,arguments)}function ta(){ta.b2LineJointDef.apply(this,arguments);this.constructor===ta&&this.b2LineJointDef.apply(this,arguments)}function ua(){ua.b2MouseJoint.apply(this,arguments);this.constructor===ua&&this.b2MouseJoint.apply(this,arguments)}function va(){va.b2MouseJointDef.apply(this,arguments);this.constructor===
va&&this.b2MouseJointDef.apply(this,arguments)}function wa(){wa.b2PrismaticJoint.apply(this,arguments);this.constructor===wa&&this.b2PrismaticJoint.apply(this,arguments)}function xa(){xa.b2PrismaticJointDef.apply(this,arguments);this.constructor===xa&&this.b2PrismaticJointDef.apply(this,arguments)}function ya(){ya.b2PulleyJoint.apply(this,arguments);this.constructor===ya&&this.b2PulleyJoint.apply(this,arguments)}function za(){za.b2PulleyJointDef.apply(this,arguments);this.constructor===za&&this.b2PulleyJointDef.apply(this,
arguments)}function Aa(){Aa.b2RevoluteJoint.apply(this,arguments);this.constructor===Aa&&this.b2RevoluteJoint.apply(this,arguments)}function Ba(){Ba.b2RevoluteJointDef.apply(this,arguments);this.constructor===Ba&&this.b2RevoluteJointDef.apply(this,arguments)}function Ca(){Ca.b2WeldJoint.apply(this,arguments);this.constructor===Ca&&this.b2WeldJoint.apply(this,arguments)}function Da(){Da.b2WeldJointDef.apply(this,arguments);this.constructor===Da&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase=
"Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=a;Box2D.Collision.b2Bound=b;Box2D.Collision.b2BoundValues=d;Box2D.Collision.b2Collision=h;Box2D.Collision.b2ContactID=l;Box2D.Collision.b2ContactPoint=m;Box2D.Collision.b2Distance=w;Box2D.Collision.b2DistanceInput=p;Box2D.Collision.b2DistanceOutput=u;Box2D.Collision.b2DistanceProxy=J;Box2D.Collision.b2DynamicTree=F;Box2D.Collision.b2DynamicTreeBroadPhase=x;Box2D.Collision.b2DynamicTreeNode=z;Box2D.Collision.b2DynamicTreePair=v;Box2D.Collision.b2Manifold=
O;Box2D.Collision.b2ManifoldPoint=P;Box2D.Collision.b2Point=e;Box2D.Collision.b2RayCastInput=L;Box2D.Collision.b2RayCastOutput=B;Box2D.Collision.b2Segment=N;Box2D.Collision.b2SeparationFunction=E;Box2D.Collision.b2Simplex=K;Box2D.Collision.b2SimplexCache=C;Box2D.Collision.b2SimplexVertex=R;Box2D.Collision.b2TimeOfImpact=G;Box2D.Collision.b2TOIInput=I;Box2D.Collision.b2WorldManifold=S;Box2D.Collision.ClipVertex=M;Box2D.Collision.Features=f;Box2D.Collision.Shapes.b2CircleShape=k;Box2D.Collision.Shapes.b2EdgeChainDef=
t;Box2D.Collision.Shapes.b2EdgeShape=q;Box2D.Collision.Shapes.b2MassData=D;Box2D.Collision.Shapes.b2PolygonShape=Q;Box2D.Collision.Shapes.b2Shape=y;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=c;Box2D.Common.b2Settings=g;Box2D.Common.Math.b2Mat22=r;Box2D.Common.Math.b2Mat33=n;Box2D.Common.Math.b2Math=A;Box2D.Common.Math.b2Sweep=H;Box2D.Common.Math.b2Transform=T;Box2D.Common.Math.b2Vec2=U;Box2D.Common.Math.b2Vec3=V;Box2D.Dynamics.b2Body=W;Box2D.Dynamics.b2BodyDef=X;Box2D.Dynamics.b2ContactFilter=
Ea;Box2D.Dynamics.b2ContactImpulse=Fa;Box2D.Dynamics.b2ContactListener=Ga;Box2D.Dynamics.b2ContactManager=Y;Box2D.Dynamics.b2DebugDraw=Z;Box2D.Dynamics.b2DestructionListener=Ha;Box2D.Dynamics.b2FilterData=Ia;Box2D.Dynamics.b2Fixture=aa;Box2D.Dynamics.b2FixtureDef=ba;Box2D.Dynamics.b2Island=ca;Box2D.Dynamics.b2TimeStep=Ja;Box2D.Dynamics.b2World=da;Box2D.Dynamics.Contacts.b2CircleContact=Ka;Box2D.Dynamics.Contacts.b2Contact=ea;Box2D.Dynamics.Contacts.b2ContactConstraint=fa;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=
La;Box2D.Dynamics.Contacts.b2ContactEdge=Ma;Box2D.Dynamics.Contacts.b2ContactFactory=ga;Box2D.Dynamics.Contacts.b2ContactRegister=Na;Box2D.Dynamics.Contacts.b2ContactResult=Oa;Box2D.Dynamics.Contacts.b2ContactSolver=ha;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=Pa;Box2D.Dynamics.Contacts.b2NullContact=ia;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=Qa;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=Ra;Box2D.Dynamics.Contacts.b2PolygonContact=Sa;Box2D.Dynamics.Contacts.b2PositionSolverManifold=
ja;Box2D.Dynamics.Controllers.b2BuoyancyController=Ta;Box2D.Dynamics.Controllers.b2ConstantAccelController=Ua;Box2D.Dynamics.Controllers.b2ConstantForceController=Va;Box2D.Dynamics.Controllers.b2Controller=Wa;Box2D.Dynamics.Controllers.b2ControllerEdge=Xa;Box2D.Dynamics.Controllers.b2GravityController=Ya;Box2D.Dynamics.Controllers.b2TensorDampingController=Za;Box2D.Dynamics.Joints.b2DistanceJoint=ka;Box2D.Dynamics.Joints.b2DistanceJointDef=la;Box2D.Dynamics.Joints.b2FrictionJoint=ma;Box2D.Dynamics.Joints.b2FrictionJointDef=
na;Box2D.Dynamics.Joints.b2GearJoint=oa;Box2D.Dynamics.Joints.b2GearJointDef=pa;Box2D.Dynamics.Joints.b2Jacobian=$a;Box2D.Dynamics.Joints.b2Joint=qa;Box2D.Dynamics.Joints.b2JointDef=ra;Box2D.Dynamics.Joints.b2JointEdge=ab;Box2D.Dynamics.Joints.b2LineJoint=sa;Box2D.Dynamics.Joints.b2LineJointDef=ta;Box2D.Dynamics.Joints.b2MouseJoint=ua;Box2D.Dynamics.Joints.b2MouseJointDef=va;Box2D.Dynamics.Joints.b2PrismaticJoint=wa;Box2D.Dynamics.Joints.b2PrismaticJointDef=xa;Box2D.Dynamics.Joints.b2PulleyJoint=
ya;Box2D.Dynamics.Joints.b2PulleyJointDef=za;Box2D.Dynamics.Joints.b2RevoluteJoint=Aa;Box2D.Dynamics.Joints.b2RevoluteJointDef=Ba;Box2D.Dynamics.Joints.b2WeldJoint=Ca;Box2D.Dynamics.Joints.b2WeldJointDef=Da})();Box2D.postDefs=[];
(function(){var a=Box2D.Collision.Shapes.b2CircleShape,b=Box2D.Collision.Shapes.b2PolygonShape,d=Box2D.Collision.Shapes.b2Shape,h=Box2D.Common.b2Settings,l=Box2D.Common.Math.b2Math,m=Box2D.Common.Math.b2Sweep,w=Box2D.Common.Math.b2Transform,p=Box2D.Common.Math.b2Vec2,u=Box2D.Collision.b2AABB,J=Box2D.Collision.b2Bound,F=Box2D.Collision.b2BoundValues,x=Box2D.Collision.b2Collision,z=Box2D.Collision.b2ContactID,v=Box2D.Collision.b2ContactPoint,O=Box2D.Collision.b2Distance,P=Box2D.Collision.b2DistanceInput,
e=Box2D.Collision.b2DistanceOutput,L=Box2D.Collision.b2DistanceProxy,B=Box2D.Collision.b2DynamicTree,N=Box2D.Collision.b2DynamicTreeBroadPhase,E=Box2D.Collision.b2DynamicTreeNode,K=Box2D.Collision.b2DynamicTreePair,C=Box2D.Collision.b2Manifold,R=Box2D.Collision.b2ManifoldPoint,G=Box2D.Collision.b2Point,I=Box2D.Collision.b2RayCastInput,S=Box2D.Collision.b2RayCastOutput,M=Box2D.Collision.b2Segment,f=Box2D.Collision.b2SeparationFunction,k=Box2D.Collision.b2Simplex,t=Box2D.Collision.b2SimplexCache,q=
Box2D.Collision.b2SimplexVertex,D=Box2D.Collision.b2TimeOfImpact,Q=Box2D.Collision.b2TOIInput,y=Box2D.Collision.b2WorldManifold,c=Box2D.Collision.ClipVertex,g=Box2D.Collision.Features,r=Box2D.Collision.IBroadPhase;u.b2AABB=function(){this.lowerBound=new p;this.upperBound=new p};u.prototype.IsValid=function(){var c=this.upperBound.y-this.lowerBound.y;return 0<=this.upperBound.x-this.lowerBound.x&&0<=c&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};u.prototype.GetCenter=function(){return new p((this.lowerBound.x+
this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};u.prototype.GetExtents=function(){return new p((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};u.prototype.Contains=function(c){return this.lowerBound.x<=c.lowerBound.x&&this.lowerBound.y<=c.lowerBound.y&&c.upperBound.x<=this.upperBound.x&&c.upperBound.y<=this.upperBound.y};u.prototype.RayCast=function(c,a){var n=-Number.MAX_VALUE,g=Number.MAX_VALUE,f=a.p1.x,A=a.p1.y,k=a.p2.x-a.p1.x,q=a.p2.y-a.p1.y,b=
Math.abs(q),r=c.normal,t;if(Math.abs(k)<Number.MIN_VALUE){if(f<this.lowerBound.x||this.upperBound.x<f)return!1}else if(k=1/k,t=(this.lowerBound.x-f)*k,k*=this.upperBound.x-f,f=-1,t>k&&(f=t,t=k,k=f,f=1),t>n&&(r.x=f,r.y=0,n=t),g=Math.min(g,k),n>g)return!1;if(b<Number.MIN_VALUE){if(A<this.lowerBound.y||this.upperBound.y<A)return!1}else if(k=1/q,t=(this.lowerBound.y-A)*k,k*=this.upperBound.y-A,f=-1,t>k&&(f=t,t=k,k=f,f=1),t>n&&(r.y=f,r.x=0,n=t),g=Math.min(g,k),n>g)return!1;c.fraction=n;return!0};u.prototype.TestOverlap=
function(c){var a=c.lowerBound.y-this.upperBound.y,n=this.lowerBound.y-c.upperBound.y;return 0<c.lowerBound.x-this.upperBound.x||0<a||0<this.lowerBound.x-c.upperBound.x||0<n?!1:!0};u.Combine=function(c,a){var n=new u;n.Combine(c,a);return n};u.prototype.Combine=function(c,a){this.lowerBound.x=Math.min(c.lowerBound.x,a.lowerBound.x);this.lowerBound.y=Math.min(c.lowerBound.y,a.lowerBound.y);this.upperBound.x=Math.max(c.upperBound.x,a.upperBound.x);this.upperBound.y=Math.max(c.upperBound.y,a.upperBound.y)};
J.b2Bound=function(){};J.prototype.IsLower=function(){return 0==(this.value&1)};J.prototype.IsUpper=function(){return 1==(this.value&1)};J.prototype.Swap=function(c){var a=this.value,n=this.proxy,g=this.stabbingCount;this.value=c.value;this.proxy=c.proxy;this.stabbingCount=c.stabbingCount;c.value=a;c.proxy=n;c.stabbingCount=g};F.b2BoundValues=function(){};F.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;
this.upperValues[0]=0;this.upperValues[1]=0};x.b2Collision=function(){};x.ClipSegmentToLine=function(c,a,g,f){void 0===f&&(f=0);var n,A=0;n=a[0];var k=n.v;n=a[1];var q=n.v,b=g.x*k.x+g.y*k.y-f;n=g.x*q.x+g.y*q.y-f;0>=b&&c[A++].Set(a[0]);0>=n&&c[A++].Set(a[1]);0>b*n&&(g=b/(b-n),n=c[A],n=n.v,n.x=k.x+g*(q.x-k.x),n.y=k.y+g*(q.y-k.y),n=c[A],n.id=(0<b?a[0]:a[1]).id,++A);return A};x.EdgeSeparation=function(c,a,g,f,k){void 0===g&&(g=0);parseInt(c.m_vertexCount);var n=c.m_vertices;c=c.m_normals;var A=parseInt(f.m_vertexCount),
q=f.m_vertices,b,r;b=a.R;r=c[g];c=b.col1.x*r.x+b.col2.x*r.y;f=b.col1.y*r.x+b.col2.y*r.y;b=k.R;var H=b.col1.x*c+b.col1.y*f;b=b.col2.x*c+b.col2.y*f;for(var t=0,e=Number.MAX_VALUE,y=0;y<A;++y)r=q[y],r=r.x*H+r.y*b,r<e&&(e=r,t=y);r=n[g];b=a.R;g=a.position.x+(b.col1.x*r.x+b.col2.x*r.y);a=a.position.y+(b.col1.y*r.x+b.col2.y*r.y);r=q[t];b=k.R;n=k.position.x+(b.col1.x*r.x+b.col2.x*r.y);k=k.position.y+(b.col1.y*r.x+b.col2.y*r.y);return(n-g)*c+(k-a)*f};x.FindMaxSeparation=function(c,a,g,f,k){var n=parseInt(a.m_vertexCount),
A=a.m_normals,b,r;r=k.R;b=f.m_centroid;var q=k.position.x+(r.col1.x*b.x+r.col2.x*b.y),H=k.position.y+(r.col1.y*b.x+r.col2.y*b.y);r=g.R;b=a.m_centroid;q-=g.position.x+(r.col1.x*b.x+r.col2.x*b.y);H-=g.position.y+(r.col1.y*b.x+r.col2.y*b.y);r=q*g.R.col1.x+H*g.R.col1.y;for(var H=q*g.R.col2.x+H*g.R.col2.y,q=0,t=-Number.MAX_VALUE,e=0;e<n;++e)b=A[e],b=b.x*r+b.y*H,b>t&&(t=b,q=e);A=x.EdgeSeparation(a,g,q,f,k);b=parseInt(0<=q-1?q-1:n-1);r=x.EdgeSeparation(a,g,b,f,k);var H=parseInt(q+1<n?q+1:0),t=x.EdgeSeparation(a,
g,H,f,k),y;if(r>A&&r>t)y=-1,e=b,b=r;else if(t>A)y=1,e=H,b=t;else return c[0]=q,A;for(;;)if(q=-1==y?0<=e-1?e-1:n-1:e+1<n?e+1:0,A=x.EdgeSeparation(a,g,q,f,k),A>b)e=q,b=A;else break;c[0]=e;return b};x.FindIncidentEdge=function(c,a,g,f,k,b){void 0===f&&(f=0);parseInt(a.m_vertexCount);var n=a.m_normals,A=parseInt(k.m_vertexCount);a=k.m_vertices;k=k.m_normals;var r;r=g.R;g=n[f];var n=r.col1.x*g.x+r.col2.x*g.y,q=r.col1.y*g.x+r.col2.y*g.y;r=b.R;g=r.col1.x*n+r.col1.y*q;q=r.col2.x*n+r.col2.y*q;n=g;r=0;for(var t=
Number.MAX_VALUE,H=0;H<A;++H)g=k[H],g=n*g.x+q*g.y,g<t&&(t=g,r=H);k=parseInt(r);n=parseInt(k+1<A?k+1:0);A=c[0];g=a[k];r=b.R;A.v.x=b.position.x+(r.col1.x*g.x+r.col2.x*g.y);A.v.y=b.position.y+(r.col1.y*g.x+r.col2.y*g.y);A.id.features.referenceEdge=f;A.id.features.incidentEdge=k;A.id.features.incidentVertex=0;A=c[1];g=a[n];r=b.R;A.v.x=b.position.x+(r.col1.x*g.x+r.col2.x*g.y);A.v.y=b.position.y+(r.col1.y*g.x+r.col2.y*g.y);A.id.features.referenceEdge=f;A.id.features.incidentEdge=n;A.id.features.incidentVertex=
1};x.MakeClipPointVector=function(){var a=new Vector(2);a[0]=new c;a[1]=new c;return a};x.CollidePolygons=function(c,a,g,f,k){var n;c.m_pointCount=0;var b=a.m_radius+f.m_radius;x.s_edgeAO[0]=0;var r=x.FindMaxSeparation(x.s_edgeAO,a,g,f,k);n=x.s_edgeAO[0];if(!(r>b)){var A;x.s_edgeBO[0]=0;var q=x.FindMaxSeparation(x.s_edgeBO,f,k,a,g);A=x.s_edgeBO[0];if(!(q>b)){var t,H;q>.98*r+.001?(r=f,f=a,a=k,t=A,c.m_type=C.e_faceB,H=1):(r=a,a=g,g=k,t=n,c.m_type=C.e_faceA,H=0);n=x.s_incidentEdge;x.FindIncidentEdge(n,
r,a,t,f,g);A=parseInt(r.m_vertexCount);k=r.m_vertices;var r=k[t],e;e=t+1<A?k[parseInt(t+1)]:k[0];t=x.s_localTangent;t.Set(e.x-r.x,e.y-r.y);t.Normalize();k=x.s_localNormal;k.x=t.y;k.y=-t.x;f=x.s_planePoint;f.Set(.5*(r.x+e.x),.5*(r.y+e.y));q=x.s_tangent;A=a.R;q.x=A.col1.x*t.x+A.col2.x*t.y;q.y=A.col1.y*t.x+A.col2.y*t.y;var y=x.s_tangent2;y.x=-q.x;y.y=-q.y;t=x.s_normal;t.x=q.y;t.y=-q.x;var D=x.s_v11,p=x.s_v12;D.x=a.position.x+(A.col1.x*r.x+A.col2.x*r.y);D.y=a.position.y+(A.col1.y*r.x+A.col2.y*r.y);p.x=
a.position.x+(A.col1.x*e.x+A.col2.x*e.y);p.y=a.position.y+(A.col1.y*e.x+A.col2.y*e.y);a=t.x*D.x+t.y*D.y;A=q.x*p.x+q.y*p.y+b;e=x.s_clipPoints1;r=x.s_clipPoints2;p=x.ClipSegmentToLine(e,n,y,-q.x*D.x-q.y*D.y+b);if(!(2>p||(p=x.ClipSegmentToLine(r,e,q,A),2>p))){c.m_localPlaneNormal.SetV(k);c.m_localPoint.SetV(f);for(f=k=0;f<h.b2_maxManifoldPoints;++f)n=r[f],t.x*n.v.x+t.y*n.v.y-a<=b&&(q=c.m_points[k],A=g.R,y=n.v.x-g.position.x,D=n.v.y-g.position.y,q.m_localPoint.x=y*A.col1.x+D*A.col1.y,q.m_localPoint.y=
y*A.col2.x+D*A.col2.y,q.m_id.Set(n.id),q.m_id.features.flip=H,++k);c.m_pointCount=k}}}};x.CollideCircles=function(c,a,g,f,k){c.m_pointCount=0;var n,r;n=g.R;r=a.m_p;var A=g.position.x+(n.col1.x*r.x+n.col2.x*r.y);g=g.position.y+(n.col1.y*r.x+n.col2.y*r.y);n=k.R;r=f.m_p;A=k.position.x+(n.col1.x*r.x+n.col2.x*r.y)-A;k=k.position.y+(n.col1.y*r.x+n.col2.y*r.y)-g;n=a.m_radius+f.m_radius;A*A+k*k>n*n||(c.m_type=C.e_circles,c.m_localPoint.SetV(a.m_p),c.m_localPlaneNormal.SetZero(),c.m_pointCount=1,c.m_points[0].m_localPoint.SetV(f.m_p),
c.m_points[0].m_id.key=0)};x.CollidePolygonAndCircle=function(c,a,g,f,k){var n;c.m_pointCount=0;var r,b,A;A=k.R;b=f.m_p;var q=k.position.y+(A.col1.y*b.x+A.col2.y*b.y);n=k.position.x+(A.col1.x*b.x+A.col2.x*b.y)-g.position.x;r=q-g.position.y;A=g.R;g=n*A.col1.x+r*A.col1.y;A=n*A.col2.x+r*A.col2.y;var t=0,q=-Number.MAX_VALUE;k=a.m_radius+f.m_radius;var e=parseInt(a.m_vertexCount),H=a.m_vertices;a=a.m_normals;for(var y=0;y<e;++y){b=H[y];n=g-b.x;r=A-b.y;b=a[y];n=b.x*n+b.y*r;if(n>k)return;n>q&&(q=n,t=y)}n=
parseInt(t);r=parseInt(n+1<e?n+1:0);b=H[n];H=H[r];if(q<Number.MIN_VALUE)c.m_pointCount=1,c.m_type=C.e_faceA,c.m_localPlaneNormal.SetV(a[t]),c.m_localPoint.x=.5*(b.x+H.x),c.m_localPoint.y=.5*(b.y+H.y);else if(q=(g-H.x)*(b.x-H.x)+(A-H.y)*(b.y-H.y),0>=(g-b.x)*(H.x-b.x)+(A-b.y)*(H.y-b.y)){if((g-b.x)*(g-b.x)+(A-b.y)*(A-b.y)>k*k)return;c.m_pointCount=1;c.m_type=C.e_faceA;c.m_localPlaneNormal.x=g-b.x;c.m_localPlaneNormal.y=A-b.y;c.m_localPlaneNormal.Normalize();c.m_localPoint.SetV(b)}else if(0>=q){if((g-
H.x)*(g-H.x)+(A-H.y)*(A-H.y)>k*k)return;c.m_pointCount=1;c.m_type=C.e_faceA;c.m_localPlaneNormal.x=g-H.x;c.m_localPlaneNormal.y=A-H.y;c.m_localPlaneNormal.Normalize();c.m_localPoint.SetV(H)}else{t=.5*(b.x+H.x);b=.5*(b.y+H.y);q=(g-t)*a[n].x+(A-b)*a[n].y;if(q>k)return;c.m_pointCount=1;c.m_type=C.e_faceA;c.m_localPlaneNormal.x=a[n].x;c.m_localPlaneNormal.y=a[n].y;c.m_localPlaneNormal.Normalize();c.m_localPoint.Set(t,b)}c.m_points[0].m_localPoint.SetV(f.m_p);c.m_points[0].m_id.key=0};x.TestOverlap=function(c,
a){var n=a.lowerBound,g=c.upperBound,f=n.x-g.x,k=n.y-g.y,n=c.lowerBound,g=a.upperBound,b=n.y-g.y;return 0<f||0<k||0<n.x-g.x||0<b?!1:!0};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=x.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=x.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=x.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=
new p;Box2D.Collision.b2Collision.s_localNormal=new p;Box2D.Collision.b2Collision.s_planePoint=new p;Box2D.Collision.b2Collision.s_normal=new p;Box2D.Collision.b2Collision.s_tangent=new p;Box2D.Collision.b2Collision.s_tangent2=new p;Box2D.Collision.b2Collision.s_v11=new p;Box2D.Collision.b2Collision.s_v12=new p;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new p;Box2D.Collision.b2Collision.b2_nullFeature=255});z.b2ContactID=function(){this.features=new g};z.prototype.b2ContactID=function(){this.features._m_id=
this};z.prototype.Set=function(c){this.key=c._key};z.prototype.Copy=function(){var c=new z;c.key=this.key;return c};Object.defineProperty(z.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(z.prototype,"key",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._key=c;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=
(this._key&4278190080)>>24&255}});v.b2ContactPoint=function(){this.position=new p;this.velocity=new p;this.normal=new p;this.id=new z};O.b2Distance=function(){};O.Distance=function(c,a,g){++O.b2_gjkCalls;var n=g.proxyA,f=g.proxyB,k=g.transformA,b=g.transformB,r=O.s_simplex;r.ReadCache(a,n,k,f,b);var A=r.m_vertices,q=O.s_saveA,t=O.s_saveB,e;r.GetClosestPoint().LengthSquared();for(var H,y,D=0;20>D;){e=r.m_count;for(H=0;H<e;H++)q[H]=A[H].indexA,t[H]=A[H].indexB;switch(r.m_count){case 1:break;case 2:r.Solve2();
break;case 3:r.Solve3();break;default:h.b2Assert(!1)}if(3==r.m_count)break;y=r.GetClosestPoint();y.LengthSquared();H=r.GetSearchDirection();if(H.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;y=A[r.m_count];y.indexA=n.GetSupport(l.MulTMV(k.R,H.GetNegative()));y.wA=l.MulX(k,n.GetVertex(y.indexA));y.indexB=f.GetSupport(l.MulTMV(b.R,H));y.wB=l.MulX(b,f.GetVertex(y.indexB));y.w=l.SubtractVV(y.wB,y.wA);++D;++O.b2_gjkIters;var d=!1;for(H=0;H<e;H++)if(y.indexA==q[H]&&y.indexB==t[H]){d=!0;break}if(d)break;
++r.m_count}O.b2_gjkMaxIters=l.Max(O.b2_gjkMaxIters,D);r.GetWitnessPoints(c.pointA,c.pointB);c.distance=l.SubtractVV(c.pointA,c.pointB).Length();c.iterations=D;r.WriteCache(a);g.useRadii&&(a=n.m_radius,f=f.m_radius,c.distance>a+f&&c.distance>Number.MIN_VALUE?(c.distance-=a+f,g=l.SubtractVV(c.pointB,c.pointA),g.Normalize(),c.pointA.x+=a*g.x,c.pointA.y+=a*g.y,c.pointB.x-=f*g.x,c.pointB.y-=f*g.y):(y=new p,y.x=.5*(c.pointA.x+c.pointB.x),y.y=.5*(c.pointA.y+c.pointB.y),c.pointA.x=c.pointB.x=y.x,c.pointA.y=
c.pointB.y=y.y,c.distance=0))};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new k;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});P.b2DistanceInput=function(){};e.b2DistanceOutput=function(){this.pointA=new p;this.pointB=new p};L.b2DistanceProxy=function(){};L.prototype.Set=function(c){switch(c.GetType()){case d.e_circleShape:c=c instanceof a?c:null;this.m_vertices=new Vector(1,!0);this.m_vertices[0]=
c.m_p;this.m_count=1;this.m_radius=c.m_radius;break;case d.e_polygonShape:c=c instanceof b?c:null;this.m_vertices=c.m_vertices;this.m_count=c.m_vertexCount;this.m_radius=c.m_radius;break;default:h.b2Assert(!1)}};L.prototype.GetSupport=function(c){for(var a=0,n=this.m_vertices[0].x*c.x+this.m_vertices[0].y*c.y,g=1;g<this.m_count;++g){var f=this.m_vertices[g].x*c.x+this.m_vertices[g].y*c.y;f>n&&(a=g,n=f)}return a};L.prototype.GetSupportVertex=function(c){for(var a=0,g=this.m_vertices[0].x*c.x+this.m_vertices[0].y*
c.y,n=1;n<this.m_count;++n){var f=this.m_vertices[n].x*c.x+this.m_vertices[n].y*c.y;f>g&&(a=n,g=f)}return this.m_vertices[a]};L.prototype.GetVertexCount=function(){return this.m_count};L.prototype.GetVertex=function(c){void 0===c&&(c=0);h.b2Assert(0<=c&&c<this.m_count);return this.m_vertices[c]};B.b2DynamicTree=function(){};B.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};B.prototype.CreateProxy=function(c,a){var g=this.AllocateNode(),n=h.b2_aabbExtension,
f=h.b2_aabbExtension;g.aabb.lowerBound.x=c.lowerBound.x-n;g.aabb.lowerBound.y=c.lowerBound.y-f;g.aabb.upperBound.x=c.upperBound.x+n;g.aabb.upperBound.y=c.upperBound.y+f;g.userData=a;this.InsertLeaf(g);return g};B.prototype.DestroyProxy=function(c){this.RemoveLeaf(c);this.FreeNode(c)};B.prototype.MoveProxy=function(c,a,g){h.b2Assert(c.IsLeaf());if(c.aabb.Contains(a))return!1;this.RemoveLeaf(c);var n=h.b2_aabbExtension+h.b2_aabbMultiplier*(0<g.x?g.x:-g.x);g=h.b2_aabbExtension+h.b2_aabbMultiplier*(0<
g.y?g.y:-g.y);c.aabb.lowerBound.x=a.lowerBound.x-n;c.aabb.lowerBound.y=a.lowerBound.y-g;c.aabb.upperBound.x=a.upperBound.x+n;c.aabb.upperBound.y=a.upperBound.y+g;this.InsertLeaf(c);return!0};B.prototype.Rebalance=function(c){void 0===c&&(c=0);if(null!=this.m_root)for(var a=0;a<c;a++){for(var g=this.m_root,n=0;0==g.IsLeaf();)g=this.m_path>>n&1?g.child2:g.child1,n=n+1&31;++this.m_path;this.RemoveLeaf(g);this.InsertLeaf(g)}};B.prototype.GetFatAABB=function(c){return c.aabb};B.prototype.GetUserData=function(c){return c.userData};
B.prototype.Query=function(c,a){if(null!=this.m_root){var g=new Vector,n=0;for(g[n++]=this.m_root;0<n;){var f=g[--n];if(f.aabb.TestOverlap(a))if(f.IsLeaf()){if(!c(f))break}else g[n++]=f.child1,g[n++]=f.child2}}};B.prototype.RayCast=function(c,a){if(null!=this.m_root){var g=a.p1,n=a.p2,f=l.SubtractVV(g,n);f.Normalize();var f=l.CrossFV(1,f),k=l.AbsV(f),r=a.maxFraction,b=new u,q,A;q=g.x+r*(n.x-g.x);A=g.y+r*(n.y-g.y);b.lowerBound.x=Math.min(g.x,q);b.lowerBound.y=Math.min(g.y,A);b.upperBound.x=Math.max(g.x,
q);b.upperBound.y=Math.max(g.y,A);var t=new Vector,e=0;for(t[e++]=this.m_root;0<e;)if(r=t[--e],0!=r.aabb.TestOverlap(b)&&(q=r.aabb.GetCenter(),A=r.aabb.GetExtents(),!(0<Math.abs(f.x*(g.x-q.x)+f.y*(g.y-q.y))-k.x*A.x-k.y*A.y)))if(r.IsLeaf()){q=new I;q.p1=a.p1;q.p2=a.p2;q.maxFraction=a.maxFraction;r=c(q,r);if(0==r)break;0<r&&(q=g.x+r*(n.x-g.x),A=g.y+r*(n.y-g.y),b.lowerBound.x=Math.min(g.x,q),b.lowerBound.y=Math.min(g.y,A),b.upperBound.x=Math.max(g.x,q),b.upperBound.y=Math.max(g.y,A))}else t[e++]=r.child1,
t[e++]=r.child2}};B.prototype.AllocateNode=function(){if(this.m_freeList){var c=this.m_freeList;this.m_freeList=c.parent;c.parent=null;c.child1=null;c.child2=null;return c}return new E};B.prototype.FreeNode=function(c){c.parent=this.m_freeList;this.m_freeList=c};B.prototype.InsertLeaf=function(c){++this.m_insertionCount;if(null==this.m_root)this.m_root=c,this.m_root.parent=null;else{var a=c.aabb.GetCenter(),g=this.m_root;if(0==g.IsLeaf()){do var n=g.child1,g=g.child2,g=Math.abs((n.aabb.lowerBound.x+
n.aabb.upperBound.x)/2-a.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-a.y)<Math.abs((g.aabb.lowerBound.x+g.aabb.upperBound.x)/2-a.x)+Math.abs((g.aabb.lowerBound.y+g.aabb.upperBound.y)/2-a.y)?n:g;while(0==g.IsLeaf())}a=g.parent;n=this.AllocateNode();n.parent=a;n.userData=null;n.aabb.Combine(c.aabb,g.aabb);if(a){g.parent.child1==g?a.child1=n:a.child2=n;n.child1=g;n.child2=c;g.parent=n;c.parent=n;do{if(a.aabb.Contains(n.aabb))break;a.aabb.Combine(a.child1.aabb,a.child2.aabb);n=a;a=a.parent}while(a)}else n.child1=
g,n.child2=c,g.parent=n,this.m_root=c.parent=n}};B.prototype.RemoveLeaf=function(c){if(c==this.m_root)this.m_root=null;else{var a=c.parent,g=a.parent;c=a.child1==c?a.child2:a.child1;if(g)for(g.child1==a?g.child1=c:g.child2=c,c.parent=g,this.FreeNode(a);g;){a=g.aabb;g.aabb=u.Combine(g.child1.aabb,g.child2.aabb);if(a.Contains(g.aabb))break;g=g.parent}else this.m_root=c,c.parent=null,this.FreeNode(a)}};N.b2DynamicTreeBroadPhase=function(){this.m_tree=new B;this.m_moveBuffer=new Vector;this.m_pairBuffer=
new Vector;this.m_pairCount=0};N.prototype.CreateProxy=function(c,a){var g=this.m_tree.CreateProxy(c,a);++this.m_proxyCount;this.BufferMove(g);return g};N.prototype.DestroyProxy=function(c){this.UnBufferMove(c);--this.m_proxyCount;this.m_tree.DestroyProxy(c)};N.prototype.MoveProxy=function(c,a,g){this.m_tree.MoveProxy(c,a,g)&&this.BufferMove(c)};N.prototype.TestOverlap=function(c,a){var g=this.m_tree.GetFatAABB(c),n=this.m_tree.GetFatAABB(a);return g.TestOverlap(n)};N.prototype.GetUserData=function(c){return this.m_tree.GetUserData(c)};
N.prototype.GetFatAABB=function(c){return this.m_tree.GetFatAABB(c)};N.prototype.GetProxyCount=function(){return this.m_proxyCount};N.prototype.UpdatePairs=function(c){for(var a=this,g=a.m_pairCount=0,n,g=0;g<a.m_moveBuffer.length;++g){n=a.m_moveBuffer[g];var f=a.m_tree.GetFatAABB(n);a.m_tree.Query(function(c){if(c==n)return!0;a.m_pairCount==a.m_pairBuffer.length&&(a.m_pairBuffer[a.m_pairCount]=new K);var g=a.m_pairBuffer[a.m_pairCount];g.proxyA=c<n?c:n;g.proxyB=c>=n?c:n;++a.m_pairCount;return!0},
f)}for(g=a.m_moveBuffer.length=0;g<a.m_pairCount;){var f=a.m_pairBuffer[g],r=a.m_tree.GetUserData(f.proxyA),k=a.m_tree.GetUserData(f.proxyB);c(r,k);for(++g;g<a.m_pairCount;){r=a.m_pairBuffer[g];if(r.proxyA!=f.proxyA||r.proxyB!=f.proxyB)break;++g}}};N.prototype.Query=function(c,a){this.m_tree.Query(c,a)};N.prototype.RayCast=function(c,a){this.m_tree.RayCast(c,a)};N.prototype.Validate=function(){};N.prototype.Rebalance=function(c){void 0===c&&(c=0);this.m_tree.Rebalance(c)};N.prototype.BufferMove=function(c){this.m_moveBuffer[this.m_moveBuffer.length]=
c};N.prototype.UnBufferMove=function(c){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(c)),1)};N.prototype.ComparePairs=function(){return 0};N.__implements={};N.__implements[r]=!0;E.b2DynamicTreeNode=function(){this.aabb=new u};E.prototype.IsLeaf=function(){return null==this.child1};K.b2DynamicTreePair=function(){};C.b2Manifold=function(){this.m_pointCount=0};C.prototype.b2Manifold=function(){this.m_points=new Vector(h.b2_maxManifoldPoints);for(var c=0;c<h.b2_maxManifoldPoints;c++)this.m_points[c]=
new R;this.m_localPlaneNormal=new p;this.m_localPoint=new p};C.prototype.Reset=function(){for(var c=0;c<h.b2_maxManifoldPoints;c++)(this.m_points[c]instanceof R?this.m_points[c]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};C.prototype.Set=function(c){this.m_pointCount=c.m_pointCount;for(var a=0;a<h.b2_maxManifoldPoints;a++)(this.m_points[a]instanceof R?this.m_points[a]:null).Set(c.m_points[a]);this.m_localPlaneNormal.SetV(c.m_localPlaneNormal);
this.m_localPoint.SetV(c.m_localPoint);this.m_type=c.m_type};C.prototype.Copy=function(){var c=new C;c.Set(this);return c};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});R.b2ManifoldPoint=function(){this.m_localPoint=new p;this.m_id=new z};R.prototype.b2ManifoldPoint=function(){this.Reset()};R.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=
0};R.prototype.Set=function(c){this.m_localPoint.SetV(c.m_localPoint);this.m_normalImpulse=c.m_normalImpulse;this.m_tangentImpulse=c.m_tangentImpulse;this.m_id.Set(c.m_id)};G.b2Point=function(){this.p=new p};G.prototype.Support=function(){return this.p};G.prototype.GetFirstVertex=function(){return this.p};I.b2RayCastInput=function(){this.p1=new p;this.p2=new p};I.prototype.b2RayCastInput=function(c,a,g){void 0===c&&(c=null);void 0===a&&(a=null);void 0===g&&(g=1);c&&this.p1.SetV(c);a&&this.p2.SetV(a);
this.maxFraction=g};S.b2RayCastOutput=function(){this.normal=new p};M.b2Segment=function(){this.p1=new p;this.p2=new p};M.prototype.TestSegment=function(c,a,g,f){void 0===f&&(f=0);var n=g.p1,r=g.p2.x-n.x,k=g.p2.y-n.y;g=this.p2.y-this.p1.y;var b=-(this.p2.x-this.p1.x),q=100*Number.MIN_VALUE,t=-(r*g+k*b);if(t>q){var A=n.x-this.p1.x,e=n.y-this.p1.y,n=A*g+e*b;if(0<=n&&n<=f*t&&(f=-r*e+k*A,-q*t<=f&&f<=t*(1+q)))return f=Math.sqrt(g*g+b*b),c[0]=n/t,a.Set(g/f,b/f),!0}return!1};M.prototype.Extend=function(c){this.ExtendForward(c);
this.ExtendBackward(c)};M.prototype.ExtendForward=function(c){var a=this.p2.x-this.p1.x,g=this.p2.y-this.p1.y;c=Math.min(0<a?(c.upperBound.x-this.p1.x)/a:0>a?(c.lowerBound.x-this.p1.x)/a:Number.POSITIVE_INFINITY,0<g?(c.upperBound.y-this.p1.y)/g:0>g?(c.lowerBound.y-this.p1.y)/g:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+a*c;this.p2.y=this.p1.y+g*c};M.prototype.ExtendBackward=function(c){var a=-this.p2.x+this.p1.x,g=-this.p2.y+this.p1.y;c=Math.min(0<a?(c.upperBound.x-this.p2.x)/a:0>a?(c.lowerBound.x-
this.p2.x)/a:Number.POSITIVE_INFINITY,0<g?(c.upperBound.y-this.p2.y)/g:0>g?(c.lowerBound.y-this.p2.y)/g:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+a*c;this.p1.y=this.p2.y+g*c};f.b2SeparationFunction=function(){this.m_localPoint=new p;this.m_axis=new p};f.prototype.Initialize=function(c,a,g,r,k){this.m_proxyA=a;this.m_proxyB=r;var n=parseInt(c.count);h.b2Assert(0<n&&3>n);var b,q,t,A,e,y;1==n?(this.m_type=f.e_points,b=this.m_proxyA.GetVertex(c.indexA[0]),q=this.m_proxyB.GetVertex(c.indexB[0]),n=
b,c=g.R,a=g.position.x+(c.col1.x*n.x+c.col2.x*n.y),r=g.position.y+(c.col1.y*n.x+c.col2.y*n.y),n=q,c=k.R,t=k.position.x+(c.col1.x*n.x+c.col2.x*n.y),A=k.position.y+(c.col1.y*n.x+c.col2.y*n.y),this.m_axis.x=t-a,this.m_axis.y=A-r,this.m_axis.Normalize()):(c.indexB[0]==c.indexB[1]?(this.m_type=f.e_faceA,a=this.m_proxyA.GetVertex(c.indexA[0]),r=this.m_proxyA.GetVertex(c.indexA[1]),q=this.m_proxyB.GetVertex(c.indexB[0]),this.m_localPoint.x=.5*(a.x+r.x),this.m_localPoint.y=.5*(a.y+r.y),this.m_axis=l.CrossVF(l.SubtractVV(r,
a),1),this.m_axis.Normalize(),n=this.m_axis,c=g.R,e=c.col1.x*n.x+c.col2.x*n.y,y=c.col1.y*n.x+c.col2.y*n.y,n=this.m_localPoint,c=g.R,a=g.position.x+(c.col1.x*n.x+c.col2.x*n.y),r=g.position.y+(c.col1.y*n.x+c.col2.y*n.y),n=q,c=k.R,t=k.position.x+(c.col1.x*n.x+c.col2.x*n.y),A=k.position.y+(c.col1.y*n.x+c.col2.y*n.y),e=(t-a)*e+(A-r)*y):c.indexA[0]==c.indexA[0]?(this.m_type=f.e_faceB,t=this.m_proxyB.GetVertex(c.indexB[0]),A=this.m_proxyB.GetVertex(c.indexB[1]),b=this.m_proxyA.GetVertex(c.indexA[0]),this.m_localPoint.x=
.5*(t.x+A.x),this.m_localPoint.y=.5*(t.y+A.y),this.m_axis=l.CrossVF(l.SubtractVV(A,t),1),this.m_axis.Normalize(),n=this.m_axis,c=k.R,e=c.col1.x*n.x+c.col2.x*n.y,y=c.col1.y*n.x+c.col2.y*n.y,n=this.m_localPoint,c=k.R,t=k.position.x+(c.col1.x*n.x+c.col2.x*n.y),A=k.position.y+(c.col1.y*n.x+c.col2.y*n.y),n=b,c=g.R,a=g.position.x+(c.col1.x*n.x+c.col2.x*n.y),r=g.position.y+(c.col1.y*n.x+c.col2.y*n.y),e=(a-t)*e+(r-A)*y):(a=this.m_proxyA.GetVertex(c.indexA[0]),r=this.m_proxyA.GetVertex(c.indexA[1]),t=this.m_proxyB.GetVertex(c.indexB[0]),
A=this.m_proxyB.GetVertex(c.indexB[1]),l.MulX(g,b),b=l.MulMV(g.R,l.SubtractVV(r,a)),l.MulX(k,q),e=l.MulMV(k.R,l.SubtractVV(A,t)),k=b.x*b.x+b.y*b.y,q=e.x*e.x+e.y*e.y,c=l.SubtractVV(e,b),g=b.x*c.x+b.y*c.y,c=e.x*c.x+e.y*c.y,b=b.x*e.x+b.y*e.y,y=k*q-b*b,e=0,0!=y&&(e=l.Clamp((b*c-g*q)/y,0,1)),0>(b*e+c)/q&&(e=l.Clamp((b-g)/k,0,1)),b=new p,b.x=a.x+e*(r.x-a.x),b.y=a.y+e*(r.y-a.y),q=new p,q.x=t.x+e*(A.x-t.x),q.y=t.y+e*(A.y-t.y),0==e||1==e?(this.m_type=f.e_faceB,this.m_axis=l.CrossVF(l.SubtractVV(A,t),1),this.m_axis.Normalize(),
this.m_localPoint=q):(this.m_type=f.e_faceA,this.m_axis=l.CrossVF(l.SubtractVV(r,a),1),this.m_localPoint=b)),0>e&&this.m_axis.NegativeSelf())};f.prototype.Evaluate=function(c,a){var g,n,r;switch(this.m_type){case f.e_points:return g=l.MulTMV(c.R,this.m_axis),n=l.MulTMV(a.R,this.m_axis.GetNegative()),g=this.m_proxyA.GetSupportVertex(g),n=this.m_proxyB.GetSupportVertex(n),g=l.MulX(c,g),n=l.MulX(a,n),(n.x-g.x)*this.m_axis.x+(n.y-g.y)*this.m_axis.y;case f.e_faceA:return r=l.MulMV(c.R,this.m_axis),g=l.MulX(c,
this.m_localPoint),n=l.MulTMV(a.R,r.GetNegative()),n=this.m_proxyB.GetSupportVertex(n),n=l.MulX(a,n),(n.x-g.x)*r.x+(n.y-g.y)*r.y;case f.e_faceB:return r=l.MulMV(a.R,this.m_axis),n=l.MulX(a,this.m_localPoint),g=l.MulTMV(c.R,r.GetNegative()),g=this.m_proxyA.GetSupportVertex(g),g=l.MulX(c,g),(g.x-n.x)*r.x+(g.y-n.y)*r.y;default:return h.b2Assert(!1),0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=
4});k.b2Simplex=function(){this.m_v1=new q;this.m_v2=new q;this.m_v3=new q;this.m_vertices=new Vector(3)};k.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};k.prototype.ReadCache=function(c,a,g,f,r){h.b2Assert(0<=c.count&&3>=c.count);var n,b;this.m_count=c.count;for(var k=this.m_vertices,q=0;q<this.m_count;q++){var t=k[q];t.indexA=c.indexA[q];t.indexB=c.indexB[q];n=a.GetVertex(t.indexA);b=f.GetVertex(t.indexB);t.wA=l.MulX(g,n);
t.wB=l.MulX(r,b);t.w=l.SubtractVV(t.wB,t.wA);t.a=0}1<this.m_count&&(c=c.metric,n=this.GetMetric(),n<.5*c||2*c<n||n<Number.MIN_VALUE)&&(this.m_count=0);0==this.m_count&&(t=k[0],t.indexA=0,t.indexB=0,n=a.GetVertex(0),b=f.GetVertex(0),t.wA=l.MulX(g,n),t.wB=l.MulX(r,b),t.w=l.SubtractVV(t.wB,t.wA),this.m_count=1)};k.prototype.WriteCache=function(c){c.metric=this.GetMetric();c.count=Box2D.parseUInt(this.m_count);for(var a=this.m_vertices,g=0;g<this.m_count;g++)c.indexA[g]=Box2D.parseUInt(a[g].indexA),c.indexB[g]=
Box2D.parseUInt(a[g].indexB)};k.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var c=l.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<l.CrossVV(c,this.m_v1.w.GetNegative())?l.CrossFV(1,c):l.CrossVF(c,1);default:return h.b2Assert(!1),new p}};k.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return h.b2Assert(!1),new p;case 1:return this.m_v1.w;case 2:return new p(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*
this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return h.b2Assert(!1),new p}};k.prototype.GetWitnessPoints=function(c,a){switch(this.m_count){case 0:h.b2Assert(!1);break;case 1:c.SetV(this.m_v1.wA);a.SetV(this.m_v1.wB);break;case 2:c.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;c.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;a.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;a.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:a.x=c.x=this.m_v1.a*this.m_v1.wA.x+
this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;a.y=c.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:h.b2Assert(!1)}};k.prototype.GetMetric=function(){switch(this.m_count){case 0:return h.b2Assert(!1),0;case 1:return 0;case 2:return l.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return l.CrossVV(l.SubtractVV(this.m_v2.w,this.m_v1.w),l.SubtractVV(this.m_v3.w,this.m_v1.w));default:return h.b2Assert(!1),0}};k.prototype.Solve2=function(){var c=
this.m_v1.w,a=this.m_v2.w,g=l.SubtractVV(a,c),c=-(c.x*g.x+c.y*g.y);0>=c?this.m_count=this.m_v1.a=1:(a=a.x*g.x+a.y*g.y,0>=a?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(g=1/(a+c),this.m_v1.a=a*g,this.m_v2.a=c*g,this.m_count=2))};k.prototype.Solve3=function(){var c=this.m_v1.w,a=this.m_v2.w,g=this.m_v3.w,f=l.SubtractVV(a,c),r=l.Dot(c,f),b=l.Dot(a,f),r=-r,k=l.SubtractVV(g,c),q=l.Dot(c,k),t=l.Dot(g,k),q=-q,e=l.SubtractVV(g,a),y=l.Dot(a,e),e=l.Dot(g,e),y=-y,k=l.CrossVV(f,k),f=k*l.CrossVV(a,g),
g=k*l.CrossVV(g,c),c=k*l.CrossVV(c,a);0>=r&&0>=q?this.m_count=this.m_v1.a=1:0<b&&0<r&&0>=c?(t=1/(b+r),this.m_v1.a=b*t,this.m_v2.a=r*t,this.m_count=2):0<t&&0<q&&0>=g?(b=1/(t+q),this.m_v1.a=t*b,this.m_v3.a=q*b,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=b&&0>=y?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=t&&0>=e?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):0<e&&0<y&&0>=f?(b=1/(e+y),this.m_v2.a=e*b,this.m_v3.a=y*b,this.m_count=2,this.m_v1.Set(this.m_v3)):(b=1/(f+g+c),this.m_v1.a=
f*b,this.m_v2.a=g*b,this.m_v3.a=c*b,this.m_count=3)};t.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};q.b2SimplexVertex=function(){};q.prototype.Set=function(c){this.wA.SetV(c.wA);this.wB.SetV(c.wB);this.w.SetV(c.w);this.a=c.a;this.indexA=c.indexA;this.indexB=c.indexB};D.b2TimeOfImpact=function(){};D.TimeOfImpact=function(c){++D.b2_toiCalls;var a=c.proxyA,g=c.proxyB,f=c.sweepA,n=c.sweepB;h.b2Assert(f.t0==n.t0);h.b2Assert(1-f.t0>Number.MIN_VALUE);
var b=a.m_radius+g.m_radius;c=c.tolerance;var r=0,k=0,q=0;D.s_cache.count=0;for(D.s_distanceInput.useRadii=!1;;){f.GetTransform(D.s_xfA,r);n.GetTransform(D.s_xfB,r);D.s_distanceInput.proxyA=a;D.s_distanceInput.proxyB=g;D.s_distanceInput.transformA=D.s_xfA;D.s_distanceInput.transformB=D.s_xfB;O.Distance(D.s_distanceOutput,D.s_cache,D.s_distanceInput);if(0>=D.s_distanceOutput.distance){r=1;break}D.s_fcn.Initialize(D.s_cache,a,D.s_xfA,g,D.s_xfB);var t=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(0>=t){r=1;break}0==
k&&(q=t>b?l.Max(b-c,.75*b):l.Max(t-c,.02*b));if(t-q<.5*c){if(0==k){r=1;break}break}var e=r,y=r,p=1;f.GetTransform(D.s_xfA,p);n.GetTransform(D.s_xfB,p);var d=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(d>=q){r=1;break}for(var Q=0;;){var m;m=Q&1?y+(q-t)*(p-y)/(d-t):.5*(y+p);f.GetTransform(D.s_xfA,m);n.GetTransform(D.s_xfB,m);var B=D.s_fcn.Evaluate(D.s_xfA,D.s_xfB);if(l.Abs(B-q)<.025*c){e=m;break}B>q?(y=m,t=B):(p=m,d=B);++Q;++D.b2_toiRootIters;if(50==Q)break}D.b2_toiMaxRootIters=l.Max(D.b2_toiMaxRootIters,
Q);if(e<(1+100*Number.MIN_VALUE)*r)break;r=e;k++;++D.b2_toiIters;if(1E3==k)break}D.b2_toiMaxIters=l.Max(D.b2_toiMaxIters,k);return r};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new t;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new P;
Box2D.Collision.b2TimeOfImpact.s_xfA=new w;Box2D.Collision.b2TimeOfImpact.s_xfB=new w;Box2D.Collision.b2TimeOfImpact.s_fcn=new f;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new e});Q.b2TOIInput=function(){this.proxyA=new L;this.proxyB=new L;this.sweepA=new m;this.sweepB=new m};y.b2WorldManifold=function(){this.m_normal=new p};y.prototype.b2WorldManifold=function(){this.m_points=new Vector(h.b2_maxManifoldPoints);for(var c=0;c<h.b2_maxManifoldPoints;c++)this.m_points[c]=new p};y.prototype.Initialize=
function(c,a,g,f,r){void 0===g&&(g=0);void 0===r&&(r=0);if(0!=c.m_pointCount){var b,n,k,q,t,e,y,A;switch(c.m_type){case C.e_circles:k=a.R;n=c.m_localPoint;b=a.position.x+k.col1.x*n.x+k.col2.x*n.y;a=a.position.y+k.col1.y*n.x+k.col2.y*n.y;k=f.R;n=c.m_points[0].m_localPoint;c=f.position.x+k.col1.x*n.x+k.col2.x*n.y;f=f.position.y+k.col1.y*n.x+k.col2.y*n.y;n=c-b;k=f-a;q=n*n+k*k;q>Number.MIN_VALUE*Number.MIN_VALUE?(q=Math.sqrt(q),this.m_normal.x=n/q,this.m_normal.y=k/q):(this.m_normal.x=1,this.m_normal.y=
0);n=a+g*this.m_normal.y;f-=r*this.m_normal.y;this.m_points[0].x=.5*(b+g*this.m_normal.x+(c-r*this.m_normal.x));this.m_points[0].y=.5*(n+f);break;case C.e_faceA:k=a.R;n=c.m_localPlaneNormal;q=k.col1.x*n.x+k.col2.x*n.y;t=k.col1.y*n.x+k.col2.y*n.y;k=a.R;n=c.m_localPoint;e=a.position.x+k.col1.x*n.x+k.col2.x*n.y;y=a.position.y+k.col1.y*n.x+k.col2.y*n.y;this.m_normal.x=q;this.m_normal.y=t;for(b=0;b<c.m_pointCount;b++)k=f.R,n=c.m_points[b].m_localPoint,A=f.position.x+k.col1.x*n.x+k.col2.x*n.y,n=f.position.y+
k.col1.y*n.x+k.col2.y*n.y,this.m_points[b].x=A+.5*(g-(A-e)*q-(n-y)*t-r)*q,this.m_points[b].y=n+.5*(g-(A-e)*q-(n-y)*t-r)*t;break;case C.e_faceB:for(k=f.R,n=c.m_localPlaneNormal,q=k.col1.x*n.x+k.col2.x*n.y,t=k.col1.y*n.x+k.col2.y*n.y,k=f.R,n=c.m_localPoint,e=f.position.x+k.col1.x*n.x+k.col2.x*n.y,y=f.position.y+k.col1.y*n.x+k.col2.y*n.y,this.m_normal.x=-q,this.m_normal.y=-t,b=0;b<c.m_pointCount;b++)k=a.R,n=c.m_points[b].m_localPoint,A=a.position.x+k.col1.x*n.x+k.col2.x*n.y,n=a.position.y+k.col1.y*n.x+
k.col2.y*n.y,this.m_points[b].x=A+.5*(r-(A-e)*q-(n-y)*t-g)*q,this.m_points[b].y=n+.5*(r-(A-e)*q-(n-y)*t-g)*t}}};c.ClipVertex=function(){this.v=new p;this.id=new z};c.prototype.Set=function(c){this.v.SetV(c.v);this.id.Set(c.id)};g.Features=function(){};Object.defineProperty(g.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(g.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._referenceEdge=
c;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(g.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(g.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._incidentEdge=c;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(g.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});
Object.defineProperty(g.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._incidentVertex=c;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(g.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(g.prototype,"flip",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._flip=c;this._m_id._key=this._m_id._key&16777215|this._flip<<24&
4278190080}})})();
(function(){var a=Box2D.Common.b2Settings,b=Box2D.Collision.Shapes.b2CircleShape,d=Box2D.Collision.Shapes.b2EdgeChainDef,h=Box2D.Collision.Shapes.b2EdgeShape,l=Box2D.Collision.Shapes.b2MassData,m=Box2D.Collision.Shapes.b2PolygonShape,w=Box2D.Collision.Shapes.b2Shape,p=Box2D.Common.Math.b2Mat22,u=Box2D.Common.Math.b2Math,J=Box2D.Common.Math.b2Transform,F=Box2D.Common.Math.b2Vec2,x=Box2D.Collision.b2Distance,z=Box2D.Collision.b2DistanceInput,v=Box2D.Collision.b2DistanceOutput,O=Box2D.Collision.b2DistanceProxy,P=
Box2D.Collision.b2SimplexCache;Box2D.inherit(b,Box2D.Collision.Shapes.b2Shape);b.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;b.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new F};b.prototype.Copy=function(){var a=new b;a.Set(this);return a};b.prototype.Set=function(a){this.__super.Set.call(this,a);Box2D.is(a,b)&&this.m_p.SetV((a instanceof b?a:null).m_p)};b.prototype.TestPoint=function(a,b){var e=a.R,p=a.position.x+(e.col1.x*this.m_p.x+
e.col2.x*this.m_p.y),e=a.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),p=b.x-p,e=b.y-e;return p*p+e*e<=this.m_radius*this.m_radius};b.prototype.RayCast=function(a,b,p){var e=p.R,d=b.p1.x-(p.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y));p=b.p1.y-(p.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y));var e=b.p2.x-b.p1.x,h=b.p2.y-b.p1.y,l=d*e+p*h,m=e*e+h*h,B=l*l-m*(d*d+p*p-this.m_radius*this.m_radius);if(0>B||m<Number.MIN_VALUE)return!1;l=-(l+Math.sqrt(B));return 0<=l&&l<=b.maxFraction*
m?(l/=m,a.fraction=l,a.normal.x=d+l*e,a.normal.y=p+l*h,a.normal.Normalize(),!0):!1};b.prototype.ComputeAABB=function(a,b){var e=b.R,p=b.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),e=b.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y);a.lowerBound.Set(p-this.m_radius,e-this.m_radius);a.upperBound.Set(p+this.m_radius,e+this.m_radius)};b.prototype.ComputeMass=function(b,p){void 0===p&&(p=0);b.mass=p*a.b2_pi*this.m_radius*this.m_radius;b.center.SetV(this.m_p);b.I=b.mass*(.5*this.m_radius*
this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};b.prototype.ComputeSubmergedArea=function(a,b,p,d){void 0===b&&(b=0);p=u.MulX(p,this.m_p);var e=-(u.Dot(a,p)-b);if(e<-this.m_radius+Number.MIN_VALUE)return 0;if(e>this.m_radius)return d.SetV(p),Math.PI*this.m_radius*this.m_radius;b=this.m_radius*this.m_radius;var h=e*e,e=b*(Math.asin(e/this.m_radius)+Math.PI/2)+e*Math.sqrt(b-h);b=-2/3*Math.pow(b-h,1.5)/e;d.x=p.x+a.x*b;d.y=p.y+a.y*b;return e};b.prototype.GetLocalPosition=function(){return this.m_p};
b.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)};b.prototype.GetRadius=function(){return this.m_radius};b.prototype.SetRadius=function(a){void 0===a&&(a=0);this.m_radius=a};b.prototype.b2CircleShape=function(a){void 0===a&&(a=0);this.__super.b2Shape.call(this);this.m_type=w.e_circleShape;this.m_radius=a};d.b2EdgeChainDef=function(){};d.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.inherit(h,Box2D.Collision.Shapes.b2Shape);h.prototype.__super=
Box2D.Collision.Shapes.b2Shape.prototype;h.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new F;this.m_v1=new F;this.m_v2=new F;this.m_coreV1=new F;this.m_coreV2=new F;this.m_normal=new F;this.m_direction=new F;this.m_cornerDir1=new F;this.m_cornerDir2=new F};h.prototype.TestPoint=function(){return!1};h.prototype.RayCast=function(a,b,p){var e,d=b.p2.x-b.p1.x,h=b.p2.y-b.p1.y;e=p.R;var l=p.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),
m=p.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),u=p.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y)-m;p=-(p.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y)-l);e=100*Number.MIN_VALUE;var B=-(d*u+h*p);if(B>e){var l=b.p1.x-l,L=b.p1.y-m,m=l*u+L*p;if(0<=m&&m<=b.maxFraction*B&&(b=-d*L+h*l,-e*B<=b&&b<=B*(1+e)))return a.fraction=m/B,b=Math.sqrt(u*u+p*p),a.normal.x=u/b,a.normal.y=p/b,!0}return!1};h.prototype.ComputeAABB=function(a,b){var e=b.R,p=b.position.x+(e.col1.x*this.m_v1.x+
e.col2.x*this.m_v1.y),d=b.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),h=b.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y),e=b.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y);p<h?(a.lowerBound.x=p,a.upperBound.x=h):(a.lowerBound.x=h,a.upperBound.x=p);d<e?(a.lowerBound.y=d,a.upperBound.y=e):(a.lowerBound.y=e,a.upperBound.y=d)};h.prototype.ComputeMass=function(a){a.mass=0;a.center.SetV(this.m_v1);a.I=0};h.prototype.ComputeSubmergedArea=function(a,b,p,d){void 0===b&&(b=0);var e=
new F(a.x*b,a.y*b),h=u.MulX(p,this.m_v1);p=u.MulX(p,this.m_v2);var l=u.Dot(a,h)-b;a=u.Dot(a,p)-b;if(0<l){if(0<a)return 0;h.x=-a/(l-a)*h.x+l/(l-a)*p.x;h.y=-a/(l-a)*h.y+l/(l-a)*p.y}else 0<a&&(p.x=-a/(l-a)*h.x+l/(l-a)*p.x,p.y=-a/(l-a)*h.y+l/(l-a)*p.y);d.x=(e.x+h.x+p.x)/3;d.y=(e.y+h.y+p.y)/3;return.5*((h.x-e.x)*(p.y-e.y)-(h.y-e.y)*(p.x-e.x))};h.prototype.GetLength=function(){return this.m_length};h.prototype.GetVertex1=function(){return this.m_v1};h.prototype.GetVertex2=function(){return this.m_v2};h.prototype.GetCoreVertex1=
function(){return this.m_coreV1};h.prototype.GetCoreVertex2=function(){return this.m_coreV2};h.prototype.GetNormalVector=function(){return this.m_normal};h.prototype.GetDirectionVector=function(){return this.m_direction};h.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};h.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};h.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};h.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};h.prototype.GetFirstVertex=
function(a){var b=a.R;return new F(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))};h.prototype.GetNextEdge=function(){return this.m_nextEdge};h.prototype.GetPrevEdge=function(){return this.m_prevEdge};h.prototype.Support=function(a,b,p){void 0===b&&(b=0);void 0===p&&(p=0);var e=a.R,d=a.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),h=a.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y),
l=a.position.x+(e.col1.x*this.m_coreV2.x+e.col2.x*this.m_coreV2.y);a=a.position.y+(e.col1.y*this.m_coreV2.x+e.col2.y*this.m_coreV2.y);d*b+h*p>l*b+a*p?(this.s_supportVec.x=d,this.s_supportVec.y=h):(this.s_supportVec.x=l,this.s_supportVec.y=a);return this.s_supportVec};h.prototype.b2EdgeShape=function(b,p){this.__super.b2Shape.call(this);this.m_type=w.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=b;this.m_v2=p;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=
this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-a.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-a.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-a.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-a.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};h.prototype.SetPrevEdge=function(a,
b,p,d){this.m_prevEdge=a;this.m_coreV1=b;this.m_cornerDir1=p;this.m_cornerConvex1=d};h.prototype.SetNextEdge=function(a,b,p,d){this.m_nextEdge=a;this.m_coreV2=b;this.m_cornerDir2=p;this.m_cornerConvex2=d};l.b2MassData=function(){this.mass=0;this.center=new F(0,0);this.I=0};Box2D.inherit(m,Box2D.Collision.Shapes.b2Shape);m.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;m.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};m.prototype.Copy=function(){var a=
new m;a.Set(this);return a};m.prototype.Set=function(a){this.__super.Set.call(this,a);if(Box2D.is(a,m)){a=a instanceof m?a:null;this.m_centroid.SetV(a.m_centroid);this.m_vertexCount=a.m_vertexCount;this.Reserve(this.m_vertexCount);for(var b=0;b<this.m_vertexCount;b++)this.m_vertices[b].SetV(a.m_vertices[b]),this.m_normals[b].SetV(a.m_normals[b])}};m.prototype.SetAsArray=function(a,b){void 0===b&&(b=0);var e=new Vector,p,d;for(p=0;p<a.length;++p)d=a[p],e.push(d);this.SetAsVector(e,b)};m.AsArray=function(a,
b){void 0===b&&(b=0);var e=new m;e.SetAsArray(a,b);return e};m.prototype.SetAsVector=function(b,p){void 0===p&&(p=0);0==p&&(p=b.length);a.b2Assert(2<=p);this.m_vertexCount=p;this.Reserve(p);var e;for(e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(b[e]);for(e=0;e<this.m_vertexCount;++e){var d=parseInt(e),h=parseInt(e+1<this.m_vertexCount?e+1:0),d=u.SubtractVV(this.m_vertices[h],this.m_vertices[d]);a.b2Assert(d.LengthSquared()>Number.MIN_VALUE);this.m_normals[e].SetV(u.CrossVF(d,1));this.m_normals[e].Normalize()}this.m_centroid=
m.ComputeCentroid(this.m_vertices,this.m_vertexCount)};m.AsVector=function(a,b){void 0===b&&(b=0);var e=new m;e.SetAsVector(a,b);return e};m.prototype.SetAsBox=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-b);this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};m.AsBox=
function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);var e=new m;e.SetAsBox(a,b);return e};m.prototype.SetAsOrientedBox=function(a,b,p,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===p&&(p=null);void 0===d&&(d=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-b);this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=p;a=new J;a.position=
p;a.R.Set(d);for(p=0;p<this.m_vertexCount;++p)this.m_vertices[p]=u.MulX(a,this.m_vertices[p]),this.m_normals[p]=u.MulMV(a.R,this.m_normals[p])};m.AsOrientedBox=function(a,b,p,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===p&&(p=null);void 0===d&&(d=0);var e=new m;e.SetAsOrientedBox(a,b,p,d);return e};m.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(a);this.m_vertices[1].SetV(b);this.m_centroid.x=.5*(a.x+b.x);this.m_centroid.y=.5*(a.y+b.y);this.m_normals[0]=
u.CrossVF(u.SubtractVV(b,a),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};m.AsEdge=function(a,b){var p=new m;p.SetAsEdge(a,b);return p};m.prototype.TestPoint=function(a,b){var p;p=a.R;for(var e=b.x-a.position.x,d=b.y-a.position.y,h=e*p.col1.x+d*p.col1.y,l=e*p.col2.x+d*p.col2.y,m=0;m<this.m_vertexCount;++m)if(p=this.m_vertices[m],e=h-p.x,d=l-p.y,p=this.m_normals[m],0<p.x*e+p.y*d)return!1;return!0};m.prototype.RayCast=function(a,
b,p){var e=0,d=b.maxFraction,h,l,m,u;h=b.p1.x-p.position.x;l=b.p1.y-p.position.y;m=p.R;var v=h*m.col1.x+l*m.col1.y,z=h*m.col2.x+l*m.col2.y;h=b.p2.x-p.position.x;l=b.p2.y-p.position.y;m=p.R;b=h*m.col1.x+l*m.col1.y-v;m=h*m.col2.x+l*m.col2.y-z;for(var B=-1,f=0;f<this.m_vertexCount;++f){u=this.m_vertices[f];h=u.x-v;l=u.y-z;u=this.m_normals[f];h=u.x*h+u.y*l;l=u.x*b+u.y*m;if(0==l){if(0>h)return!1}else 0>l&&h<e*l?(e=h/l,B=f):0<l&&h<d*l&&(d=h/l);if(d<e-Number.MIN_VALUE)return!1}return 0<=B?(a.fraction=e,
m=p.R,u=this.m_normals[B],a.normal.x=m.col1.x*u.x+m.col2.x*u.y,a.normal.y=m.col1.y*u.x+m.col2.y*u.y,!0):!1};m.prototype.ComputeAABB=function(a,b){for(var p=b.R,e=this.m_vertices[0],d=b.position.x+(p.col1.x*e.x+p.col2.x*e.y),h=b.position.y+(p.col1.y*e.x+p.col2.y*e.y),l=d,m=h,u=1;u<this.m_vertexCount;++u)var e=this.m_vertices[u],v=b.position.x+(p.col1.x*e.x+p.col2.x*e.y),e=b.position.y+(p.col1.y*e.x+p.col2.y*e.y),d=d<v?d:v,h=h<e?h:e,l=l>v?l:v,m=m>e?m:e;a.lowerBound.x=d-this.m_radius;a.lowerBound.y=
h-this.m_radius;a.upperBound.x=l+this.m_radius;a.upperBound.y=m+this.m_radius};m.prototype.ComputeMass=function(a,b){void 0===b&&(b=0);if(2==this.m_vertexCount)a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var p=0,e=0,d=0,h=0,l=1/3,m=0;m<this.m_vertexCount;++m)var u=this.m_vertices[m],v=m+1<this.m_vertexCount?this.m_vertices[parseInt(m+1)]:this.m_vertices[0],z=u.x-0,x=u.y-0,f=v.x-0,k=v.y-0,t=z*k-x*f,q=.5*
t,d=d+q,p=p+q*l*(0+u.x+v.x),e=e+q*l*(0+u.y+v.y),u=z,h=h+t*(l*(.25*(u*u+f*u+f*f)+(0*u+0*f))+0+(l*(.25*(x*x+k*x+k*k)+(0*x+0*k))+0));a.mass=b*d;a.center.Set(1/d*p,1/d*e);a.I=b*h}};m.prototype.ComputeSubmergedArea=function(a,b,p,d){void 0===b&&(b=0);var e=u.MulTMV(p.R,a),h=b-u.Dot(a,p.position),m=new Vector_a2j_Number,v=0,z=-1;b=-1;var x=!1;for(a=a=0;a<this.m_vertexCount;++a){m[a]=u.Dot(e,this.m_vertices[a])-h;var B=m[a]<-Number.MIN_VALUE;0<a&&(B?x||(z=a-1,v++):x&&(b=a-1,v++));x=B}switch(v){case 0:return x?
(a=new l,this.ComputeMass(a,1),d.SetV(u.MulX(p,a.center)),a.mass):0;case 1:-1==z?z=this.m_vertexCount-1:b=this.m_vertexCount-1}a=parseInt((z+1)%this.m_vertexCount);e=parseInt((b+1)%this.m_vertexCount);h=(0-m[z])/(m[a]-m[z]);m=(0-m[b])/(m[e]-m[b]);z=new F(this.m_vertices[z].x*(1-h)+this.m_vertices[a].x*h,this.m_vertices[z].y*(1-h)+this.m_vertices[a].y*h);b=new F(this.m_vertices[b].x*(1-m)+this.m_vertices[e].x*m,this.m_vertices[b].y*(1-m)+this.m_vertices[e].y*m);m=0;h=new F;for(v=this.m_vertices[a];a!=
e;)a=(a+1)%this.m_vertexCount,x=a==e?b:this.m_vertices[a],B=.5*((v.x-z.x)*(x.y-z.y)-(v.y-z.y)*(x.x-z.x)),m+=B,h.x+=B*(z.x+v.x+x.x)/3,h.y+=B*(z.y+v.y+x.y)/3,v=x;h.Multiply(1/m);d.SetV(u.MulX(p,h));return m};m.prototype.GetVertexCount=function(){return this.m_vertexCount};m.prototype.GetVertices=function(){return this.m_vertices};m.prototype.GetNormals=function(){return this.m_normals};m.prototype.GetSupport=function(a){for(var b=0,p=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,e=1;e<this.m_vertexCount;++e){var d=
this.m_vertices[e].x*a.x+this.m_vertices[e].y*a.y;d>p&&(b=e,p=d)}return b};m.prototype.GetSupportVertex=function(a){for(var b=0,p=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,e=1;e<this.m_vertexCount;++e){var d=this.m_vertices[e].x*a.x+this.m_vertices[e].y*a.y;d>p&&(b=e,p=d)}return this.m_vertices[b]};m.prototype.Validate=function(){return!1};m.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=w.e_polygonShape;this.m_centroid=new F;this.m_vertices=new Vector;this.m_normals=
new Vector};m.prototype.Reserve=function(a){void 0===a&&(a=0);for(var b=parseInt(this.m_vertices.length);b<a;b++)this.m_vertices[b]=new F,this.m_normals[b]=new F};m.ComputeCentroid=function(a,b){void 0===b&&(b=0);for(var p=new F,e=0,d=1/3,h=0;h<b;++h){var l=a[h],m=h+1<b?a[parseInt(h+1)]:a[0],u=.5*((l.x-0)*(m.y-0)-(l.y-0)*(m.x-0)),e=e+u;p.x+=u*d*(0+l.x+m.x);p.y+=u*d*(0+l.y+m.y)}p.x*=1/e;p.y*=1/e;return p};m.ComputeOBB=function(a,b,p){void 0===p&&(p=0);var e,d=new Vector(p+1);for(e=0;e<p;++e)d[e]=b[e];
d[p]=d[0];b=Number.MAX_VALUE;for(e=1;e<=p;++e){for(var h=d[parseInt(e-1)],l=d[e].x-h.x,m=d[e].y-h.y,u=Math.sqrt(l*l+m*m),l=l/u,m=m/u,v=-m,z=l,x=u=Number.MAX_VALUE,f=-Number.MAX_VALUE,k=-Number.MAX_VALUE,t=0;t<p;++t){var q=d[t].x-h.x,D=d[t].y-h.y,Q=l*q+m*D,q=v*q+z*D;Q<u&&(u=Q);q<x&&(x=q);Q>f&&(f=Q);q>k&&(k=q)}t=(f-u)*(k-x);t<.95*b&&(b=t,a.R.col1.x=l,a.R.col1.y=m,a.R.col2.x=v,a.R.col2.y=z,l=.5*(u+f),m=.5*(x+k),v=a.R,a.center.x=h.x+(v.col1.x*l+v.col2.x*m),a.center.y=h.y+(v.col1.y*l+v.col2.y*m),a.extents.x=
.5*(f-u),a.extents.y=.5*(k-x))}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new p});w.b2Shape=function(){};w.prototype.Copy=function(){return null};w.prototype.Set=function(a){this.m_radius=a.m_radius};w.prototype.GetType=function(){return this.m_type};w.prototype.TestPoint=function(){return!1};w.prototype.RayCast=function(){return!1};w.prototype.ComputeAABB=function(){};w.prototype.ComputeMass=function(){};w.prototype.ComputeSubmergedArea=function(){return 0};w.TestOverlap=
function(a,b,p,d){var e=new z;e.proxyA=new O;e.proxyA.Set(a);e.proxyB=new O;e.proxyB.Set(p);e.transformA=b;e.transformB=d;e.useRadii=!0;a=new P;a.count=0;b=new v;x.Distance(b,a,e);return b.distance<10*Number.MIN_VALUE};w.prototype.b2Shape=function(){this.m_type=w.e_unknownShape;this.m_radius=a.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=-1;Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=
2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1})})();
(function(){var a=Box2D.Common.b2Color,b=Box2D.Common.b2Settings,d=Box2D.Common.Math.b2Math;a.b2Color=function(){this._b=this._g=this._r=0};a.prototype.b2Color=function(a,b,m){void 0===a&&(a=0);void 0===b&&(b=0);void 0===m&&(m=0);this._r=Box2D.parseUInt(255*d.Clamp(a,0,1));this._g=Box2D.parseUInt(255*d.Clamp(b,0,1));this._b=Box2D.parseUInt(255*d.Clamp(m,0,1))};a.prototype.Set=function(a,b,m){void 0===a&&(a=0);void 0===b&&(b=0);void 0===m&&(m=0);this._r=Box2D.parseUInt(255*d.Clamp(a,0,1));this._g=
Box2D.parseUInt(255*d.Clamp(b,0,1));this._b=Box2D.parseUInt(255*d.Clamp(m,0,1))};Object.defineProperty(a.prototype,"r",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._r=Box2D.parseUInt(255*d.Clamp(a,0,1))}});Object.defineProperty(a.prototype,"g",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._g=Box2D.parseUInt(255*d.Clamp(a,0,1))}});Object.defineProperty(a.prototype,"b",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._b=Box2D.parseUInt(255*
d.Clamp(a,0,1))}});Object.defineProperty(a.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}});b.b2Settings=function(){};b.b2MixFriction=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return Math.sqrt(a*b)};b.b2MixRestitution=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return a>b?a:b};b.b2Assert=function(a){if(!a)throw"Assertion Failed";};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=
65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*b.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*b.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*b.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=
1;Box2D.Common.b2Settings.b2_maxLinearCorrection=.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*b.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=b.b2_maxTranslation*b.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=.5*b.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=b.b2_maxRotation*b.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=.2;Box2D.Common.b2Settings.b2_timeToSleep=.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=
.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*b.b2_pi})})();
(function(){var a=Box2D.Common.Math.b2Mat22,b=Box2D.Common.Math.b2Mat33,d=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Sweep,l=Box2D.Common.Math.b2Transform,m=Box2D.Common.Math.b2Vec2,w=Box2D.Common.Math.b2Vec3;a.b2Mat22=function(){this.col1=new m;this.col2=new m};a.prototype.b2Mat22=function(){this.SetIdentity()};a.FromAngle=function(b){void 0===b&&(b=0);var p=new a;p.Set(b);return p};a.FromVV=function(b,d){var p=new a;p.SetVV(b,d);return p};a.prototype.Set=function(a){void 0===a&&(a=0);var b=
Math.cos(a);a=Math.sin(a);this.col1.x=b;this.col2.x=-a;this.col1.y=a;this.col2.y=b};a.prototype.SetVV=function(a,b){this.col1.SetV(a);this.col2.SetV(b)};a.prototype.Copy=function(){var b=new a;b.SetM(this);return b};a.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2)};a.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y};a.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};
a.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};a.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};a.prototype.GetInverse=function(a){var b=this.col1.x,p=this.col2.x,d=this.col1.y,h=this.col2.y,l=b*h-p*d;0!=l&&(l=1/l);a.col1.x=l*h;a.col2.x=-l*p;a.col1.y=-l*d;a.col2.y=l*b;return a};a.prototype.Solve=function(a,b,d){void 0===b&&(b=0);void 0===d&&(d=0);var p=this.col1.x,h=this.col2.x,l=this.col1.y,m=this.col2.y,u=p*m-h*l;0!=u&&(u=1/u);
a.x=u*(m*b-h*d);a.y=u*(p*d-l*b);return a};a.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};b.b2Mat33=function(){this.col1=new w;this.col2=new w;this.col3=new w};b.prototype.b2Mat33=function(a,b,d){void 0===a&&(a=null);void 0===b&&(b=null);void 0===d&&(d=null);a||b||d?(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(d)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())};b.prototype.SetVVV=function(a,b,d){this.col1.SetV(a);this.col2.SetV(b);this.col3.SetV(d)};b.prototype.Copy=
function(){return new b(this.col1,this.col2,this.col3)};b.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2);this.col3.SetV(a.col3)};b.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col1.z+=a.col1.z;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y;this.col2.z+=a.col2.z;this.col3.x+=a.col3.x;this.col3.y+=a.col3.y;this.col3.z+=a.col3.z};b.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;
this.col1.z=0;this.col2.z=0;this.col3.z=1};b.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};b.prototype.Solve22=function(a,b,d){void 0===b&&(b=0);void 0===d&&(d=0);var p=this.col1.x,h=this.col2.x,l=this.col1.y,m=this.col2.y,u=p*m-h*l;0!=u&&(u=1/u);a.x=u*(m*b-h*d);a.y=u*(p*d-l*b);return a};b.prototype.Solve33=function(a,b,d,h){void 0===b&&(b=0);void 0===d&&(d=0);void 0===h&&(h=0);var p=this.col1.x,
l=this.col1.y,m=this.col1.z,u=this.col2.x,w=this.col2.y,e=this.col2.z,J=this.col3.x,B=this.col3.y,F=this.col3.z,E=p*(w*F-e*B)+l*(e*J-u*F)+m*(u*B-w*J);0!=E&&(E=1/E);a.x=E*(b*(w*F-e*B)+d*(e*J-u*F)+h*(u*B-w*J));a.y=E*(p*(d*F-h*B)+l*(h*J-b*F)+m*(b*B-d*J));a.z=E*(p*(w*h-e*d)+l*(e*b-u*h)+m*(u*d-w*b));return a};d.b2Math=function(){};d.IsValid=function(a){void 0===a&&(a=0);return isFinite(a)};d.Dot=function(a,b){return a.x*b.x+a.y*b.y};d.CrossVV=function(a,b){return a.x*b.y-a.y*b.x};d.CrossVF=function(a,
b){void 0===b&&(b=0);return new m(b*a.y,-b*a.x)};d.CrossFV=function(a,b){void 0===a&&(a=0);return new m(-a*b.y,a*b.x)};d.MulMV=function(a,b){return new m(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y)};d.MulTMV=function(a,b){return new m(d.Dot(b,a.col1),d.Dot(b,a.col2))};d.MulX=function(a,b){var p=d.MulMV(a.R,b);p.x+=a.position.x;p.y+=a.position.y;return p};d.MulXT=function(a,b){var p=d.SubtractVV(b,a.position),h=p.x*a.R.col1.x+p.y*a.R.col1.y;p.y=p.x*a.R.col2.x+p.y*a.R.col2.y;p.x=h;return p};
d.AddVV=function(a,b){return new m(a.x+b.x,a.y+b.y)};d.SubtractVV=function(a,b){return new m(a.x-b.x,a.y-b.y)};d.Distance=function(a,b){var d=a.x-b.x,p=a.y-b.y;return Math.sqrt(d*d+p*p)};d.DistanceSquared=function(a,b){var d=a.x-b.x,p=a.y-b.y;return d*d+p*p};d.MulFV=function(a,b){void 0===a&&(a=0);return new m(a*b.x,a*b.y)};d.AddMM=function(b,h){return a.FromVV(d.AddVV(b.col1,h.col1),d.AddVV(b.col2,h.col2))};d.MulMM=function(b,h){return a.FromVV(d.MulMV(b,h.col1),d.MulMV(b,h.col2))};d.MulTMM=function(b,
h){var p=new m(d.Dot(b.col1,h.col1),d.Dot(b.col2,h.col1)),l=new m(d.Dot(b.col1,h.col2),d.Dot(b.col2,h.col2));return a.FromVV(p,l)};d.Abs=function(a){void 0===a&&(a=0);return 0<a?a:-a};d.AbsV=function(a){return new m(d.Abs(a.x),d.Abs(a.y))};d.AbsM=function(b){return a.FromVV(d.AbsV(b.col1),d.AbsV(b.col2))};d.Min=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return a<b?a:b};d.MinV=function(a,b){return new m(d.Min(a.x,b.x),d.Min(a.y,b.y))};d.Max=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);
return a>b?a:b};d.MaxV=function(a,b){return new m(d.Max(a.x,b.x),d.Max(a.y,b.y))};d.Clamp=function(a,b,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===d&&(d=0);return a<b?b:a>d?d:a};d.ClampV=function(a,b,h){return d.MaxV(b,d.MinV(a,h))};d.Swap=function(a,b){var d=a[0];a[0]=b[0];b[0]=d};d.Random=function(){return 2*Math.random()-1};d.RandomRange=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return(b-a)*Math.random()+a};d.NextPowerOfTwo=function(a){void 0===a&&(a=0);a|=a>>1&2147483647;a|=a>>2&1073741823;
a|=a>>4&268435455;a|=a>>8&16777215;return(a|a>>16&65535)+1};d.IsPowerOfTwo=function(a){void 0===a&&(a=0);return 0<a&&0==(a&a-1)};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new m(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=a.FromVV(new m(1,0),new m(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new l(d.b2Vec2_zero,d.b2Mat22_identity)});h.b2Sweep=function(){this.localCenter=new m;this.c0=new m;this.c=new m};h.prototype.Set=function(a){this.localCenter.SetV(a.localCenter);
this.c0.SetV(a.c0);this.c.SetV(a.c);this.a0=a.a0;this.a=a.a;this.t0=a.t0};h.prototype.Copy=function(){var a=new h;a.localCenter.SetV(this.localCenter);a.c0.SetV(this.c0);a.c.SetV(this.c);a.a0=this.a0;a.a=this.a;a.t0=this.t0;return a};h.prototype.GetTransform=function(a,b){void 0===b&&(b=0);a.position.x=(1-b)*this.c0.x+b*this.c.x;a.position.y=(1-b)*this.c0.y+b*this.c.y;a.R.Set((1-b)*this.a0+b*this.a);var d=a.R;a.position.x-=d.col1.x*this.localCenter.x+d.col2.x*this.localCenter.y;a.position.y-=d.col1.y*
this.localCenter.x+d.col2.y*this.localCenter.y};h.prototype.Advance=function(a){void 0===a&&(a=0);if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x;this.c0.y=(1-b)*this.c0.y+b*this.c.y;this.a0=(1-b)*this.a0+b*this.a;this.t0=a}};l.b2Transform=function(){this.position=new m;this.R=new a};l.prototype.b2Transform=function(a,b){void 0===a&&(a=null);void 0===b&&(b=null);a&&(this.position.SetV(a),this.R.SetM(b))};l.prototype.Initialize=function(a,
b){this.position.SetV(a);this.R.SetM(b)};l.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};l.prototype.Set=function(a){this.position.SetV(a.position);this.R.SetM(a.R)};l.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};m.b2Vec2=function(){};m.prototype.b2Vec2=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.x=a;this.y=b};m.prototype.SetZero=function(){this.y=this.x=0};m.prototype.Set=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);
this.x=a;this.y=b};m.prototype.SetV=function(a){this.x=a.x;this.y=a.y};m.prototype.GetNegative=function(){return new m(-this.x,-this.y)};m.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};m.Make=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return new m(a,b)};m.prototype.Copy=function(){return new m(this.x,this.y)};m.prototype.Add=function(a){this.x+=a.x;this.y+=a.y};m.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y};m.prototype.Multiply=function(a){void 0===a&&(a=0);this.x*=
a;this.y*=a};m.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y;this.y=a.col1.y*b+a.col2.y*this.y};m.prototype.MulTM=function(a){var b=d.Dot(this,a.col1);this.y=d.Dot(this,a.col2);this.x=b};m.prototype.CrossVF=function(a){void 0===a&&(a=0);var b=this.x;this.x=a*this.y;this.y=-a*b};m.prototype.CrossFV=function(a){void 0===a&&(a=0);var b=this.x;this.x=-a*this.y;this.y=a*b};m.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y};m.prototype.MaxV=
function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y};m.prototype.Abs=function(){0>this.x&&(this.x=-this.x);0>this.y&&(this.y=-this.y)};m.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};m.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};m.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;this.x*=b;this.y*=b;return a};m.prototype.IsValid=function(){return d.IsValid(this.x)&&
d.IsValid(this.y)};w.b2Vec3=function(){};w.prototype.b2Vec3=function(a,b,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===d&&(d=0);this.x=a;this.y=b;this.z=d};w.prototype.SetZero=function(){this.x=this.y=this.z=0};w.prototype.Set=function(a,b,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===d&&(d=0);this.x=a;this.y=b;this.z=d};w.prototype.SetV=function(a){this.x=a.x;this.y=a.y;this.z=a.z};w.prototype.GetNegative=function(){return new w(-this.x,-this.y,-this.z)};w.prototype.NegativeSelf=function(){this.x=
-this.x;this.y=-this.y;this.z=-this.z};w.prototype.Copy=function(){return new w(this.x,this.y,this.z)};w.prototype.Add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};w.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z};w.prototype.Multiply=function(a){void 0===a&&(a=0);this.x*=a;this.y*=a;this.z*=a}})();
(function(){var a=Box2D.Common.Math.b2Math,b=Box2D.Common.Math.b2Sweep,d=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,l=Box2D.Common.b2Color,m=Box2D.Common.b2Settings,w=Box2D.Collision.b2AABB,p=Box2D.Collision.b2ContactPoint,u=Box2D.Collision.b2DynamicTreeBroadPhase,J=Box2D.Collision.b2RayCastInput,F=Box2D.Collision.b2RayCastOutput,x=Box2D.Collision.Shapes.b2CircleShape,z=Box2D.Collision.Shapes.b2EdgeShape,v=Box2D.Collision.Shapes.b2MassData,O=Box2D.Collision.Shapes.b2PolygonShape,P=Box2D.Collision.Shapes.b2Shape,
e=Box2D.Dynamics.b2Body,L=Box2D.Dynamics.b2BodyDef,B=Box2D.Dynamics.b2ContactFilter,N=Box2D.Dynamics.b2ContactImpulse,E=Box2D.Dynamics.b2ContactListener,K=Box2D.Dynamics.b2ContactManager,C=Box2D.Dynamics.b2DebugDraw,R=Box2D.Dynamics.b2DestructionListener,G=Box2D.Dynamics.b2FilterData,I=Box2D.Dynamics.b2Fixture,S=Box2D.Dynamics.b2FixtureDef,M=Box2D.Dynamics.b2Island,f=Box2D.Dynamics.b2TimeStep,k=Box2D.Dynamics.b2World,t=Box2D.Dynamics.Contacts.b2Contact,q=Box2D.Dynamics.Contacts.b2ContactFactory,D=
Box2D.Dynamics.Contacts.b2ContactSolver,Q=Box2D.Dynamics.Joints.b2Joint,y=Box2D.Dynamics.Joints.b2PulleyJoint;e.b2Body=function(){this.m_xf=new d;this.m_sweep=new b;this.m_linearVelocity=new h;this.m_force=new h};e.prototype.connectEdges=function(c,b,f){void 0===f&&(f=0);var g=Math.atan2(b.GetDirectionVector().y,b.GetDirectionVector().x);f=a.MulFV(Math.tan(.5*(g-f)),b.GetDirectionVector());f=a.SubtractVV(f,b.GetNormalVector());f=a.MulFV(m.b2_toiSlop,f);f=a.AddVV(f,b.GetVertex1());var k=a.AddVV(c.GetDirectionVector(),
b.GetDirectionVector());k.Normalize();var r=0<a.Dot(c.GetDirectionVector(),b.GetNormalVector());c.SetNextEdge(b,f,k,r);b.SetPrevEdge(c,f,k,r);return g};e.prototype.CreateFixture=function(a){if(1==this.m_world.IsLocked())return null;var c=new I;c.Create(this,this.m_xf,a);this.m_flags&e.e_activeFlag&&c.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);c.m_next=this.m_fixtureList;this.m_fixtureList=c;++this.m_fixtureCount;c.m_body=this;0<c.m_density&&this.ResetMassData();this.m_world.m_flags|=
k.e_newFixture;return c};e.prototype.CreateFixture2=function(a,b){void 0===b&&(b=0);var c=new S;c.shape=a;c.density=b;return this.CreateFixture(c)};e.prototype.DestroyFixture=function(a){if(1!=this.m_world.IsLocked()){for(var c=this.m_fixtureList,b=null;null!=c;){if(c==a){b?b.m_next=a.m_next:this.m_fixtureList=a.m_next;break}b=c;c=c.m_next}for(c=this.m_contactList;c;){var b=c.contact,c=c.next,f=b.GetFixtureA(),k=b.GetFixtureB();a!=f&&a!=k||this.m_world.m_contactManager.Destroy(b)}this.m_flags&e.e_activeFlag&&
a.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);a.Destroy();a.m_body=null;a.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};e.prototype.SetPositionAndAngle=function(a,b){void 0===b&&(b=0);var c;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(b);this.m_xf.position.SetV(a);c=this.m_xf.R;var g=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*g.x+c.col2.x*g.y;this.m_sweep.c.y=c.col1.y*g.x+c.col2.y*g.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);
this.m_sweep.a0=this.m_sweep.a=b;g=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(g,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};e.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())};e.prototype.GetTransform=function(){return this.m_xf};e.prototype.GetPosition=function(){return this.m_xf.position};e.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())};e.prototype.GetAngle=
function(){return this.m_sweep.a};e.prototype.SetAngle=function(a){void 0===a&&(a=0);this.SetPositionAndAngle(this.GetPosition(),a)};e.prototype.GetWorldCenter=function(){return this.m_sweep.c};e.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};e.prototype.SetLinearVelocity=function(a){this.m_type!=e.b2_staticBody&&this.m_linearVelocity.SetV(a)};e.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};e.prototype.SetAngularVelocity=function(a){void 0===a&&(a=0);this.m_type!=
e.b2_staticBody&&(this.m_angularVelocity=a)};e.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};e.prototype.GetDefinition=function(){var a=new L;a.type=this.GetType();a.allowSleep=(this.m_flags&e.e_allowSleepFlag)==e.e_allowSleepFlag;a.angle=this.GetAngle();a.angularDamping=this.m_angularDamping;a.angularVelocity=this.m_angularVelocity;a.fixedRotation=(this.m_flags&e.e_fixedRotationFlag)==e.e_fixedRotationFlag;a.bullet=(this.m_flags&e.e_bulletFlag)==e.e_bulletFlag;a.awake=(this.m_flags&
e.e_awakeFlag)==e.e_awakeFlag;a.linearDamping=this.m_linearDamping;a.linearVelocity.SetV(this.GetLinearVelocity());a.position=this.GetPosition();a.userData=this.GetUserData();return a};e.prototype.ApplyForce=function(a,b){this.m_type==e.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)};e.prototype.ApplyTorque=function(a){void 0===a&&(a=0);this.m_type==e.b2_dynamicBody&&(0==this.IsAwake()&&
this.SetAwake(!0),this.m_torque+=a)};e.prototype.ApplyImpulse=function(a,b){this.m_type==e.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))};e.prototype.Split=function(c){for(var b=this.GetLinearVelocity().Copy(),f=this.GetAngularVelocity(),k=this.GetWorldCenter(),q=this.m_world.CreateBody(this.GetDefinition()),t,
d=this.m_fixtureList;d;)if(c(d)){var y=d.m_next;t?t.m_next=y:this.m_fixtureList=y;this.m_fixtureCount--;d.m_next=q.m_fixtureList;q.m_fixtureList=d;q.m_fixtureCount++;d.m_body=q;d=y}else t=d,d=d.m_next;this.ResetMassData();q.ResetMassData();t=this.GetWorldCenter();c=q.GetWorldCenter();t=a.AddVV(b,a.CrossFV(f,a.SubtractVV(t,k)));b=a.AddVV(b,a.CrossFV(f,a.SubtractVV(c,k)));this.SetLinearVelocity(t);q.SetLinearVelocity(b);this.SetAngularVelocity(f);q.SetAngularVelocity(f);this.SynchronizeFixtures();q.SynchronizeFixtures();
return q};e.prototype.Merge=function(a){var c;for(c=a.m_fixtureList;c;){var b=c.m_next;a.m_fixtureCount--;c.m_next=this.m_fixtureList;this.m_fixtureList=c;this.m_fixtureCount++;c.m_body=k;c=b}f.m_fixtureCount=0;var f=this,k=a;f.GetWorldCenter();k.GetWorldCenter();f.GetLinearVelocity().Copy();k.GetLinearVelocity().Copy();f.GetAngularVelocity();k.GetAngularVelocity();f.ResetMassData();this.SynchronizeFixtures()};e.prototype.GetMass=function(){return this.m_mass};e.prototype.GetInertia=function(){return this.m_I};
e.prototype.GetMassData=function(a){a.mass=this.m_mass;a.I=this.m_I;a.center.SetV(this.m_sweep.localCenter)};e.prototype.SetMassData=function(c){m.b2Assert(0==this.m_world.IsLocked());if(1!=this.m_world.IsLocked()&&this.m_type==e.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=c.mass;0>=this.m_mass&&(this.m_mass=1);this.m_invMass=1/this.m_mass;0<c.I&&0==(this.m_flags&e.e_fixedRotationFlag)&&(this.m_I=c.I-this.m_mass*(c.center.x*c.center.x+c.center.y*c.center.y),this.m_invI=1/this.m_I);
var b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(c.center);this.m_sweep.c0.SetV(a.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}};e.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(this.m_type!=e.b2_staticBody&&this.m_type!=e.b2_kinematicBody){for(var c=
h.Make(0,0),b=this.m_fixtureList;b;b=b.m_next)if(0!=b.m_density){var f=b.GetMassData();this.m_mass+=f.mass;c.x+=f.center.x*f.mass;c.y+=f.center.y*f.mass;this.m_I+=f.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,c.x*=this.m_invMass,c.y*=this.m_invMass):this.m_invMass=this.m_mass=1;0<this.m_I&&0==(this.m_flags&e.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(c.x*c.x+c.y*c.y),this.m_I*=this.m_inertiaScale,m.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(c);
this.m_sweep.c0.SetV(a.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}};e.prototype.GetWorldPoint=function(a){var c=this.m_xf.R;a=new h(c.col1.x*a.x+c.col2.x*a.y,c.col1.y*a.x+c.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return a};e.prototype.GetWorldVector=function(c){return a.MulMV(this.m_xf.R,c)};e.prototype.GetLocalPoint=
function(c){return a.MulXT(this.m_xf,c)};e.prototype.GetLocalVector=function(c){return a.MulTMV(this.m_xf.R,c)};e.prototype.GetLinearVelocityFromWorldPoint=function(a){return new h(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};e.prototype.GetLinearVelocityFromLocalPoint=function(a){var c=this.m_xf.R;a=new h(c.col1.x*a.x+c.col2.x*a.y,c.col1.y*a.x+c.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;
return new h(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};e.prototype.GetLinearDamping=function(){return this.m_linearDamping};e.prototype.SetLinearDamping=function(a){void 0===a&&(a=0);this.m_linearDamping=a};e.prototype.GetAngularDamping=function(){return this.m_angularDamping};e.prototype.SetAngularDamping=function(a){void 0===a&&(a=0);this.m_angularDamping=a};e.prototype.SetType=function(a){void 0===
a&&(a=0);if(this.m_type!=a)for(this.m_type=a,this.ResetMassData(),this.m_type==e.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,a=this.m_contactList;a;a=a.next)a.contact.FlagForFiltering()};e.prototype.GetType=function(){return this.m_type};e.prototype.SetBullet=function(a){this.m_flags=a?this.m_flags|e.e_bulletFlag:this.m_flags&~e.e_bulletFlag};e.prototype.IsBullet=function(){return(this.m_flags&e.e_bulletFlag)==
e.e_bulletFlag};e.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=e.e_allowSleepFlag:(this.m_flags&=~e.e_allowSleepFlag,this.SetAwake(!0))};e.prototype.SetAwake=function(a){a?(this.m_flags|=e.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~e.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};e.prototype.IsAwake=function(){return(this.m_flags&e.e_awakeFlag)==e.e_awakeFlag};e.prototype.SetFixedRotation=function(a){this.m_flags=
a?this.m_flags|e.e_fixedRotationFlag:this.m_flags&~e.e_fixedRotationFlag;this.ResetMassData()};e.prototype.IsFixedRotation=function(){return(this.m_flags&e.e_fixedRotationFlag)==e.e_fixedRotationFlag};e.prototype.SetActive=function(a){if(a!=this.IsActive()){var c;if(a)for(this.m_flags|=e.e_activeFlag,a=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.CreateProxy(a,this.m_xf);else{this.m_flags&=~e.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=
c.m_next)c.DestroyProxy(a);for(a=this.m_contactList;a;)c=a,a=a.next,this.m_world.m_contactManager.Destroy(c.contact);this.m_contactList=null}}};e.prototype.IsActive=function(){return(this.m_flags&e.e_activeFlag)==e.e_activeFlag};e.prototype.IsSleepingAllowed=function(){return(this.m_flags&e.e_allowSleepFlag)==e.e_allowSleepFlag};e.prototype.GetFixtureList=function(){return this.m_fixtureList};e.prototype.GetJointList=function(){return this.m_jointList};e.prototype.GetControllerList=function(){return this.m_controllerList};
e.prototype.GetContactList=function(){return this.m_contactList};e.prototype.GetNext=function(){return this.m_next};e.prototype.GetUserData=function(){return this.m_userData};e.prototype.SetUserData=function(a){this.m_userData=a};e.prototype.GetWorld=function(){return this.m_world};e.prototype.b2Body=function(a,b){this.m_flags=0;a.bullet&&(this.m_flags|=e.e_bulletFlag);a.fixedRotation&&(this.m_flags|=e.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=e.e_allowSleepFlag);a.awake&&(this.m_flags|=e.e_awakeFlag);
a.active&&(this.m_flags|=e.e_activeFlag);this.m_world=b;this.m_xf.position.SetV(a.position);this.m_xf.R.Set(a.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,g=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*g.x+c.col2.x*g.y;this.m_sweep.c.y=c.col1.y*g.x+c.col2.y*g.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=
null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(a.linearVelocity);this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=a.type;this.m_invMass=this.m_type==e.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=0;this.m_inertiaScale=a.inertiaScale;this.m_userData=a.userData;this.m_fixtureList=null;this.m_fixtureCount=0};e.prototype.SynchronizeFixtures=
function(){var a=e.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,f=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*f.x+b.col2.x*f.y);a.position.y=this.m_sweep.c0.y-(b.col1.y*f.x+b.col2.y*f.y);f=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.Synchronize(f,a,this.m_xf)};e.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y);
this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)};e.prototype.ShouldCollide=function(a){if(this.m_type!=e.b2_dynamicBody&&a.m_type!=e.b2_dynamicBody)return!1;for(var c=this.m_jointList;c;c=c.next)if(c.other==a&&0==c.joint.m_collideConnected)return!1;return!0};e.prototype.Advance=function(a){void 0===a&&(a=0);this.m_sweep.Advance(a);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=
new d;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});L.b2BodyDef=function(){this.position=new h;this.linearVelocity=new h};L.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,
0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=e.b2_staticBody;this.active=!0;this.inertiaScale=1};B.b2ContactFilter=function(){};B.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),g=b.GetFilterData();return c.groupIndex==g.groupIndex&&0!=c.groupIndex?0<c.groupIndex:0!=(c.maskBits&g.categoryBits)&&0!=(c.categoryBits&g.maskBits)};B.prototype.RayCollide=
function(a,b){return a?this.ShouldCollide(a instanceof I?a:null,b):!0};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new B});N.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(m.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(m.b2_maxManifoldPoints)};E.b2ContactListener=function(){};E.prototype.BeginContact=function(){};E.prototype.EndContact=function(){};E.prototype.PreSolve=function(){};E.prototype.PostSolve=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=
new E});K.b2ContactManager=function(){};K.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=B.b2_defaultFilter;this.m_contactListener=E.b2_defaultListener;this.m_contactFactory=new q(this.m_allocator);this.m_broadPhase=new u};K.prototype.AddPair=function(a,b){var c=a instanceof I?a:null,g=b instanceof I?b:null,f=c.GetBody(),k=g.GetBody();if(f!=k){for(var q=k.GetContactList();q;){if(q.other==f){var t=q.contact.GetFixtureA(),d=q.contact.GetFixtureB();
if(t==c&&d==g||t==g&&d==c)return}q=q.next}0!=k.ShouldCollide(f)&&0!=this.m_contactFilter.ShouldCollide(c,g)&&(q=this.m_contactFactory.Create(c,g),c=q.GetFixtureA(),g=q.GetFixtureB(),f=c.m_body,k=g.m_body,q.m_prev=null,q.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=q),this.m_world.m_contactList=q,q.m_nodeA.contact=q,q.m_nodeA.other=k,q.m_nodeA.prev=null,q.m_nodeA.next=f.m_contactList,null!=f.m_contactList&&(f.m_contactList.prev=q.m_nodeA),f.m_contactList=
q.m_nodeA,q.m_nodeB.contact=q,q.m_nodeB.other=f,q.m_nodeB.prev=null,q.m_nodeB.next=k.m_contactList,null!=k.m_contactList&&(k.m_contactList.prev=q.m_nodeB),k.m_contactList=q.m_nodeB,++this.m_world.m_contactCount)}};K.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};K.prototype.Destroy=function(a){var c=a.GetFixtureA(),b=a.GetFixtureB(),c=c.GetBody(),b=b.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a);a.m_prev&&(a.m_prev.m_next=
a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next);a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next);a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev);a.m_nodeA==c.m_contactList&&(c.m_contactList=a.m_nodeA.next);a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next);a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev);a.m_nodeB==b.m_contactList&&(b.m_contactList=a.m_nodeB.next);this.m_contactFactory.Destroy(a);--this.m_contactCount};
K.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),f=a.GetFixtureB(),k=b.GetBody(),q=f.GetBody();if(0==k.IsAwake()&&0==q.IsAwake())a=a.GetNext();else{if(a.m_flags&t.e_filterFlag){if(0==q.ShouldCollide(k)){b=a;a=b.GetNext();this.Destroy(b);continue}if(0==this.m_contactFilter.ShouldCollide(b,f)){b=a;a=b.GetNext();this.Destroy(b);continue}a.m_flags&=~t.e_filterFlag}0==this.m_broadPhase.TestOverlap(b.m_proxy,f.m_proxy)?(b=a,a=b.GetNext(),this.Destroy(b)):(a.Update(this.m_contactListener),
a=a.GetNext())}}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new p});C.b2DebugDraw=function(){};C.prototype.b2DebugDraw=function(){};C.prototype.SetFlags=function(){};C.prototype.GetFlags=function(){};C.prototype.AppendFlags=function(){};C.prototype.ClearFlags=function(){};C.prototype.SetSprite=function(){};C.prototype.GetSprite=function(){};C.prototype.SetDrawScale=function(){};C.prototype.GetDrawScale=function(){};C.prototype.SetLineThickness=function(){};C.prototype.GetLineThickness=
function(){};C.prototype.SetAlpha=function(){};C.prototype.GetAlpha=function(){};C.prototype.SetFillAlpha=function(){};C.prototype.GetFillAlpha=function(){};C.prototype.SetXFormScale=function(){};C.prototype.GetXFormScale=function(){};C.prototype.DrawPolygon=function(){};C.prototype.DrawSolidPolygon=function(){};C.prototype.DrawCircle=function(){};C.prototype.DrawSolidCircle=function(){};C.prototype.DrawSegment=function(){};C.prototype.DrawTransform=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=
1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});R.b2DestructionListener=function(){};R.prototype.SayGoodbyeJoint=function(){};R.prototype.SayGoodbyeFixture=function(){};G.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};G.prototype.Copy=function(){var a=new G;a.categoryBits=this.categoryBits;a.maskBits=
this.maskBits;a.groupIndex=this.groupIndex;return a};I.b2Fixture=function(){this.m_filter=new G};I.prototype.GetType=function(){return this.m_shape.GetType()};I.prototype.GetShape=function(){return this.m_shape};I.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(a=this.m_body.GetContactList();a;){var c=a.contact,b=c.GetFixtureA(),f=c.GetFixtureB();b!=this&&f!=this||c.SetSensor(b.IsSensor()||f.IsSensor());a=a.next}};I.prototype.IsSensor=function(){return this.m_isSensor};
I.prototype.SetFilterData=function(a){this.m_filter=a.Copy();if(!this.m_body)for(a=this.m_body.GetContactList();a;){var c=a.contact,b=c.GetFixtureA(),f=c.GetFixtureB();b!=this&&f!=this||c.FlagForFiltering();a=a.next}};I.prototype.GetFilterData=function(){return this.m_filter.Copy()};I.prototype.GetBody=function(){return this.m_body};I.prototype.GetNext=function(){return this.m_next};I.prototype.GetUserData=function(){return this.m_userData};I.prototype.SetUserData=function(a){this.m_userData=a};I.prototype.TestPoint=
function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)};I.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())};I.prototype.GetMassData=function(a){void 0===a&&(a=null);null==a&&(a=new v);this.m_shape.ComputeMass(a,this.m_density);return a};I.prototype.SetDensity=function(a){void 0===a&&(a=0);this.m_density=a};I.prototype.GetDensity=function(){return this.m_density};I.prototype.GetFriction=function(){return this.m_friction};I.prototype.SetFriction=
function(a){void 0===a&&(a=0);this.m_friction=a};I.prototype.GetRestitution=function(){return this.m_restitution};I.prototype.SetRestitution=function(a){void 0===a&&(a=0);this.m_restitution=a};I.prototype.GetAABB=function(){return this.m_aabb};I.prototype.b2Fixture=function(){this.m_aabb=new w;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};I.prototype.Create=function(a,b,f){this.m_userData=f.userData;this.m_friction=f.friction;this.m_restitution=
f.restitution;this.m_body=a;this.m_next=null;this.m_filter=f.filter.Copy();this.m_isSensor=f.isSensor;this.m_shape=f.shape.Copy();this.m_density=f.density};I.prototype.Destroy=function(){this.m_shape=null};I.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b);this.m_proxy=a.CreateProxy(this.m_aabb,this)};I.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)};I.prototype.Synchronize=function(c,b,f){if(this.m_proxy){var g=new w,
k=new w;this.m_shape.ComputeAABB(g,b);this.m_shape.ComputeAABB(k,f);this.m_aabb.Combine(g,k);b=a.SubtractVV(f.position,b.position);c.MoveProxy(this.m_proxy,this.m_aabb,b)}};S.b2FixtureDef=function(){this.filter=new G};S.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=!1};M.b2Island=function(){};M.prototype.b2Island=function(){this.m_bodies=new Vector;
this.m_contacts=new Vector;this.m_joints=new Vector};M.prototype.Initialize=function(a,b,f,k,q,t){void 0===a&&(a=0);void 0===b&&(b=0);void 0===f&&(f=0);this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=f;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=k;this.m_listener=q;this.m_contactSolver=t;for(k=this.m_bodies.length;k<a;k++)this.m_bodies[k]=null;for(k=this.m_contacts.length;k<b;k++)this.m_contacts[k]=null;for(k=this.m_joints.length;k<f;k++)this.m_joints[k]=
null};M.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};M.prototype.Solve=function(c,b,f){var g,k,q;for(g=0;g<this.m_bodyCount;++g)k=this.m_bodies[g],k.GetType()==e.b2_dynamicBody&&(k.m_linearVelocity.x+=c.dt*(b.x+k.m_invMass*k.m_force.x),k.m_linearVelocity.y+=c.dt*(b.y+k.m_invMass*k.m_force.y),k.m_angularVelocity+=c.dt*k.m_invI*k.m_torque,k.m_linearVelocity.Multiply(a.Clamp(1-c.dt*k.m_linearDamping,0,1)),k.m_angularVelocity*=a.Clamp(1-c.dt*k.m_angularDamping,
0,1));this.m_contactSolver.Initialize(c,this.m_contacts,this.m_contactCount,this.m_allocator);b=this.m_contactSolver;b.InitVelocityConstraints(c);for(g=0;g<this.m_jointCount;++g)q=this.m_joints[g],q.InitVelocityConstraints(c);for(g=0;g<c.velocityIterations;++g){for(k=0;k<this.m_jointCount;++k)q=this.m_joints[k],q.SolveVelocityConstraints(c);b.SolveVelocityConstraints()}for(g=0;g<this.m_jointCount;++g)q=this.m_joints[g],q.FinalizeVelocityConstraints();b.FinalizeVelocityConstraints();for(g=0;g<this.m_bodyCount;++g)if(k=
this.m_bodies[g],k.GetType()!=e.b2_staticBody){var t=c.dt*k.m_linearVelocity.x,r=c.dt*k.m_linearVelocity.y;t*t+r*r>m.b2_maxTranslationSquared&&(k.m_linearVelocity.Normalize(),k.m_linearVelocity.x=k.m_linearVelocity.x*m.b2_maxTranslation*c.inv_dt,k.m_linearVelocity.y=k.m_linearVelocity.y*m.b2_maxTranslation*c.inv_dt);t=c.dt*k.m_angularVelocity;t*t>m.b2_maxRotationSquared&&(k.m_angularVelocity=0>k.m_angularVelocity?-m.b2_maxRotation*c.inv_dt:m.b2_maxRotation*c.inv_dt);k.m_sweep.c0.SetV(k.m_sweep.c);
k.m_sweep.a0=k.m_sweep.a;k.m_sweep.c.x+=c.dt*k.m_linearVelocity.x;k.m_sweep.c.y+=c.dt*k.m_linearVelocity.y;k.m_sweep.a+=c.dt*k.m_angularVelocity;k.SynchronizeTransform()}for(g=0;g<c.positionIterations;++g){t=b.SolvePositionConstraints(m.b2_contactBaumgarte);r=!0;for(k=0;k<this.m_jointCount;++k)q=this.m_joints[k],q=q.SolvePositionConstraints(m.b2_contactBaumgarte),r=r&&q;if(t&&r)break}this.Report(b.m_constraints);if(f){f=Number.MAX_VALUE;b=m.b2_linearSleepTolerance*m.b2_linearSleepTolerance;t=m.b2_angularSleepTolerance*
m.b2_angularSleepTolerance;for(g=0;g<this.m_bodyCount;++g)k=this.m_bodies[g],k.GetType()!=e.b2_staticBody&&(0==(k.m_flags&e.e_allowSleepFlag)&&(f=k.m_sleepTime=0),0==(k.m_flags&e.e_allowSleepFlag)||k.m_angularVelocity*k.m_angularVelocity>t||a.Dot(k.m_linearVelocity,k.m_linearVelocity)>b?f=k.m_sleepTime=0:(k.m_sleepTime+=c.dt,f=a.Min(f,k.m_sleepTime)));if(f>=m.b2_timeToSleep)for(g=0;g<this.m_bodyCount;++g)k=this.m_bodies[g],k.SetAwake(!1)}};M.prototype.SolveTOI=function(a){var b,c;this.m_contactSolver.Initialize(a,
this.m_contacts,this.m_contactCount,this.m_allocator);var f=this.m_contactSolver;for(b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(f.SolveVelocityConstraints(),c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_bodyCount;++b)if(c=this.m_bodies[b],c.GetType()!=e.b2_staticBody){var k=a.dt*c.m_linearVelocity.x,q=a.dt*c.m_linearVelocity.y;k*k+q*q>m.b2_maxTranslationSquared&&(c.m_linearVelocity.Normalize(),
c.m_linearVelocity.x=c.m_linearVelocity.x*m.b2_maxTranslation*a.inv_dt,c.m_linearVelocity.y=c.m_linearVelocity.y*m.b2_maxTranslation*a.inv_dt);k=a.dt*c.m_angularVelocity;k*k>m.b2_maxRotationSquared&&(c.m_angularVelocity=0>c.m_angularVelocity?-m.b2_maxRotation*a.inv_dt:m.b2_maxRotation*a.inv_dt);c.m_sweep.c0.SetV(c.m_sweep.c);c.m_sweep.a0=c.m_sweep.a;c.m_sweep.c.x+=a.dt*c.m_linearVelocity.x;c.m_sweep.c.y+=a.dt*c.m_linearVelocity.y;c.m_sweep.a+=a.dt*c.m_angularVelocity;c.SynchronizeTransform()}for(b=
0;b<a.positionIterations;++b){k=f.SolvePositionConstraints(.75);q=!0;for(c=0;c<this.m_jointCount;++c)var t=this.m_joints[c].SolvePositionConstraints(m.b2_contactBaumgarte),q=q&&t;if(k&&q)break}this.Report(f.m_constraints)};M.prototype.Report=function(a){if(null!=this.m_listener)for(var c=0;c<this.m_contactCount;++c){for(var b=this.m_contacts[c],f=a[c],k=0;k<f.pointCount;++k)M.s_impulse.normalImpulses[k]=f.points[k].normalImpulse,M.s_impulse.tangentImpulses[k]=f.points[k].tangentImpulse;this.m_listener.PostSolve(b,
M.s_impulse)}};M.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a};M.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a};M.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new N});f.b2TimeStep=function(){};f.prototype.Set=function(a){this.dt=a.dt;this.inv_dt=a.inv_dt;this.positionIterations=a.positionIterations;this.velocityIterations=a.velocityIterations;
this.warmStarting=a.warmStarting};k.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new K;this.m_contactSolver=new D;this.m_island=new M};k.prototype.b2World=function(a,b){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;k.m_warmStarting=!0;k.m_continuousPhysics=!0;this.m_allowSleep=b;this.m_gravity=a;this.m_inv_dt0=0;this.m_contactManager.m_world=
this;this.m_groundBody=this.CreateBody(new L)};k.prototype.SetDestructionListener=function(a){this.m_destructionListener=a};k.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a};k.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a};k.prototype.SetDebugDraw=function(a){this.m_debugDraw=a};k.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var f=
c.m_fixtureList;f;f=f.m_next)f.m_proxy=a.CreateProxy(b.GetFatAABB(f.m_proxy),f)};k.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};k.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};k.prototype.CreateBody=function(a){if(1==this.IsLocked())return null;a=new e(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a};k.prototype.DestroyBody=function(a){if(1!=this.IsLocked()){for(var b=
a.m_jointList;b;){var c=b,b=b.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint);this.DestroyJoint(c.joint)}for(b=a.m_controllerList;b;)c=b,b=b.nextController,c.controller.RemoveBody(a);for(b=a.m_contactList;b;)c=b,b=b.next,this.m_contactManager.Destroy(c.contact);a.m_contactList=null;for(b=a.m_fixtureList;b;)c=b,b=b.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxy(this.m_contactManager.m_broadPhase),c.Destroy();a.m_fixtureList=
null;a.m_fixtureCount=0;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_bodyList&&(this.m_bodyList=a.m_next);--this.m_bodyCount}};k.prototype.CreateJoint=function(a){var b=Q.Create(a,null);b.m_prev=null;if(b.m_next=this.m_jointList)this.m_jointList.m_prev=b;this.m_jointList=b;++this.m_jointCount;b.m_edgeA.joint=b;b.m_edgeA.other=b.m_bodyB;b.m_edgeA.prev=null;if(b.m_edgeA.next=b.m_bodyA.m_jointList)b.m_bodyA.m_jointList.prev=b.m_edgeA;b.m_bodyA.m_jointList=b.m_edgeA;
b.m_edgeB.joint=b;b.m_edgeB.other=b.m_bodyA;b.m_edgeB.prev=null;if(b.m_edgeB.next=b.m_bodyB.m_jointList)b.m_bodyB.m_jointList.prev=b.m_edgeB;b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,f=a.bodyB;if(0==a.collideConnected)for(a=f.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next;return b};k.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_jointList&&(this.m_jointList=a.m_next);var c=
a.m_bodyA,f=a.m_bodyB;c.SetAwake(!0);f.SetAwake(!0);a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next);a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev);a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next);a.m_edgeA.prev=null;a.m_edgeA.next=null;a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next);a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev);a.m_edgeB==f.m_jointList&&(f.m_jointList=a.m_edgeB.next);a.m_edgeB.prev=null;a.m_edgeB.next=null;Q.Destroy(a,null);--this.m_jointCount;if(0==
b)for(a=f.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next};k.prototype.AddController=function(a){a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList=a;a.m_world=this;this.m_controllerCount++;return a};k.prototype.RemoveController=function(a){a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);this.m_controllerList==a&&(this.m_controllerList=a.m_next);this.m_controllerCount--};k.prototype.CreateController=function(a){if(a.m_world!=this)throw Error("Controller can only be a member of one world");
a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList&&(this.m_controllerList.m_prev=a);this.m_controllerList=a;++this.m_controllerCount;a.m_world=this;return a};k.prototype.DestroyController=function(a){a.Clear();a.m_next&&(a.m_next.m_prev=a.m_prev);a.m_prev&&(a.m_prev.m_next=a.m_next);a==this.m_controllerList&&(this.m_controllerList=a.m_next);--this.m_controllerCount};k.prototype.SetWarmStarting=function(a){k.m_warmStarting=a};k.prototype.SetContinuousPhysics=function(a){k.m_continuousPhysics=
a};k.prototype.GetBodyCount=function(){return this.m_bodyCount};k.prototype.GetJointCount=function(){return this.m_jointCount};k.prototype.GetContactCount=function(){return this.m_contactCount};k.prototype.SetGravity=function(a){this.m_gravity=a};k.prototype.GetGravity=function(){return this.m_gravity};k.prototype.GetGroundBody=function(){return this.m_groundBody};k.prototype.Step=function(a,b,f){void 0===a&&(a=0);void 0===b&&(b=0);void 0===f&&(f=0);this.m_flags&k.e_newFixture&&(this.m_contactManager.FindNewContacts(),
this.m_flags&=~k.e_newFixture);this.m_flags|=k.e_locked;var c=k.s_timestep2;c.dt=a;c.velocityIterations=b;c.positionIterations=f;c.inv_dt=0<a?1/a:0;c.dtRatio=this.m_inv_dt0*a;c.warmStarting=k.m_warmStarting;this.m_contactManager.Collide();0<c.dt&&this.Solve(c);k.m_continuousPhysics&&0<c.dt&&this.SolveTOI(c);0<c.dt&&(this.m_inv_dt0=c.inv_dt);this.m_flags&=~k.e_locked};k.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0};k.prototype.DrawDebugData=
function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var a=this.m_debugDraw.GetFlags(),b,f,q;new h;new h;new h;var t;new w;new w;new h;new h;new h;new h;var d=new l(0,0,0);if(a&C.e_shapeBit)for(b=this.m_bodyList;b;b=b.m_next)for(t=b.m_xf,f=b.GetFixtureList();f;f=f.m_next)q=f.GetShape(),0==b.IsActive()?d.Set(.5,.5,.3):b.GetType()==e.b2_staticBody?d.Set(.5,.9,.5):b.GetType()==e.b2_kinematicBody?d.Set(.5,.5,.9):0==b.IsAwake()?d.Set(.6,.6,.6):d.Set(.9,.7,.7),this.DrawShape(q,
t,d);if(a&C.e_jointBit)for(b=this.m_jointList;b;b=b.m_next)this.DrawJoint(b);if(a&C.e_controllerBit)for(b=this.m_controllerList;b;b=b.m_next)b.Draw(this.m_debugDraw);if(a&C.e_pairBit)for(d.Set(.3,.9,.9),b=this.m_contactManager.m_contactList;b;b=b.GetNext())q=b.GetFixtureA(),f=b.GetFixtureB(),q=q.GetAABB().GetCenter(),f=f.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(q,f,d);if(a&C.e_aabbBit)for(q=this.m_contactManager.m_broadPhase,t=[new h,new h,new h,new h],b=this.m_bodyList;b;b=b.GetNext())if(0!=
b.IsActive())for(f=b.GetFixtureList();f;f=f.GetNext()){var y=q.GetFatAABB(f.m_proxy);t[0].Set(y.lowerBound.x,y.lowerBound.y);t[1].Set(y.upperBound.x,y.lowerBound.y);t[2].Set(y.upperBound.x,y.upperBound.y);t[3].Set(y.lowerBound.x,y.upperBound.y);this.m_debugDraw.DrawPolygon(t,4,d)}if(a&C.e_centerOfMassBit)for(b=this.m_bodyList;b;b=b.m_next)t=k.s_xf,t.R=b.m_xf.R,t.position=b.GetWorldCenter(),this.m_debugDraw.DrawTransform(t)}};k.prototype.QueryAABB=function(a,b){var c=this.m_contactManager.m_broadPhase;
c.Query(function(b){return a(c.GetUserData(b))},b)};k.prototype.QueryShape=function(a,b,f){void 0===f&&(f=null);null==f&&(f=new d,f.SetIdentity());var c=this.m_contactManager.m_broadPhase,k=new w;b.ComputeAABB(k,f);c.Query(function(k){k=c.GetUserData(k)instanceof I?c.GetUserData(k):null;return P.TestOverlap(b,f,k.GetShape(),k.GetBody().GetTransform())?a(k):!0},k)};k.prototype.QueryPoint=function(a,b){var c=this.m_contactManager.m_broadPhase,f=new w;f.lowerBound.Set(b.x-m.b2_linearSlop,b.y-m.b2_linearSlop);
f.upperBound.Set(b.x+m.b2_linearSlop,b.y+m.b2_linearSlop);c.Query(function(f){f=c.GetUserData(f)instanceof I?c.GetUserData(f):null;return f.TestPoint(b)?a(f):!0},f)};k.prototype.RayCast=function(a,b,f){var c=this.m_contactManager.m_broadPhase,k=new F,g=new J(b,f);c.RayCast(function(g,q){var t=c.GetUserData(q),t=t instanceof I?t:null;if(t.RayCast(k,g)){var n=k.fraction,d=new h((1-n)*b.x+n*f.x,(1-n)*b.y+n*f.y);return a(t,d,k.normal,n)}return g.maxFraction},g)};k.prototype.RayCastOne=function(a,b){var c;
this.RayCast(function(a,b,f,k){void 0===k&&(k=0);c=a;return k},a,b);return c};k.prototype.RayCastAll=function(a,b){var c=new Vector;this.RayCast(function(a){c[c.length]=a;return 1},a,b);return c};k.prototype.GetBodyList=function(){return this.m_bodyList};k.prototype.GetJointList=function(){return this.m_jointList};k.prototype.GetContactList=function(){return this.m_contactList};k.prototype.IsLocked=function(){return 0<(this.m_flags&k.e_locked)};k.prototype.Solve=function(a){for(var b,c=this.m_controllerList;c;c=
c.m_next)c.Step(a);c=this.m_island;c.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~e.e_islandFlag;for(var f=this.m_contactList;f;f=f.m_next)f.m_flags&=~t.e_islandFlag;for(f=this.m_jointList;f;f=f.m_next)f.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var f=this.s_stack,k=this.m_bodyList;k;k=k.m_next)if(!(k.m_flags&e.e_islandFlag)&&0!=k.IsAwake()&&0!=k.IsActive()&&
k.GetType()!=e.b2_staticBody){c.Clear();var q=0;f[q++]=k;for(k.m_flags|=e.e_islandFlag;0<q;)if(b=f[--q],c.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=e.b2_staticBody){for(var d,y=b.m_contactList;y;y=y.next)y.contact.m_flags&t.e_islandFlag||1==y.contact.IsSensor()||0==y.contact.IsEnabled()||0==y.contact.IsTouching()||(c.AddContact(y.contact),y.contact.m_flags|=t.e_islandFlag,d=y.other,d.m_flags&e.e_islandFlag||(f[q++]=d,d.m_flags|=e.e_islandFlag));for(b=b.m_jointList;b;b=b.next)1!=b.joint.m_islandFlag&&
(d=b.other,0!=d.IsActive()&&(c.AddJoint(b.joint),b.joint.m_islandFlag=!0,d.m_flags&e.e_islandFlag||(f[q++]=d,d.m_flags|=e.e_islandFlag)))}c.Solve(a,this.m_gravity,this.m_allowSleep);for(q=0;q<c.m_bodyCount;++q)b=c.m_bodies[q],b.GetType()==e.b2_staticBody&&(b.m_flags&=~e.e_islandFlag)}for(q=0;q<f.length&&f[q];++q)f[q]=null;for(b=this.m_bodyList;b;b=b.m_next)0==b.IsAwake()||0==b.IsActive()||b.GetType()!=e.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};k.prototype.SolveTOI=
function(a){var b,c,f,q=this.m_island;q.Initialize(this.m_bodyCount,m.b2_maxTOIContactsPerIsland,m.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var d=k.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~e.e_islandFlag,b.m_sweep.t0=0;for(f=this.m_contactList;f;f=f.m_next)f.m_flags&=~(t.e_toiFlag|t.e_islandFlag);for(f=this.m_jointList;f;f=f.m_next)f.m_islandFlag=!1;for(;;){var y=null,h=1;for(f=this.m_contactList;f;f=f.m_next)if(1!=f.IsSensor()&&0!=
f.IsEnabled()&&0!=f.IsContinuous()){if(f.m_flags&t.e_toiFlag)b=f.m_toi;else{b=f.m_fixtureA;c=f.m_fixtureB;b=b.m_body;c=c.m_body;if(!(b.GetType()==e.b2_dynamicBody&&0!=b.IsAwake()||c.GetType()==e.b2_dynamicBody&&0!=c.IsAwake()))continue;var D=b.m_sweep.t0;b.m_sweep.t0<c.m_sweep.t0?(D=c.m_sweep.t0,b.m_sweep.Advance(D)):c.m_sweep.t0<b.m_sweep.t0&&(D=b.m_sweep.t0,c.m_sweep.Advance(D));b=f.ComputeTOI(b.m_sweep,c.m_sweep);m.b2Assert(0<=b&&1>=b);0<b&&1>b&&(b=(1-b)*D+b,1<b&&(b=1));f.m_toi=b;f.m_flags|=t.e_toiFlag}Number.MIN_VALUE<
b&&b<h&&(y=f,h=b)}if(null==y||1-100*Number.MIN_VALUE<h)break;b=y.m_fixtureA;c=y.m_fixtureB;b=b.m_body;c=c.m_body;k.s_backupA.Set(b.m_sweep);k.s_backupB.Set(c.m_sweep);b.Advance(h);c.Advance(h);y.Update(this.m_contactManager.m_contactListener);y.m_flags&=~t.e_toiFlag;if(1==y.IsSensor()||0==y.IsEnabled())b.m_sweep.Set(k.s_backupA),c.m_sweep.Set(k.s_backupB),b.SynchronizeTransform(),c.SynchronizeTransform();else if(0!=y.IsTouching()){b.GetType()!=e.b2_dynamicBody&&(b=c);q.Clear();y=f=0;d[f+y++]=b;for(b.m_flags|=
e.e_islandFlag;0<y;)if(b=d[f++],--y,q.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()==e.b2_dynamicBody){for(c=b.m_contactList;c&&q.m_contactCount!=q.m_contactCapacity;c=c.next)c.contact.m_flags&t.e_islandFlag||1==c.contact.IsSensor()||0==c.contact.IsEnabled()||0==c.contact.IsTouching()||(q.AddContact(c.contact),c.contact.m_flags|=t.e_islandFlag,D=c.other,D.m_flags&e.e_islandFlag||(D.GetType()!=e.b2_staticBody&&(D.Advance(h),D.SetAwake(!0)),d[f+y]=D,++y,D.m_flags|=e.e_islandFlag));for(b=b.m_jointList;b;b=
b.next)q.m_jointCount!=q.m_jointCapacity&&1!=b.joint.m_islandFlag&&(D=b.other,0!=D.IsActive()&&(q.AddJoint(b.joint),b.joint.m_islandFlag=!0,D.m_flags&e.e_islandFlag||(D.GetType()!=e.b2_staticBody&&(D.Advance(h),D.SetAwake(!0)),d[f+y]=D,++y,D.m_flags|=e.e_islandFlag)))}f=k.s_timestep;f.warmStarting=!1;f.dt=(1-h)*a.dt;f.inv_dt=1/f.dt;f.dtRatio=0;f.velocityIterations=a.velocityIterations;f.positionIterations=a.positionIterations;q.SolveTOI(f);for(h=h=0;h<q.m_bodyCount;++h)if(b=q.m_bodies[h],b.m_flags&=
~e.e_islandFlag,0!=b.IsAwake()&&b.GetType()==e.b2_dynamicBody)for(b.SynchronizeFixtures(),c=b.m_contactList;c;c=c.next)c.contact.m_flags&=~t.e_toiFlag;for(h=0;h<q.m_contactCount;++h)f=q.m_contacts[h],f.m_flags&=~(t.e_toiFlag|t.e_islandFlag);for(h=0;h<q.m_jointCount;++h)f=q.m_joints[h],f.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};k.prototype.DrawJoint=function(a){var b=a.GetBodyA(),c=a.GetBodyB(),f=b.m_xf.position,q=c.m_xf.position,t=a.GetAnchorA(),d=a.GetAnchorB(),e=k.s_jointColor;
switch(a.m_type){case Q.e_distanceJoint:this.m_debugDraw.DrawSegment(t,d,e);break;case Q.e_pulleyJoint:b=a instanceof y?a:null;a=b.GetGroundAnchorA();b=b.GetGroundAnchorB();this.m_debugDraw.DrawSegment(a,t,e);this.m_debugDraw.DrawSegment(b,d,e);this.m_debugDraw.DrawSegment(a,b,e);break;case Q.e_mouseJoint:this.m_debugDraw.DrawSegment(t,d,e);break;default:b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,t,e),this.m_debugDraw.DrawSegment(t,d,e),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(q,
d,e)}};k.prototype.DrawShape=function(b,f,k){switch(b.m_type){case P.e_circleShape:var c=b instanceof x?b:null;this.m_debugDraw.DrawSolidCircle(a.MulX(f,c.m_p),c.m_radius,f.R.col1,k);break;case P.e_polygonShape:c=b instanceof O?b:null;b=parseInt(c.GetVertexCount());for(var q=c.GetVertices(),g=new Vector(b),c=0;c<b;++c)g[c]=a.MulX(f,q[c]);this.m_debugDraw.DrawSolidPolygon(g,b,k);break;case P.e_edgeShape:c=b instanceof z?b:null,this.m_debugDraw.DrawSegment(a.MulX(f,c.GetVertex1()),a.MulX(f,c.GetVertex2()),
k)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new f;Box2D.Dynamics.b2World.s_xf=new d;Box2D.Dynamics.b2World.s_backupA=new b;Box2D.Dynamics.b2World.s_backupB=new b;Box2D.Dynamics.b2World.s_timestep=new f;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new l(.5,.8,.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();
(function(){var a=Box2D.Collision.Shapes.b2CircleShape,b=Box2D.Collision.Shapes.b2EdgeShape,d=Box2D.Collision.Shapes.b2PolygonShape,h=Box2D.Collision.Shapes.b2Shape,l=Box2D.Dynamics.Contacts.b2CircleContact,m=Box2D.Dynamics.Contacts.b2Contact,w=Box2D.Dynamics.Contacts.b2ContactConstraint,p=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,u=Box2D.Dynamics.Contacts.b2ContactEdge,J=Box2D.Dynamics.Contacts.b2ContactFactory,F=Box2D.Dynamics.Contacts.b2ContactRegister,x=Box2D.Dynamics.Contacts.b2ContactResult,
z=Box2D.Dynamics.Contacts.b2ContactSolver,v=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,O=Box2D.Dynamics.Contacts.b2NullContact,P=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,e=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,L=Box2D.Dynamics.Contacts.b2PolygonContact,B=Box2D.Dynamics.Contacts.b2PositionSolverManifold,N=Box2D.Dynamics.b2Body,E=Box2D.Dynamics.b2TimeStep,K=Box2D.Common.b2Settings,C=Box2D.Common.Math.b2Mat22,R=Box2D.Common.Math.b2Math,G=Box2D.Common.Math.b2Vec2,I=Box2D.Collision.b2Collision,
S=Box2D.Collision.b2ContactID,M=Box2D.Collision.b2Manifold,f=Box2D.Collision.b2TimeOfImpact,k=Box2D.Collision.b2TOIInput,t=Box2D.Collision.b2WorldManifold;Box2D.inherit(l,Box2D.Dynamics.Contacts.b2Contact);l.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;l.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};l.Create=function(){return new l};l.Destroy=function(){};l.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};l.prototype.Evaluate=
function(){var b=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody();I.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof a?this.m_fixtureA.GetShape():null,b.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,f.m_xf)};m.b2Contact=function(){this.m_nodeA=new u;this.m_nodeB=new u;this.m_manifold=new M;this.m_oldManifold=new M};m.prototype.GetManifold=function(){return this.m_manifold};m.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),
f=this.m_fixtureB.GetBody(),k=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),k.m_radius,f.GetTransform(),c.m_radius)};m.prototype.IsTouching=function(){return(this.m_flags&m.e_touchingFlag)==m.e_touchingFlag};m.prototype.IsContinuous=function(){return(this.m_flags&m.e_continuousFlag)==m.e_continuousFlag};m.prototype.SetSensor=function(a){this.m_flags=a?this.m_flags|m.e_sensorFlag:this.m_flags&~m.e_sensorFlag};m.prototype.IsSensor=function(){return(this.m_flags&
m.e_sensorFlag)==m.e_sensorFlag};m.prototype.SetEnabled=function(a){this.m_flags=a?this.m_flags|m.e_enabledFlag:this.m_flags&~m.e_enabledFlag};m.prototype.IsEnabled=function(){return(this.m_flags&m.e_enabledFlag)==m.e_enabledFlag};m.prototype.GetNext=function(){return this.m_next};m.prototype.GetFixtureA=function(){return this.m_fixtureA};m.prototype.GetFixtureB=function(){return this.m_fixtureB};m.prototype.FlagForFiltering=function(){this.m_flags|=m.e_filterFlag};m.prototype.b2Contact=function(){};
m.prototype.Reset=function(a,b){void 0===a&&(a=null);void 0===b&&(b=null);this.m_flags=m.e_enabledFlag;if(a&&b){if(a.IsSensor()||b.IsSensor())this.m_flags|=m.e_sensorFlag;var f=a.GetBody(),k=b.GetBody();if(f.GetType()!=N.b2_dynamicBody||f.IsBullet()||k.GetType()!=N.b2_dynamicBody||k.IsBullet())this.m_flags|=m.e_continuousFlag;this.m_fixtureA=a;this.m_fixtureB=b;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=
null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}else this.m_fixtureB=this.m_fixtureA=null};m.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=b;this.m_flags|=m.e_enabledFlag;var f=!1,b=(this.m_flags&m.e_touchingFlag)==m.e_touchingFlag,k=this.m_fixtureA.m_body,c=this.m_fixtureB.m_body,q=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&m.e_sensorFlag)q&&(f=this.m_fixtureA.GetShape(),
q=this.m_fixtureB.GetShape(),k=k.GetTransform(),c=c.GetTransform(),f=h.TestOverlap(f,k,q,c)),this.m_manifold.m_pointCount=0;else{k.GetType()!=N.b2_dynamicBody||k.IsBullet()||c.GetType()!=N.b2_dynamicBody||c.IsBullet()?this.m_flags|=m.e_continuousFlag:this.m_flags&=~m.e_continuousFlag;if(q)for(this.Evaluate(),f=0<this.m_manifold.m_pointCount,q=0;q<this.m_manifold.m_pointCount;++q){var t=this.m_manifold.m_points[q];t.m_normalImpulse=0;t.m_tangentImpulse=0;for(var d=t.m_id,e=0;e<this.m_oldManifold.m_pointCount;++e){var l=
this.m_oldManifold.m_points[e];if(l.m_id.key==d.key){t.m_normalImpulse=l.m_normalImpulse;t.m_tangentImpulse=l.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;f!=b&&(k.SetAwake(!0),c.SetAwake(!0))}this.m_flags=f?this.m_flags|m.e_touchingFlag:this.m_flags&~m.e_touchingFlag;0==b&&1==f&&a.BeginContact(this);1==b&&0==f&&a.EndContact(this);0==(this.m_flags&m.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)};m.prototype.Evaluate=function(){};m.prototype.ComputeTOI=function(a,b){m.s_input.proxyA.Set(this.m_fixtureA.GetShape());
m.s_input.proxyB.Set(this.m_fixtureB.GetShape());m.s_input.sweepA=a;m.s_input.sweepB=b;m.s_input.tolerance=K.b2_linearSlop;return f.TimeOfImpact(m.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=
64;Box2D.Dynamics.Contacts.b2Contact.s_input=new k});w.b2ContactConstraint=function(){this.localPlaneNormal=new G;this.localPoint=new G;this.normal=new G;this.normalMass=new C;this.K=new C};w.prototype.b2ContactConstraint=function(){this.points=new Vector(K.b2_maxManifoldPoints);for(var a=0;a<K.b2_maxManifoldPoints;a++)this.points[a]=new p};p.b2ContactConstraintPoint=function(){this.localPoint=new G;this.rA=new G;this.rB=new G};u.b2ContactEdge=function(){};J.b2ContactFactory=function(){};J.prototype.b2ContactFactory=
function(a){this.m_allocator=a;this.InitializeRegisters()};J.prototype.AddType=function(a,b,f,k){void 0===f&&(f=0);void 0===k&&(k=0);this.m_registers[f][k].createFcn=a;this.m_registers[f][k].destroyFcn=b;this.m_registers[f][k].primary=!0;f!=k&&(this.m_registers[k][f].createFcn=a,this.m_registers[k][f].destroyFcn=b,this.m_registers[k][f].primary=!1)};J.prototype.InitializeRegisters=function(){this.m_registers=new Vector(h.e_shapeTypeCount);for(var a=0;a<h.e_shapeTypeCount;a++){this.m_registers[a]=
new Vector(h.e_shapeTypeCount);for(var b=0;b<h.e_shapeTypeCount;b++)this.m_registers[a][b]=new F}this.AddType(l.Create,l.Destroy,h.e_circleShape,h.e_circleShape);this.AddType(P.Create,P.Destroy,h.e_polygonShape,h.e_circleShape);this.AddType(L.Create,L.Destroy,h.e_polygonShape,h.e_polygonShape);this.AddType(v.Create,v.Destroy,h.e_edgeShape,h.e_circleShape);this.AddType(e.Create,e.Destroy,h.e_polygonShape,h.e_edgeShape)};J.prototype.Create=function(a,b){var f=parseInt(a.GetType()),k=parseInt(b.GetType()),
f=this.m_registers[f][k];if(f.pool)return k=f.pool,f.pool=k.m_next,f.poolCount--,k.Reset(a,b),k;k=f.createFcn;return null!=k?(f.primary?(k=k(this.m_allocator),k.Reset(a,b)):(k=k(this.m_allocator),k.Reset(b,a)),k):null};J.prototype.Destroy=function(a){0<a.m_manifold.m_pointCount&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=parseInt(a.m_fixtureA.GetType()),f=parseInt(a.m_fixtureB.GetType()),b=this.m_registers[b][f];b.poolCount++;a.m_next=b.pool;b.pool=a;b=b.destroyFcn;
b(a,this.m_allocator)};F.b2ContactRegister=function(){};x.b2ContactResult=function(){this.position=new G;this.normal=new G;this.id=new S};z.b2ContactSolver=function(){this.m_step=new E;this.m_constraints=new Vector};z.prototype.b2ContactSolver=function(){};z.prototype.Initialize=function(a,b,f,k){void 0===f&&(f=0);var c;this.m_step.Set(a);this.m_allocator=k;for(this.m_constraintCount=f;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new w;for(a=0;a<
f;++a){c=b[a];k=c.m_fixtureA;var q=c.m_fixtureB,t=k.m_shape.m_radius,d=q.m_shape.m_radius,e=k.m_body,h=q.m_body,y=c.GetManifold(),D=K.b2MixFriction(k.GetFriction(),q.GetFriction()),l=K.b2MixRestitution(k.GetRestitution(),q.GetRestitution()),m=e.m_linearVelocity.x,Q=e.m_linearVelocity.y,p=h.m_linearVelocity.x,v=h.m_linearVelocity.y,u=e.m_angularVelocity,x=h.m_angularVelocity;K.b2Assert(0<y.m_pointCount);z.s_worldManifold.Initialize(y,e.m_xf,t,h.m_xf,d);q=z.s_worldManifold.m_normal.x;c=z.s_worldManifold.m_normal.y;
k=this.m_constraints[a];k.bodyA=e;k.bodyB=h;k.manifold=y;k.normal.x=q;k.normal.y=c;k.pointCount=y.m_pointCount;k.friction=D;k.restitution=l;k.localPlaneNormal.x=y.m_localPlaneNormal.x;k.localPlaneNormal.y=y.m_localPlaneNormal.y;k.localPoint.x=y.m_localPoint.x;k.localPoint.y=y.m_localPoint.y;k.radius=t+d;k.type=y.m_type;for(t=0;t<k.pointCount;++t){D=y.m_points[t];d=k.points[t];d.normalImpulse=D.m_normalImpulse;d.tangentImpulse=D.m_tangentImpulse;d.localPoint.SetV(D.m_localPoint);var D=d.rA.x=z.s_worldManifold.m_points[t].x-
e.m_sweep.c.x,l=d.rA.y=z.s_worldManifold.m_points[t].y-e.m_sweep.c.y,B=d.rB.x=z.s_worldManifold.m_points[t].x-h.m_sweep.c.x,C=d.rB.y=z.s_worldManifold.m_points[t].y-h.m_sweep.c.y,F=D*c-l*q,E=B*c-C*q,F=F*F,E=E*E;d.normalMass=1/(e.m_invMass+h.m_invMass+e.m_invI*F+h.m_invI*E);var G=e.m_mass*e.m_invMass+h.m_mass*h.m_invMass,G=G+(e.m_mass*e.m_invI*F+h.m_mass*h.m_invI*E);d.equalizedMass=1/G;E=c;G=-q;F=D*G-l*E;E=B*G-C*E;F*=F;E*=E;d.tangentMass=1/(e.m_invMass+h.m_invMass+e.m_invI*F+h.m_invI*E);d.velocityBias=
0;D=k.normal.x*(p+-x*C-m- -u*l)+k.normal.y*(v+x*B-Q-u*D);D<-K.b2_velocityThreshold&&(d.velocityBias+=-k.restitution*D)}2==k.pointCount&&(v=k.points[0],p=k.points[1],y=e.m_invMass,e=e.m_invI,m=h.m_invMass,h=h.m_invI,Q=v.rA.x*c-v.rA.y*q,v=v.rB.x*c-v.rB.y*q,u=p.rA.x*c-p.rA.y*q,p=p.rB.x*c-p.rB.y*q,q=y+m+e*Q*Q+h*v*v,c=y+m+e*u*u+h*p*p,h=y+m+e*Q*u+h*v*p,q*q<100*(q*c-h*h)?(k.K.col1.Set(q,h),k.K.col2.Set(h,c),k.K.GetInverse(k.normalMass)):k.pointCount=1)}};z.prototype.InitVelocityConstraints=function(a){for(var b=
0;b<this.m_constraintCount;++b){var f=this.m_constraints[b],k=f.bodyA,c=f.bodyB,q=k.m_invMass,t=k.m_invI,d=c.m_invMass,e=c.m_invI,h=f.normal.x,l=f.normal.y,m=l,p=-h,v,z;if(a.warmStarting)for(z=f.pointCount,v=0;v<z;++v){var u=f.points[v];u.normalImpulse*=a.dtRatio;u.tangentImpulse*=a.dtRatio;var x=u.normalImpulse*h+u.tangentImpulse*m,w=u.normalImpulse*l+u.tangentImpulse*p;k.m_angularVelocity-=t*(u.rA.x*w-u.rA.y*x);k.m_linearVelocity.x-=q*x;k.m_linearVelocity.y-=q*w;c.m_angularVelocity+=e*(u.rB.x*w-
u.rB.y*x);c.m_linearVelocity.x+=d*x;c.m_linearVelocity.y+=d*w}else for(z=f.pointCount,v=0;v<z;++v)k=f.points[v],k.normalImpulse=0,k.tangentImpulse=0}};z.prototype.SolveVelocityConstraints=function(){for(var a,b,f,k,c,g,t,d,e,h,l=0;l<this.m_constraintCount;++l){c=this.m_constraints[l];var m=c.bodyA,p=c.bodyB,v=m.m_angularVelocity,u=p.m_angularVelocity,z=m.m_linearVelocity,x=p.m_linearVelocity,w=m.m_invMass,B=m.m_invI,C=p.m_invMass,F=p.m_invI;d=c.normal.x;var E=e=c.normal.y;h=-d;t=c.friction;for(a=
0;a<c.pointCount;a++)b=c.points[a],f=x.x-u*b.rB.y-z.x+v*b.rA.y,k=x.y+u*b.rB.x-z.y-v*b.rA.x,f=f*E+k*h,f=b.tangentMass*-f,k=t*b.normalImpulse,k=R.Clamp(b.tangentImpulse+f,-k,k),f=k-b.tangentImpulse,g=f*E,f*=h,z.x-=w*g,z.y-=w*f,v-=B*(b.rA.x*f-b.rA.y*g),x.x+=C*g,x.y+=C*f,u+=F*(b.rB.x*f-b.rB.y*g),b.tangentImpulse=k;parseInt(c.pointCount);if(1==c.pointCount)b=c.points[0],f=x.x+-u*b.rB.y-z.x- -v*b.rA.y,k=x.y+u*b.rB.x-z.y-v*b.rA.x,c=f*d+k*e,f=-b.normalMass*(c-b.velocityBias),k=b.normalImpulse+f,k=0<k?k:0,
f=k-b.normalImpulse,g=f*d,f*=e,z.x-=w*g,z.y-=w*f,v-=B*(b.rA.x*f-b.rA.y*g),x.x+=C*g,x.y+=C*f,u+=F*(b.rB.x*f-b.rB.y*g),b.normalImpulse=k;else{b=c.points[0];a=c.points[1];f=b.normalImpulse;t=a.normalImpulse;var G=(x.x-u*b.rB.y-z.x+v*b.rA.y)*d+(x.y+u*b.rB.x-z.y-v*b.rA.x)*e,O=(x.x-u*a.rB.y-z.x+v*a.rA.y)*d+(x.y+u*a.rB.x-z.y-v*a.rA.x)*e;k=G-b.velocityBias;g=O-a.velocityBias;h=c.K;k-=h.col1.x*f+h.col2.x*t;for(g-=h.col1.y*f+h.col2.y*t;;){h=c.normalMass;E=-(h.col1.x*k+h.col2.x*g);h=-(h.col1.y*k+h.col2.y*g);
if(0<=E&&0<=h){f=E-f;t=h-t;c=f*d;f*=e;d*=t;e*=t;z.x-=w*(c+d);z.y-=w*(f+e);v-=B*(b.rA.x*f-b.rA.y*c+a.rA.x*e-a.rA.y*d);x.x+=C*(c+d);x.y+=C*(f+e);u+=F*(b.rB.x*f-b.rB.y*c+a.rB.x*e-a.rB.y*d);b.normalImpulse=E;a.normalImpulse=h;break}E=-b.normalMass*k;h=0;O=c.K.col1.y*E+g;if(0<=E&&0<=O){f=E-f;t=h-t;c=f*d;f*=e;d*=t;e*=t;z.x-=w*(c+d);z.y-=w*(f+e);v-=B*(b.rA.x*f-b.rA.y*c+a.rA.x*e-a.rA.y*d);x.x+=C*(c+d);x.y+=C*(f+e);u+=F*(b.rB.x*f-b.rB.y*c+a.rB.x*e-a.rB.y*d);b.normalImpulse=E;a.normalImpulse=h;break}E=0;h=
-a.normalMass*g;G=c.K.col2.x*h+k;if(0<=h&&0<=G){f=E-f;t=h-t;c=f*d;f*=e;d*=t;e*=t;z.x-=w*(c+d);z.y-=w*(f+e);v-=B*(b.rA.x*f-b.rA.y*c+a.rA.x*e-a.rA.y*d);x.x+=C*(c+d);x.y+=C*(f+e);u+=F*(b.rB.x*f-b.rB.y*c+a.rB.x*e-a.rB.y*d);b.normalImpulse=E;a.normalImpulse=h;break}h=E=0;G=k;O=g;if(0<=G&&0<=O){f=E-f;t=h-t;c=f*d;f*=e;d*=t;e*=t;z.x-=w*(c+d);z.y-=w*(f+e);v-=B*(b.rA.x*f-b.rA.y*c+a.rA.x*e-a.rA.y*d);x.x+=C*(c+d);x.y+=C*(f+e);u+=F*(b.rB.x*f-b.rB.y*c+a.rB.x*e-a.rB.y*d);b.normalImpulse=E;a.normalImpulse=h;break}break}}m.m_angularVelocity=
v;p.m_angularVelocity=u}};z.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],f=b.manifold,k=0;k<b.pointCount;++k){var c=f.m_points[k],t=b.points[k];c.m_normalImpulse=t.normalImpulse;c.m_tangentImpulse=t.tangentImpulse}};z.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);for(var b=0,f=0;f<this.m_constraintCount;f++){var k=this.m_constraints[f],c=k.bodyA,q=k.bodyB,t=c.m_mass*c.m_invMass,d=c.m_mass*c.m_invI,e=q.m_mass*
q.m_invMass,h=q.m_mass*q.m_invI;z.s_psm.Initialize(k);for(var l=z.s_psm.m_normal,m=0;m<k.pointCount;m++){var p=k.points[m],v=z.s_psm.m_points[m],u=z.s_psm.m_separations[m],x=v.x-c.m_sweep.c.x,w=v.y-c.m_sweep.c.y,B=v.x-q.m_sweep.c.x,v=v.y-q.m_sweep.c.y,b=b<u?b:u,u=R.Clamp(a*(u+K.b2_linearSlop),-K.b2_maxLinearCorrection,0),u=-p.equalizedMass*u,p=u*l.x,u=u*l.y;c.m_sweep.c.x-=t*p;c.m_sweep.c.y-=t*u;c.m_sweep.a-=d*(x*u-w*p);c.SynchronizeTransform();q.m_sweep.c.x+=e*p;q.m_sweep.c.y+=e*u;q.m_sweep.a+=h*
(B*u-v*p);q.SynchronizeTransform()}}return b>-1.5*K.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new t;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new B});Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact);v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;v.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(){return new v};v.Destroy=function(){};v.prototype.Reset=
function(a,b){this.__super.Reset.call(this,a,b)};v.prototype.Evaluate=function(){var f=this.m_fixtureA.GetBody(),k=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof b?this.m_fixtureA.GetShape():null,f.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,k.m_xf)};v.prototype.b2CollideEdgeAndCircle=function(){};Box2D.inherit(O,Box2D.Dynamics.Contacts.b2Contact);O.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
O.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};O.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};O.prototype.Evaluate=function(){};Box2D.inherit(P,Box2D.Dynamics.Contacts.b2Contact);P.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;P.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};P.Create=function(){return new P};P.Destroy=function(){};P.prototype.Reset=function(a,
b){this.__super.Reset.call(this,a,b);K.b2Assert(a.GetType()==h.e_polygonShape);K.b2Assert(b.GetType()==h.e_circleShape)};P.prototype.Evaluate=function(){var b=this.m_fixtureA.m_body,f=this.m_fixtureB.m_body;I.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():null,b.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,f.m_xf)};Box2D.inherit(e,Box2D.Dynamics.Contacts.b2Contact);e.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
e.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};e.Create=function(){return new e};e.Destroy=function(){};e.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b);K.b2Assert(a.GetType()==h.e_polygonShape);K.b2Assert(b.GetType()==h.e_edgeShape)};e.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():
null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,f.m_xf)};e.prototype.b2CollidePolyAndEdge=function(){};Box2D.inherit(L,Box2D.Dynamics.Contacts.b2Contact);L.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;L.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};L.Create=function(){return new L};L.Destroy=function(){};L.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};L.prototype.Evaluate=function(){var a=
this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();I.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof d?this.m_fixtureB.GetShape():null,b.m_xf)};B.b2PositionSolverManifold=function(){};B.prototype.b2PositionSolverManifold=function(){this.m_normal=new G;this.m_separations=new Vector_a2j_Number(K.b2_maxManifoldPoints);this.m_points=new Vector(K.b2_maxManifoldPoints);for(var a=0;a<K.b2_maxManifoldPoints;a++)this.m_points[a]=
new G};B.prototype.Initialize=function(a){K.b2Assert(0<a.pointCount);var b,f,k,c,t,q;switch(a.type){case M.e_circles:c=a.bodyA.m_xf.R;k=a.localPoint;b=a.bodyA.m_xf.position.x+(c.col1.x*k.x+c.col2.x*k.y);f=a.bodyA.m_xf.position.y+(c.col1.y*k.x+c.col2.y*k.y);c=a.bodyB.m_xf.R;k=a.points[0].localPoint;t=a.bodyB.m_xf.position.x+(c.col1.x*k.x+c.col2.x*k.y);c=a.bodyB.m_xf.position.y+(c.col1.y*k.x+c.col2.y*k.y);k=t-b;q=c-f;var d=k*k+q*q;d>Number.MIN_VALUE*Number.MIN_VALUE?(d=Math.sqrt(d),this.m_normal.x=
k/d,this.m_normal.y=q/d):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=.5*(b+t);this.m_points[0].y=.5*(f+c);this.m_separations[0]=k*this.m_normal.x+q*this.m_normal.y-a.radius;break;case M.e_faceA:c=a.bodyA.m_xf.R;k=a.localPlaneNormal;this.m_normal.x=c.col1.x*k.x+c.col2.x*k.y;this.m_normal.y=c.col1.y*k.x+c.col2.y*k.y;c=a.bodyA.m_xf.R;k=a.localPoint;t=a.bodyA.m_xf.position.x+(c.col1.x*k.x+c.col2.x*k.y);q=a.bodyA.m_xf.position.y+(c.col1.y*k.x+c.col2.y*k.y);c=a.bodyB.m_xf.R;for(b=0;b<a.pointCount;++b)k=
a.points[b].localPoint,f=a.bodyB.m_xf.position.x+(c.col1.x*k.x+c.col2.x*k.y),k=a.bodyB.m_xf.position.y+(c.col1.y*k.x+c.col2.y*k.y),this.m_separations[b]=(f-t)*this.m_normal.x+(k-q)*this.m_normal.y-a.radius,this.m_points[b].x=f,this.m_points[b].y=k;break;case M.e_faceB:c=a.bodyB.m_xf.R;k=a.localPlaneNormal;this.m_normal.x=c.col1.x*k.x+c.col2.x*k.y;this.m_normal.y=c.col1.y*k.x+c.col2.y*k.y;c=a.bodyB.m_xf.R;k=a.localPoint;t=a.bodyB.m_xf.position.x+(c.col1.x*k.x+c.col2.x*k.y);q=a.bodyB.m_xf.position.y+
(c.col1.y*k.x+c.col2.y*k.y);c=a.bodyA.m_xf.R;for(b=0;b<a.pointCount;++b)k=a.points[b].localPoint,f=a.bodyA.m_xf.position.x+(c.col1.x*k.x+c.col2.x*k.y),k=a.bodyA.m_xf.position.y+(c.col1.y*k.x+c.col2.y*k.y),this.m_separations[b]=(f-t)*this.m_normal.x+(k-q)*this.m_normal.y-a.radius,this.m_points[b].Set(f,k);this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new G;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=
new G})})();
(function(){var a=Box2D.Common.Math.b2Mat22,b=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Vec2,h=Box2D.Common.b2Color,l=Box2D.Dynamics.Controllers.b2BuoyancyController,m=Box2D.Dynamics.Controllers.b2ConstantAccelController,w=Box2D.Dynamics.Controllers.b2ConstantForceController,p=Box2D.Dynamics.Controllers.b2Controller,u=Box2D.Dynamics.Controllers.b2ControllerEdge,J=Box2D.Dynamics.Controllers.b2GravityController,F=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(l,Box2D.Dynamics.Controllers.b2Controller);
l.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;l.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new d(0,-1);this.density=this.offset=0;this.velocity=new d(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};l.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var a=this.m_bodyList;a;a=
a.nextBody){var b=a.body;if(0!=b.IsAwake()){for(var h=new d,l=new d,m=0,e=0,p=b.GetFixtureList();p;p=p.GetNext()){var u=new d,w=p.GetShape().ComputeSubmergedArea(this.normal,this.offset,b.GetTransform(),u),m=m+w;h.x+=w*u.x;h.y+=w*u.y;e+=1*w;l.x+=w*u.x*1;l.y+=w*u.y*1}h.x/=m;h.y/=m;l.x/=e;l.y/=e;m<Number.MIN_VALUE||(e=this.gravity.GetNegative(),e.Multiply(this.density*m),b.ApplyForce(e,l),l=b.GetLinearVelocityFromWorldPoint(h),l.Subtract(this.velocity),l.Multiply(-this.linearDrag*m),b.ApplyForce(l,
h),b.ApplyTorque(-b.GetInertia()/b.GetMass()*m*b.GetAngularVelocity()*this.angularDrag))}}}};l.prototype.Draw=function(a){var b=new d,l=new d;b.x=this.normal.x*this.offset+1E3*this.normal.y;b.y=this.normal.y*this.offset-1E3*this.normal.x;l.x=this.normal.x*this.offset-1E3*this.normal.y;l.y=this.normal.y*this.offset+1E3*this.normal.x;var m=new h(0,0,1);a.DrawSegment(b,l,m)};Box2D.inherit(m,Box2D.Dynamics.Controllers.b2Controller);m.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
m.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new d(0,0)};m.prototype.Step=function(a){a=new d(this.A.x*a.dt,this.A.y*a.dt);for(var b=this.m_bodyList;b;b=b.nextBody){var h=b.body;h.IsAwake()&&h.SetLinearVelocity(new d(h.GetLinearVelocity().x+a.x,h.GetLinearVelocity().y+a.y))}};Box2D.inherit(w,Box2D.Dynamics.Controllers.b2Controller);w.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;w.b2ConstantForceController=
function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new d(0,0)};w.prototype.Step=function(){for(var a=this.m_bodyList;a;a=a.nextBody){var b=a.body;b.IsAwake()&&b.ApplyForce(this.F,b.GetWorldCenter())}};p.b2Controller=function(){};p.prototype.Step=function(){};p.prototype.Draw=function(){};p.prototype.AddBody=function(a){var b=new u;b.controller=this;b.body=a;b.nextBody=this.m_bodyList;b.prevBody=null;this.m_bodyList=b;b.nextBody&&(b.nextBody.prevBody=b);this.m_bodyCount++;
b.nextController=a.m_controllerList;b.prevController=null;a.m_controllerList=b;b.nextController&&(b.nextController.prevController=b);a.m_controllerCount++};p.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody);b.nextBody&&(b.nextBody.prevBody=b.prevBody);b.nextController&&(b.nextController.prevController=b.prevController);b.prevController&&(b.prevController.nextController=b.nextController);this.m_bodyList==
b&&(this.m_bodyList=b.nextBody);a.m_controllerList==b&&(a.m_controllerList=b.nextController);a.m_controllerCount--;this.m_bodyCount--};p.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};p.prototype.GetNext=function(){return this.m_next};p.prototype.GetWorld=function(){return this.m_world};p.prototype.GetBodyList=function(){return this.m_bodyList};u.b2ControllerEdge=function(){};Box2D.inherit(J,Box2D.Dynamics.Controllers.b2Controller);J.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
J.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};J.prototype.Step=function(){var a,b,h,l,m,e,p,u,w,E;if(this.invSqr)for(a=this.m_bodyList;a;a=a.nextBody)for(b=a.body,h=b.GetWorldCenter(),l=b.GetMass(),m=this.m_bodyList;m!=a;m=m.nextBody)e=m.body,p=e.GetWorldCenter(),u=p.x-h.x,w=p.y-h.y,E=u*u+w*w,E<Number.MIN_VALUE||(u=new d(u,w),u.Multiply(this.G/E/Math.sqrt(E)*l*e.GetMass()),b.IsAwake()&&b.ApplyForce(u,h),u.Multiply(-1),
e.IsAwake()&&e.ApplyForce(u,p));else for(a=this.m_bodyList;a;a=a.nextBody)for(b=a.body,h=b.GetWorldCenter(),l=b.GetMass(),m=this.m_bodyList;m!=a;m=m.nextBody)e=m.body,p=e.GetWorldCenter(),u=p.x-h.x,w=p.y-h.y,E=u*u+w*w,E<Number.MIN_VALUE||(u=new d(u,w),u.Multiply(this.G/E*l*e.GetMass()),b.IsAwake()&&b.ApplyForce(u,h),u.Multiply(-1),e.IsAwake()&&e.ApplyForce(u,p))};Box2D.inherit(F,Box2D.Dynamics.Controllers.b2Controller);F.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;F.b2TensorDampingController=
function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new a;this.maxTimestep=0};F.prototype.SetAxisAligned=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.T.col1.x=-a;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-b;this.maxTimestep=0<a||0<b?1/Math.max(a,b):0};F.prototype.Step=function(a){a=a.dt;if(!(a<=Number.MIN_VALUE)){a>this.maxTimestep&&0<this.maxTimestep&&(a=this.maxTimestep);for(var h=this.m_bodyList;h;h=h.nextBody){var l=h.body;if(l.IsAwake()){var m=
l.GetWorldVector(b.MulMV(this.T,l.GetLocalVector(l.GetLinearVelocity())));l.SetLinearVelocity(new d(l.GetLinearVelocity().x+m.x*a,l.GetLinearVelocity().y+m.y*a))}}}}})();
(function(){var a=Box2D.Common.b2Settings,b=Box2D.Common.Math.b2Mat22,d=Box2D.Common.Math.b2Mat33,h=Box2D.Common.Math.b2Math,l=Box2D.Common.Math.b2Vec2,m=Box2D.Common.Math.b2Vec3,w=Box2D.Dynamics.Joints.b2DistanceJoint,p=Box2D.Dynamics.Joints.b2DistanceJointDef,u=Box2D.Dynamics.Joints.b2FrictionJoint,J=Box2D.Dynamics.Joints.b2FrictionJointDef,F=Box2D.Dynamics.Joints.b2GearJoint,x=Box2D.Dynamics.Joints.b2GearJointDef,z=Box2D.Dynamics.Joints.b2Jacobian,v=Box2D.Dynamics.Joints.b2Joint,O=Box2D.Dynamics.Joints.b2JointDef,
P=Box2D.Dynamics.Joints.b2JointEdge,e=Box2D.Dynamics.Joints.b2LineJoint,L=Box2D.Dynamics.Joints.b2LineJointDef,B=Box2D.Dynamics.Joints.b2MouseJoint,N=Box2D.Dynamics.Joints.b2MouseJointDef,E=Box2D.Dynamics.Joints.b2PrismaticJoint,K=Box2D.Dynamics.Joints.b2PrismaticJointDef,C=Box2D.Dynamics.Joints.b2PulleyJoint,R=Box2D.Dynamics.Joints.b2PulleyJointDef,G=Box2D.Dynamics.Joints.b2RevoluteJoint,I=Box2D.Dynamics.Joints.b2RevoluteJointDef,S=Box2D.Dynamics.Joints.b2WeldJoint,M=Box2D.Dynamics.Joints.b2WeldJointDef;
Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint);w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;w.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_u=new l};w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};w.prototype.GetReactionForce=function(a){void 0===a&&(a=0);
return new l(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)};w.prototype.GetReactionTorque=function(){return 0};w.prototype.GetLength=function(){return this.m_length};w.prototype.SetLength=function(a){void 0===a&&(a=0);this.m_length=a};w.prototype.GetFrequency=function(){return this.m_frequencyHz};w.prototype.SetFrequency=function(a){void 0===a&&(a=0);this.m_frequencyHz=a};w.prototype.GetDampingRatio=function(){return this.m_dampingRatio};w.prototype.SetDampingRatio=function(a){void 0===
a&&(a=0);this.m_dampingRatio=a};w.prototype.b2DistanceJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};w.prototype.InitVelocityConstraints=function(b){var f,t,q=this.m_bodyA,d=this.m_bodyB;f=q.m_xf.R;var h=this.m_localAnchor1.x-q.m_sweep.localCenter.x,e=this.m_localAnchor1.y-q.m_sweep.localCenter.y;
t=f.col1.x*h+f.col2.x*e;e=f.col1.y*h+f.col2.y*e;h=t;f=d.m_xf.R;var c=this.m_localAnchor2.x-d.m_sweep.localCenter.x,g=this.m_localAnchor2.y-d.m_sweep.localCenter.y;t=f.col1.x*c+f.col2.x*g;g=f.col1.y*c+f.col2.y*g;c=t;this.m_u.x=d.m_sweep.c.x+c-q.m_sweep.c.x-h;this.m_u.y=d.m_sweep.c.y+g-q.m_sweep.c.y-e;t=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);t>a.b2_linearSlop?this.m_u.Multiply(1/t):this.m_u.SetZero();f=h*this.m_u.y-e*this.m_u.x;var l=c*this.m_u.y-g*this.m_u.x;f=q.m_invMass+q.m_invI*
f*f+d.m_invMass+d.m_invI*l*l;this.m_mass=0!=f?1/f:0;if(0<this.m_frequencyHz){t-=this.m_length;var l=2*Math.PI*this.m_frequencyHz,n=this.m_mass*l*l;this.m_gamma=b.dt*(2*this.m_mass*this.m_dampingRatio*l+b.dt*n);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=t*b.dt*n*this.m_gamma;this.m_mass=f+this.m_gamma;this.m_mass=0!=this.m_mass?1/this.m_mass:0}b.warmStarting?(this.m_impulse*=b.dtRatio,b=this.m_impulse*this.m_u.x,f=this.m_impulse*this.m_u.y,q.m_linearVelocity.x-=q.m_invMass*b,q.m_linearVelocity.y-=
q.m_invMass*f,q.m_angularVelocity-=q.m_invI*(h*f-e*b),d.m_linearVelocity.x+=d.m_invMass*b,d.m_linearVelocity.y+=d.m_invMass*f,d.m_angularVelocity+=d.m_invI*(c*f-g*b)):this.m_impulse=0};w.prototype.SolveVelocityConstraints=function(){var a,b=this.m_bodyA,t=this.m_bodyB;a=b.m_xf.R;var q=this.m_localAnchor1.x-b.m_sweep.localCenter.x,d=this.m_localAnchor1.y-b.m_sweep.localCenter.y,h=a.col1.x*q+a.col2.x*d,d=a.col1.y*q+a.col2.y*d,q=h;a=t.m_xf.R;var e=this.m_localAnchor2.x-t.m_sweep.localCenter.x,c=this.m_localAnchor2.y-
t.m_sweep.localCenter.y,h=a.col1.x*e+a.col2.x*c,c=a.col1.y*e+a.col2.y*c,e=h,h=-this.m_mass*(this.m_u.x*(t.m_linearVelocity.x+-t.m_angularVelocity*c-(b.m_linearVelocity.x+-b.m_angularVelocity*d))+this.m_u.y*(t.m_linearVelocity.y+t.m_angularVelocity*e-(b.m_linearVelocity.y+b.m_angularVelocity*q))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;a=h*this.m_u.x;h*=this.m_u.y;b.m_linearVelocity.x-=b.m_invMass*a;b.m_linearVelocity.y-=b.m_invMass*h;b.m_angularVelocity-=b.m_invI*(q*h-d*a);t.m_linearVelocity.x+=
t.m_invMass*a;t.m_linearVelocity.y+=t.m_invMass*h;t.m_angularVelocity+=t.m_invI*(e*h-c*a)};w.prototype.SolvePositionConstraints=function(){var b;if(0<this.m_frequencyHz)return!0;var k=this.m_bodyA,t=this.m_bodyB;b=k.m_xf.R;var q=this.m_localAnchor1.x-k.m_sweep.localCenter.x,d=this.m_localAnchor1.y-k.m_sweep.localCenter.y,e=b.col1.x*q+b.col2.x*d,d=b.col1.y*q+b.col2.y*d,q=e;b=t.m_xf.R;var l=this.m_localAnchor2.x-t.m_sweep.localCenter.x,c=this.m_localAnchor2.y-t.m_sweep.localCenter.y,e=b.col1.x*l+b.col2.x*
c,c=b.col1.y*l+b.col2.y*c,l=e,e=t.m_sweep.c.x+l-k.m_sweep.c.x-q,g=t.m_sweep.c.y+c-k.m_sweep.c.y-d;b=Math.sqrt(e*e+g*g);e/=b;g/=b;b-=this.m_length;b=h.Clamp(b,-a.b2_maxLinearCorrection,a.b2_maxLinearCorrection);var m=-this.m_mass*b;this.m_u.Set(e,g);e=m*this.m_u.x;g=m*this.m_u.y;k.m_sweep.c.x-=k.m_invMass*e;k.m_sweep.c.y-=k.m_invMass*g;k.m_sweep.a-=k.m_invI*(q*g-d*e);t.m_sweep.c.x+=t.m_invMass*e;t.m_sweep.c.y+=t.m_invMass*g;t.m_sweep.a+=t.m_invI*(l*g-c*e);k.SynchronizeTransform();t.SynchronizeTransform();
return h.Abs(b)<a.b2_linearSlop};Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef);p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;p.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};p.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};p.prototype.Initialize=function(a,b,t,q){this.bodyA=
a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(t));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(q));a=q.x-t.x;t=q.y-t.y;this.length=Math.sqrt(a*a+t*t);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint);u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;u.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new l;this.m_localAnchorB=new l;this.m_linearMass=new b;this.m_linearImpulse=
new l};u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};u.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new l(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)};u.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_angularImpulse};u.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.m_maxForce=a};u.prototype.GetMaxForce=function(){return this.m_maxForce};
u.prototype.SetMaxTorque=function(a){void 0===a&&(a=0);this.m_maxTorque=a};u.prototype.GetMaxTorque=function(){return this.m_maxTorque};u.prototype.b2FrictionJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque};u.prototype.InitVelocityConstraints=function(a){var f,
t,q=this.m_bodyA,d=this.m_bodyB;f=q.m_xf.R;var e=this.m_localAnchorA.x-q.m_sweep.localCenter.x,h=this.m_localAnchorA.y-q.m_sweep.localCenter.y;t=f.col1.x*e+f.col2.x*h;h=f.col1.y*e+f.col2.y*h;e=t;f=d.m_xf.R;var c=this.m_localAnchorB.x-d.m_sweep.localCenter.x,g=this.m_localAnchorB.y-d.m_sweep.localCenter.y;t=f.col1.x*c+f.col2.x*g;g=f.col1.y*c+f.col2.y*g;c=t;f=q.m_invMass;t=d.m_invMass;var l=q.m_invI,n=d.m_invI,m=new b;m.col1.x=f+t;m.col2.x=0;m.col1.y=0;m.col2.y=f+t;m.col1.x+=l*h*h;m.col2.x+=-l*e*h;
m.col1.y+=-l*e*h;m.col2.y+=l*e*e;m.col1.x+=n*g*g;m.col2.x+=-n*c*g;m.col1.y+=-n*c*g;m.col2.y+=n*c*c;m.GetInverse(this.m_linearMass);this.m_angularMass=l+n;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);a.warmStarting?(this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,q.m_linearVelocity.x-=f*a.x,q.m_linearVelocity.y-=f*a.y,q.m_angularVelocity-=l*(e*a.y-h*a.x+this.m_angularImpulse),d.m_linearVelocity.x+=t*a.x,
d.m_linearVelocity.y+=t*a.y,d.m_angularVelocity+=n*(c*a.y-g*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};u.prototype.SolveVelocityConstraints=function(a){var b,f,d=this.m_bodyA,e=this.m_bodyB,m=d.m_linearVelocity,y=d.m_angularVelocity,c=e.m_linearVelocity,g=e.m_angularVelocity,r=d.m_invMass,n=e.m_invMass,p=d.m_invI,u=e.m_invI;b=d.m_xf.R;var v=this.m_localAnchorA.x-d.m_sweep.localCenter.x,w=this.m_localAnchorA.y-d.m_sweep.localCenter.y;f=b.col1.x*v+b.col2.x*
w;w=b.col1.y*v+b.col2.y*w;v=f;b=e.m_xf.R;var x=this.m_localAnchorB.x-e.m_sweep.localCenter.x,z=this.m_localAnchorB.y-e.m_sweep.localCenter.y;f=b.col1.x*x+b.col2.x*z;z=b.col1.y*x+b.col2.y*z;x=f;f=-this.m_angularMass*(g-y);var B=this.m_angularImpulse;b=a.dt*this.m_maxTorque;this.m_angularImpulse=h.Clamp(this.m_angularImpulse+f,-b,b);f=this.m_angularImpulse-B;y-=p*f;g+=u*f;b=h.MulMV(this.m_linearMass,new l(-(c.x-g*z-m.x+y*w),-(c.y+g*x-m.y-y*v)));f=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(b);
b=a.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b));b=h.SubtractVV(this.m_linearImpulse,f);m.x-=r*b.x;m.y-=r*b.y;y-=p*(v*b.y-w*b.x);c.x+=n*b.x;c.y+=n*b.y;g+=u*(x*b.y-z*b.x);d.m_angularVelocity=y;e.m_angularVelocity=g};u.prototype.SolvePositionConstraints=function(){return!0};Box2D.inherit(J,Box2D.Dynamics.Joints.b2JointDef);J.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;J.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new l;this.localAnchorB=new l};J.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_frictionJoint;this.maxTorque=this.maxForce=0};J.prototype.Initialize=function(a,b,t){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(t));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(t))};Box2D.inherit(F,Box2D.Dynamics.Joints.b2Joint);F.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;F.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_groundAnchor1=new l;this.m_groundAnchor2=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_J=new z};F.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};F.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};F.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new l(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)};F.prototype.GetReactionTorque=function(a){void 0===
a&&(a=0);var b=this.m_bodyB.m_xf.R,f=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*f+b.col2.x*d,d=b.col1.y*f+b.col2.y*d;return a*(this.m_impulse*this.m_J.angularB-e*this.m_impulse*this.m_J.linearB.y+d*this.m_impulse*this.m_J.linearB.x)};F.prototype.GetRatio=function(){return this.m_ratio};F.prototype.SetRatio=function(a){void 0===a&&(a=0);this.m_ratio=a};F.prototype.b2GearJoint=function(a){this.__super.b2Joint.call(this,
a);var b=parseInt(a.joint1.m_type),f=parseInt(a.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;this.m_ground1=a.joint1.GetBodyA();this.m_bodyA=a.joint1.GetBodyB();b==v.e_revoluteJoint?(this.m_revolute1=a.joint1 instanceof G?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),b=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof E?a.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),
this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),b=this.m_prismatic1.GetJointTranslation());this.m_ground2=a.joint2.GetBodyA();this.m_bodyB=a.joint2.GetBodyB();f==v.e_revoluteJoint?(this.m_revolute2=a.joint2 instanceof G?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),f=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof E?a.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),
this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),f=this.m_prismatic2.GetJointTranslation());this.m_ratio=a.ratio;this.m_constant=b+this.m_ratio*f;this.m_impulse=0};F.prototype.InitVelocityConstraints=function(a){var b=this.m_ground1,f=this.m_ground2,d=this.m_bodyA,e=this.m_bodyB,h,l,c,g,m,n=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,n+=d.m_invI):(b=b.m_xf.R,l=this.m_prismatic1.m_localXAxis1,h=b.col1.x*l.x+b.col2.x*l.y,l=b.col1.y*l.x+b.col2.y*l.y,b=d.m_xf.R,c=this.m_localAnchor1.x-
d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y,m=b.col1.x*c+b.col2.x*g,g=b.col1.y*c+b.col2.y*g,c=m*l-g*h,this.m_J.linearA.Set(-h,-l),this.m_J.angularA=-c,n+=d.m_invMass+d.m_invI*c*c);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,n+=this.m_ratio*this.m_ratio*e.m_invI):(b=f.m_xf.R,l=this.m_prismatic2.m_localXAxis1,h=b.col1.x*l.x+b.col2.x*l.y,l=b.col1.y*l.x+b.col2.y*l.y,b=e.m_xf.R,c=this.m_localAnchor2.x-e.m_sweep.localCenter.x,g=this.m_localAnchor2.y-e.m_sweep.localCenter.y,
m=b.col1.x*c+b.col2.x*g,g=b.col1.y*c+b.col2.y*g,c=m*l-g*h,this.m_J.linearB.Set(-this.m_ratio*h,-this.m_ratio*l),this.m_J.angularB=-this.m_ratio*c,n+=this.m_ratio*this.m_ratio*(e.m_invMass+e.m_invI*c*c));this.m_mass=0<n?1/n:0;a.warmStarting?(d.m_linearVelocity.x+=d.m_invMass*this.m_impulse*this.m_J.linearA.x,d.m_linearVelocity.y+=d.m_invMass*this.m_impulse*this.m_J.linearA.y,d.m_angularVelocity+=d.m_invI*this.m_impulse*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*this.m_impulse*this.m_J.linearB.x,
e.m_linearVelocity.y+=e.m_invMass*this.m_impulse*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};F.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,d=-this.m_mass*this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);this.m_impulse+=d;a.m_linearVelocity.x+=a.m_invMass*d*this.m_J.linearA.x;a.m_linearVelocity.y+=a.m_invMass*d*this.m_J.linearA.y;a.m_angularVelocity+=a.m_invI*
d*this.m_J.angularA;b.m_linearVelocity.x+=b.m_invMass*d*this.m_J.linearB.x;b.m_linearVelocity.y+=b.m_invMass*d*this.m_J.linearB.y;b.m_angularVelocity+=b.m_invI*d*this.m_J.angularB};F.prototype.SolvePositionConstraints=function(){var b=this.m_bodyA,k=this.m_bodyB,d,q;d=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();q=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();d=-this.m_mass*(this.m_constant-(d+this.m_ratio*q));
b.m_sweep.c.x+=b.m_invMass*d*this.m_J.linearA.x;b.m_sweep.c.y+=b.m_invMass*d*this.m_J.linearA.y;b.m_sweep.a+=b.m_invI*d*this.m_J.angularA;k.m_sweep.c.x+=k.m_invMass*d*this.m_J.linearB.x;k.m_sweep.c.y+=k.m_invMass*d*this.m_J.linearB.y;k.m_sweep.a+=k.m_invI*d*this.m_J.angularB;b.SynchronizeTransform();k.SynchronizeTransform();return 0<a.b2_linearSlop};Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef);x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;x.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments)};x.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};z.b2Jacobian=function(){this.linearA=new l;this.linearB=new l};z.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};z.prototype.Set=function(a,b,d,q){void 0===b&&(b=0);void 0===q&&(q=0);this.linearA.SetV(a);this.angularA=b;this.linearB.SetV(d);this.angularB=q};z.prototype.Compute=function(a,
b,d,q){void 0===b&&(b=0);void 0===q&&(q=0);return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*d.x+this.linearB.y*d.y)+this.angularB*q};v.b2Joint=function(){this.m_edgeA=new P;this.m_edgeB=new P;this.m_localCenterA=new l;this.m_localCenterB=new l};v.prototype.GetType=function(){return this.m_type};v.prototype.GetAnchorA=function(){return null};v.prototype.GetAnchorB=function(){return null};v.prototype.GetReactionForce=function(){return null};v.prototype.GetReactionTorque=
function(){return 0};v.prototype.GetBodyA=function(){return this.m_bodyA};v.prototype.GetBodyB=function(){return this.m_bodyB};v.prototype.GetNext=function(){return this.m_next};v.prototype.GetUserData=function(){return this.m_userData};v.prototype.SetUserData=function(a){this.m_userData=a};v.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};v.Create=function(a){var b=null;switch(a.type){case v.e_distanceJoint:b=new w(a instanceof p?a:null);break;case v.e_mouseJoint:b=
new B(a instanceof N?a:null);break;case v.e_prismaticJoint:b=new E(a instanceof K?a:null);break;case v.e_revoluteJoint:b=new G(a instanceof I?a:null);break;case v.e_pulleyJoint:b=new C(a instanceof R?a:null);break;case v.e_gearJoint:b=new F(a instanceof x?a:null);break;case v.e_lineJoint:b=new e(a instanceof L?a:null);break;case v.e_weldJoint:b=new S(a instanceof M?a:null);break;case v.e_frictionJoint:b=new u(a instanceof J?a:null)}return b};v.Destroy=function(){};v.prototype.b2Joint=function(b){a.b2Assert(b.bodyA!=
b.bodyB);this.m_type=b.type;this.m_next=this.m_prev=null;this.m_bodyA=b.bodyA;this.m_bodyB=b.bodyB;this.m_collideConnected=b.collideConnected;this.m_islandFlag=!1;this.m_userData=b.userData};v.prototype.InitVelocityConstraints=function(){};v.prototype.SolveVelocityConstraints=function(){};v.prototype.FinalizeVelocityConstraints=function(){};v.prototype.SolvePositionConstraints=function(){return!1};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=
1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=
2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});O.b2JointDef=function(){};O.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};P.b2JointEdge=function(){};Box2D.inherit(e,Box2D.Dynamics.Joints.b2Joint);e.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;e.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_localXAxis1=new l;this.m_localYAxis1=
new l;this.m_axis=new l;this.m_perp=new l;this.m_K=new b;this.m_impulse=new l};e.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};e.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};e.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new l(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};
e.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.y};e.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,d=a.GetWorldPoint(this.m_localAnchor1),q=b.GetWorldPoint(this.m_localAnchor2),b=q.x-d.x,d=q.y-d.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*d};e.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,d;d=a.m_xf.R;var q=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,
h=d.col1.x*q+d.col2.x*e,e=d.col1.y*q+d.col2.y*e,q=h;d=b.m_xf.R;var l=this.m_localAnchor2.x-b.m_sweep.localCenter.x,c=this.m_localAnchor2.y-b.m_sweep.localCenter.y,h=d.col1.x*l+d.col2.x*c,c=d.col1.y*l+d.col2.y*c,l=h;d=b.m_sweep.c.x+l-(a.m_sweep.c.x+q);var h=b.m_sweep.c.y+c-(a.m_sweep.c.y+e),g=a.GetWorldVector(this.m_localXAxis1),m=a.m_linearVelocity,n=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return d*-a*g.y+h*a*g.x+(g.x*(n.x+-b*c-m.x- -a*e)+g.y*(n.y+b*l-m.y-a*q))};e.prototype.IsLimitEnabled=
function(){return this.m_enableLimit};e.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};e.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};e.prototype.GetUpperLimit=function(){return this.m_upperTranslation};e.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};e.prototype.IsMotorEnabled=function(){return this.m_enableMotor};
e.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};e.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};e.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};e.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};e.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};
e.prototype.GetMotorForce=function(){return this.m_motorImpulse};e.prototype.b2LineJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=
a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};e.prototype.InitVelocityConstraints=function(b){var f=this.m_bodyA,d=this.m_bodyB,q,e;this.m_localCenterA.SetV(f.GetLocalCenter());this.m_localCenterB.SetV(d.GetLocalCenter());var l=f.GetTransform();d.GetTransform();q=f.m_xf.R;var m=this.m_localAnchor1.x-this.m_localCenterA.x,c=this.m_localAnchor1.y-this.m_localCenterA.y;
e=q.col1.x*m+q.col2.x*c;c=q.col1.y*m+q.col2.y*c;m=e;q=d.m_xf.R;var g=this.m_localAnchor2.x-this.m_localCenterB.x,r=this.m_localAnchor2.y-this.m_localCenterB.y;e=q.col1.x*g+q.col2.x*r;r=q.col1.y*g+q.col2.y*r;g=e;q=d.m_sweep.c.x+g-f.m_sweep.c.x-m;e=d.m_sweep.c.y+r-f.m_sweep.c.y-c;this.m_invMassA=f.m_invMass;this.m_invMassB=d.m_invMass;this.m_invIA=f.m_invI;this.m_invIB=d.m_invI;this.m_axis.SetV(h.MulMV(l.R,this.m_localXAxis1));this.m_a1=(q+m)*this.m_axis.y-(e+c)*this.m_axis.x;this.m_a2=g*this.m_axis.y-
r*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(h.MulMV(l.R,this.m_localYAxis1));this.m_s1=(q+m)*this.m_perp.y-(e+c)*this.m_perp.x;this.m_s2=g*this.m_perp.y-r*this.m_perp.x;l=this.m_invMassA;m=this.m_invMassB;c=this.m_invIA;g=this.m_invIB;this.m_K.col1.x=l+m+c*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2;this.m_K.col1.y=c*this.m_s1*
this.m_a1+g*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=l+m+c*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2;this.m_enableLimit?(q=this.m_axis.x*q+this.m_axis.y*e,h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?this.m_limitState=v.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=v.e_atLowerLimit&&(this.m_limitState=v.e_atLowerLimit,this.m_impulse.y=0):q>=this.m_upperTranslation?this.m_limitState!=v.e_atUpperLimit&&(this.m_limitState=v.e_atUpperLimit,
this.m_impulse.y=0):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=v.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);b.warmStarting?(this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio,b=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,q=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,e=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*
this.m_a1,l=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,f.m_linearVelocity.x-=this.m_invMassA*b,f.m_linearVelocity.y-=this.m_invMassA*q,f.m_angularVelocity-=this.m_invIA*e,d.m_linearVelocity.x+=this.m_invMassB*b,d.m_linearVelocity.y+=this.m_invMassB*q,d.m_angularVelocity+=this.m_invIB*l):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};e.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,f=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,m=f.m_linearVelocity,
p=f.m_angularVelocity,c,g,r,n;this.m_enableMotor&&this.m_limitState!=v.e_equalLimits&&(n=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(m.x-d.x)+this.m_axis.y*(m.y-d.y)+this.m_a2*p-this.m_a1*e)),c=this.m_motorImpulse,g=a.dt*this.m_maxMotorForce,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+n,-g,g),n=this.m_motorImpulse-c,c=n*this.m_axis.x,g=n*this.m_axis.y,r=n*this.m_a1,n*=this.m_a2,d.x-=this.m_invMassA*c,d.y-=this.m_invMassA*g,e-=this.m_invIA*r,m.x+=this.m_invMassB*c,m.y+=this.m_invMassB*
g,p+=this.m_invIB*n);g=this.m_perp.x*(m.x-d.x)+this.m_perp.y*(m.y-d.y)+this.m_s2*p-this.m_s1*e;this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit?(r=this.m_axis.x*(m.x-d.x)+this.m_axis.y*(m.y-d.y)+this.m_a2*p-this.m_a1*e,c=this.m_impulse.Copy(),a=this.m_K.Solve(new l,-g,-r),this.m_impulse.Add(a),this.m_limitState==v.e_atLowerLimit?this.m_impulse.y=h.Max(this.m_impulse.y,0):this.m_limitState==v.e_atUpperLimit&&(this.m_impulse.y=h.Min(this.m_impulse.y,0)),g=-g-(this.m_impulse.y-c.y)*this.m_K.col2.x,
r=0!=this.m_K.col1.x?g/this.m_K.col1.x+c.x:c.x,this.m_impulse.x=r,a.x=this.m_impulse.x-c.x,a.y=this.m_impulse.y-c.y,c=a.x*this.m_perp.x+a.y*this.m_axis.x,g=a.x*this.m_perp.y+a.y*this.m_axis.y,r=a.x*this.m_s1+a.y*this.m_a1,n=a.x*this.m_s2+a.y*this.m_a2):(a=0!=this.m_K.col1.x?-g/this.m_K.col1.x:0,this.m_impulse.x+=a,c=a*this.m_perp.x,g=a*this.m_perp.y,r=a*this.m_s1,n=a*this.m_s2);d.x-=this.m_invMassA*c;d.y-=this.m_invMassA*g;e-=this.m_invIA*r;m.x+=this.m_invMassB*c;m.y+=this.m_invMassB*g;p+=this.m_invIB*
n;b.m_linearVelocity.SetV(d);b.m_angularVelocity=e;f.m_linearVelocity.SetV(m);f.m_angularVelocity=p};e.prototype.SolvePositionConstraints=function(){var f=this.m_bodyA,k=this.m_bodyB,d=f.m_sweep.c,e=f.m_sweep.a,m=k.m_sweep.c,p=k.m_sweep.a,y,c,g,r,n,u=0,v;g=!1;var w=0,x=b.FromAngle(e);r=b.FromAngle(p);y=x;v=this.m_localAnchor1.x-this.m_localCenterA.x;var z=this.m_localAnchor1.y-this.m_localCenterA.y;c=y.col1.x*v+y.col2.x*z;z=y.col1.y*v+y.col2.y*z;v=c;y=r;r=this.m_localAnchor2.x-this.m_localCenterB.x;
n=this.m_localAnchor2.y-this.m_localCenterB.y;c=y.col1.x*r+y.col2.x*n;n=y.col1.y*r+y.col2.y*n;r=c;y=m.x+r-d.x-v;c=m.y+n-d.y-z;if(this.m_enableLimit){this.m_axis=h.MulMV(x,this.m_localXAxis1);this.m_a1=(y+v)*this.m_axis.y-(c+z)*this.m_axis.x;this.m_a2=r*this.m_axis.y-n*this.m_axis.x;var B=this.m_axis.x*y+this.m_axis.y*c;h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?(w=h.Clamp(B,-a.b2_maxLinearCorrection,a.b2_maxLinearCorrection),u=h.Abs(B),g=!0):B<=this.m_lowerTranslation?
(w=h.Clamp(B-this.m_lowerTranslation+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),u=this.m_lowerTranslation-B,g=!0):B>=this.m_upperTranslation&&(w=h.Clamp(B-this.m_upperTranslation+a.b2_linearSlop,0,a.b2_maxLinearCorrection),u=B-this.m_upperTranslation,g=!0)}this.m_perp=h.MulMV(x,this.m_localYAxis1);this.m_s1=(y+v)*this.m_perp.y-(c+z)*this.m_perp.x;this.m_s2=r*this.m_perp.y-n*this.m_perp.x;x=new l;z=this.m_perp.x*y+this.m_perp.y*c;u=h.Max(u,h.Abs(z));v=0;g?(g=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,
y=this.m_invIB,this.m_K.col1.x=g+r+n*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.col1.y=n*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=g+r+n*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_K.Solve(x,-z,-w)):(g=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,y=this.m_invIB,w=g+r+n*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,x.x=0!=w?-z/w:0,x.y=0);w=x.x*this.m_perp.x+x.y*this.m_axis.x;g=x.x*this.m_perp.y+x.y*this.m_axis.y;z=x.x*this.m_s1+x.y*this.m_a1;
x=x.x*this.m_s2+x.y*this.m_a2;d.x-=this.m_invMassA*w;d.y-=this.m_invMassA*g;e-=this.m_invIA*z;m.x+=this.m_invMassB*w;m.y+=this.m_invMassB*g;p+=this.m_invIB*x;f.m_sweep.a=e;k.m_sweep.a=p;f.SynchronizeTransform();k.SynchronizeTransform();return u<=a.b2_linearSlop&&v<=a.b2_angularSlop};Box2D.inherit(L,Box2D.Dynamics.Joints.b2JointDef);L.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;L.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=
new l;this.localAnchorB=new l;this.localAxisA=new l};L.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};L.prototype.Initialize=function(a,b,d,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=this.bodyA.GetLocalVector(e)};
Box2D.inherit(B,Box2D.Dynamics.Joints.b2Joint);B.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;B.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new b;this.K1=new b;this.K2=new b;this.m_localAnchor=new l;this.m_target=new l;this.m_impulse=new l;this.m_mass=new b;this.m_C=new l};B.prototype.GetAnchorA=function(){return this.m_target};B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};B.prototype.GetReactionForce=
function(a){void 0===a&&(a=0);return new l(a*this.m_impulse.x,a*this.m_impulse.y)};B.prototype.GetReactionTorque=function(){return 0};B.prototype.GetTarget=function(){return this.m_target};B.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_target=a};B.prototype.GetMaxForce=function(){return this.m_maxForce};B.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.m_maxForce=a};B.prototype.GetFrequency=function(){return this.m_frequencyHz};B.prototype.SetFrequency=
function(a){void 0===a&&(a=0);this.m_frequencyHz=a};B.prototype.GetDampingRatio=function(){return this.m_dampingRatio};B.prototype.SetDampingRatio=function(a){void 0===a&&(a=0);this.m_dampingRatio=a};B.prototype.b2MouseJoint=function(a){this.__super.b2Joint.call(this,a);this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,f=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+f*d.col1.y;this.m_localAnchor.y=b*d.col2.x+f*d.col2.y;
this.m_maxForce=a.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_beta=0};B.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,f=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,e=f*d*d;this.m_gamma=a.dt*(2*f*this.m_dampingRatio*d+a.dt*e);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_beta=a.dt*e*this.m_gamma;var e=b.m_xf.R,f=this.m_localAnchor.x-b.m_sweep.localCenter.x,d=this.m_localAnchor.y-b.m_sweep.localCenter.y,
h=e.col1.x*f+e.col2.x*d,d=e.col1.y*f+e.col2.y*d,f=h,e=b.m_invMass,h=b.m_invI;this.K1.col1.x=e;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=e;this.K2.col1.x=h*d*d;this.K2.col2.x=-h*f*d;this.K2.col1.y=-h*f*d;this.K2.col2.y=h*f*f;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=b.m_sweep.c.x+f-this.m_target.x;this.m_C.y=b.m_sweep.c.y+d-this.m_target.y;b.m_angularVelocity*=.98;this.m_impulse.x*=a.dtRatio;this.m_impulse.y*=
a.dtRatio;b.m_linearVelocity.x+=e*this.m_impulse.x;b.m_linearVelocity.y+=e*this.m_impulse.y;b.m_angularVelocity+=h*(f*this.m_impulse.y-d*this.m_impulse.x)};B.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyB,f,d,e;f=b.m_xf.R;var h=this.m_localAnchor.x-b.m_sweep.localCenter.x,l=this.m_localAnchor.y-b.m_sweep.localCenter.y;d=f.col1.x*h+f.col2.x*l;l=f.col1.y*h+f.col2.y*l;h=d;d=b.m_linearVelocity.x+-b.m_angularVelocity*l;var c=b.m_linearVelocity.y+b.m_angularVelocity*h;f=this.m_mass;d=
d+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;e=c+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;c=-(f.col1.x*d+f.col2.x*e);e=-(f.col1.y*d+f.col2.y*e);f=this.m_impulse.x;d=this.m_impulse.y;this.m_impulse.x+=c;this.m_impulse.y+=e;a=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length());c=this.m_impulse.x-f;e=this.m_impulse.y-d;b.m_linearVelocity.x+=b.m_invMass*c;b.m_linearVelocity.y+=b.m_invMass*e;b.m_angularVelocity+=b.m_invI*(h*
e-l*c)};B.prototype.SolvePositionConstraints=function(){return!0};Box2D.inherit(N,Box2D.Dynamics.Joints.b2JointDef);N.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;N.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new l};N.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(E,Box2D.Dynamics.Joints.b2Joint);E.prototype.__super=
Box2D.Dynamics.Joints.b2Joint.prototype;E.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_localXAxis1=new l;this.m_localYAxis1=new l;this.m_axis=new l;this.m_perp=new l;this.m_K=new d;this.m_impulse=new m};E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};E.prototype.GetReactionForce=
function(a){void 0===a&&(a=0);return new l(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};E.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.y};E.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,d=a.GetWorldPoint(this.m_localAnchor1),e=b.GetWorldPoint(this.m_localAnchor2),b=e.x-d.x,d=e.y-d.y,a=a.GetWorldVector(this.m_localXAxis1);
return a.x*b+a.y*d};E.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,d;d=a.m_xf.R;var e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,h=this.m_localAnchor1.y-a.m_sweep.localCenter.y,l=d.col1.x*e+d.col2.x*h,h=d.col1.y*e+d.col2.y*h,e=l;d=b.m_xf.R;var m=this.m_localAnchor2.x-b.m_sweep.localCenter.x,c=this.m_localAnchor2.y-b.m_sweep.localCenter.y,l=d.col1.x*m+d.col2.x*c,c=d.col1.y*m+d.col2.y*c,m=l;d=b.m_sweep.c.x+m-(a.m_sweep.c.x+e);var l=b.m_sweep.c.y+c-(a.m_sweep.c.y+h),g=a.GetWorldVector(this.m_localXAxis1),
r=a.m_linearVelocity,n=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return d*-a*g.y+l*a*g.x+(g.x*(n.x+-b*c-r.x- -a*h)+g.y*(n.y+b*m-r.y-a*e))};E.prototype.IsLimitEnabled=function(){return this.m_enableLimit};E.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};E.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};E.prototype.GetUpperLimit=function(){return this.m_upperTranslation};E.prototype.SetLimits=function(a,
b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};E.prototype.IsMotorEnabled=function(){return this.m_enableMotor};E.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};E.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};E.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};
E.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};E.prototype.GetMotorForce=function(){return this.m_motorImpulse};E.prototype.b2PrismaticJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=a.referenceAngle;
this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};E.prototype.InitVelocityConstraints=function(b){var f=this.m_bodyA,d=this.m_bodyB,e,l;this.m_localCenterA.SetV(f.GetLocalCenter());this.m_localCenterB.SetV(d.GetLocalCenter());
var m=f.GetTransform();d.GetTransform();e=f.m_xf.R;var p=this.m_localAnchor1.x-this.m_localCenterA.x,c=this.m_localAnchor1.y-this.m_localCenterA.y;l=e.col1.x*p+e.col2.x*c;c=e.col1.y*p+e.col2.y*c;p=l;e=d.m_xf.R;var g=this.m_localAnchor2.x-this.m_localCenterB.x,r=this.m_localAnchor2.y-this.m_localCenterB.y;l=e.col1.x*g+e.col2.x*r;r=e.col1.y*g+e.col2.y*r;g=l;e=d.m_sweep.c.x+g-f.m_sweep.c.x-p;l=d.m_sweep.c.y+r-f.m_sweep.c.y-c;this.m_invMassA=f.m_invMass;this.m_invMassB=d.m_invMass;this.m_invIA=f.m_invI;
this.m_invIB=d.m_invI;this.m_axis.SetV(h.MulMV(m.R,this.m_localXAxis1));this.m_a1=(e+p)*this.m_axis.y-(l+c)*this.m_axis.x;this.m_a2=g*this.m_axis.y-r*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);this.m_perp.SetV(h.MulMV(m.R,this.m_localYAxis1));this.m_s1=(e+p)*this.m_perp.y-(l+c)*this.m_perp.x;this.m_s2=g*this.m_perp.y-r*this.m_perp.x;m=this.m_invMassA;
p=this.m_invMassB;c=this.m_invIA;g=this.m_invIB;this.m_K.col1.x=m+p+c*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2;this.m_K.col1.y=c*this.m_s1+g*this.m_s2;this.m_K.col1.z=c*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=c+g;this.m_K.col2.z=c*this.m_a1+g*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=m+p+c*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2;this.m_enableLimit?(e=this.m_axis.x*e+this.m_axis.y*l,h.Abs(this.m_upperTranslation-
this.m_lowerTranslation)<2*a.b2_linearSlop?this.m_limitState=v.e_equalLimits:e<=this.m_lowerTranslation?this.m_limitState!=v.e_atLowerLimit&&(this.m_limitState=v.e_atLowerLimit,this.m_impulse.z=0):e>=this.m_upperTranslation?this.m_limitState!=v.e_atUpperLimit&&(this.m_limitState=v.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=v.e_inactiveLimit;0==this.m_enableMotor&&(this.m_motorImpulse=0);b.warmStarting?(this.m_impulse.x*=b.dtRatio,
this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio,b=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,e=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,l=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,m=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,f.m_linearVelocity.x-=this.m_invMassA*b,f.m_linearVelocity.y-=this.m_invMassA*e,
f.m_angularVelocity-=this.m_invIA*l,d.m_linearVelocity.x+=this.m_invMassB*b,d.m_linearVelocity.y+=this.m_invMassB*e,d.m_angularVelocity+=this.m_invIB*m):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};E.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,f=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,p=f.m_linearVelocity,y=f.m_angularVelocity,c,g,r,n;this.m_enableMotor&&this.m_limitState!=v.e_equalLimits&&(n=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(p.x-d.x)+this.m_axis.y*
(p.y-d.y)+this.m_a2*y-this.m_a1*e)),c=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+n,-a,a),n=this.m_motorImpulse-c,c=n*this.m_axis.x,g=n*this.m_axis.y,r=n*this.m_a1,n*=this.m_a2,d.x-=this.m_invMassA*c,d.y-=this.m_invMassA*g,e-=this.m_invIA*r,p.x+=this.m_invMassB*c,p.y+=this.m_invMassB*g,y+=this.m_invIB*n);r=this.m_perp.x*(p.x-d.x)+this.m_perp.y*(p.y-d.y)+this.m_s2*y-this.m_s1*e;g=y-e;this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit?(a=this.m_axis.x*
(p.x-d.x)+this.m_axis.y*(p.y-d.y)+this.m_a2*y-this.m_a1*e,c=this.m_impulse.Copy(),a=this.m_K.Solve33(new m,-r,-g,-a),this.m_impulse.Add(a),this.m_limitState==v.e_atLowerLimit?this.m_impulse.z=h.Max(this.m_impulse.z,0):this.m_limitState==v.e_atUpperLimit&&(this.m_impulse.z=h.Min(this.m_impulse.z,0)),r=-r-(this.m_impulse.z-c.z)*this.m_K.col3.x,g=-g-(this.m_impulse.z-c.z)*this.m_K.col3.y,g=this.m_K.Solve22(new l,r,g),g.x+=c.x,g.y+=c.y,this.m_impulse.x=g.x,this.m_impulse.y=g.y,a.x=this.m_impulse.x-c.x,
a.y=this.m_impulse.y-c.y,a.z=this.m_impulse.z-c.z,c=a.x*this.m_perp.x+a.z*this.m_axis.x,g=a.x*this.m_perp.y+a.z*this.m_axis.y,r=a.x*this.m_s1+a.y+a.z*this.m_a1,n=a.x*this.m_s2+a.y+a.z*this.m_a2):(a=this.m_K.Solve22(new l,-r,-g),this.m_impulse.x+=a.x,this.m_impulse.y+=a.y,c=a.x*this.m_perp.x,g=a.x*this.m_perp.y,r=a.x*this.m_s1+a.y,n=a.x*this.m_s2+a.y);d.x-=this.m_invMassA*c;d.y-=this.m_invMassA*g;e-=this.m_invIA*r;p.x+=this.m_invMassB*c;p.y+=this.m_invMassB*g;y+=this.m_invIB*n;b.m_linearVelocity.SetV(d);
b.m_angularVelocity=e;f.m_linearVelocity.SetV(p);f.m_angularVelocity=y};E.prototype.SolvePositionConstraints=function(){var f=this.m_bodyA,d=this.m_bodyB,e=f.m_sweep.c,q=f.m_sweep.a,p=d.m_sweep.c,u=d.m_sweep.a,y,c,g,r,n=0,v;g=!1;var w=0,x=b.FromAngle(q),z=b.FromAngle(u);y=x;v=this.m_localAnchor1.x-this.m_localCenterA.x;var B=this.m_localAnchor1.y-this.m_localCenterA.y;c=y.col1.x*v+y.col2.x*B;B=y.col1.y*v+y.col2.y*B;v=c;y=z;z=this.m_localAnchor2.x-this.m_localCenterB.x;r=this.m_localAnchor2.y-this.m_localCenterB.y;
c=y.col1.x*z+y.col2.x*r;r=y.col1.y*z+y.col2.y*r;z=c;y=p.x+z-e.x-v;c=p.y+r-e.y-B;if(this.m_enableLimit){this.m_axis=h.MulMV(x,this.m_localXAxis1);this.m_a1=(y+v)*this.m_axis.y-(c+B)*this.m_axis.x;this.m_a2=z*this.m_axis.y-r*this.m_axis.x;var C=this.m_axis.x*y+this.m_axis.y*c;h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?(w=h.Clamp(C,-a.b2_maxLinearCorrection,a.b2_maxLinearCorrection),n=h.Abs(C),g=!0):C<=this.m_lowerTranslation?(w=h.Clamp(C-this.m_lowerTranslation+a.b2_linearSlop,
-a.b2_maxLinearCorrection,0),n=this.m_lowerTranslation-C,g=!0):C>=this.m_upperTranslation&&(w=h.Clamp(C-this.m_upperTranslation+a.b2_linearSlop,0,a.b2_maxLinearCorrection),n=C-this.m_upperTranslation,g=!0)}this.m_perp=h.MulMV(x,this.m_localYAxis1);this.m_s1=(y+v)*this.m_perp.y-(c+B)*this.m_perp.x;this.m_s2=z*this.m_perp.y-r*this.m_perp.x;x=new m;B=this.m_perp.x*y+this.m_perp.y*c;z=u-q-this.m_refAngle;n=h.Max(n,h.Abs(B));v=h.Abs(z);g?(g=this.m_invMassA,r=this.m_invMassB,y=this.m_invIA,c=this.m_invIB,
this.m_K.col1.x=g+r+y*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1+c*this.m_s2,this.m_K.col1.z=y*this.m_s1*this.m_a1+c*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=y+c,this.m_K.col2.z=y*this.m_a1+c*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=g+r+y*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2,this.m_K.Solve33(x,-B,-z,-w)):(g=this.m_invMassA,r=this.m_invMassB,y=this.m_invIA,c=this.m_invIB,w=y*this.m_s1+c*this.m_s2,
C=y+c,this.m_K.col1.Set(g+r+y*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,w,0),this.m_K.col2.Set(w,C,0),w=this.m_K.Solve22(new l,-B,-z),x.x=w.x,x.y=w.y,x.z=0);w=x.x*this.m_perp.x+x.z*this.m_axis.x;g=x.x*this.m_perp.y+x.z*this.m_axis.y;B=x.x*this.m_s1+x.y+x.z*this.m_a1;x=x.x*this.m_s2+x.y+x.z*this.m_a2;e.x-=this.m_invMassA*w;e.y-=this.m_invMassA*g;q-=this.m_invIA*B;p.x+=this.m_invMassB*w;p.y+=this.m_invMassB*g;u+=this.m_invIB*x;f.m_sweep.a=q;d.m_sweep.a=u;f.SynchronizeTransform();d.SynchronizeTransform();
return n<=a.b2_linearSlop&&v<=a.b2_angularSlop};Box2D.inherit(K,Box2D.Dynamics.Joints.b2JointDef);K.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;K.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l;this.localAxisA=new l};K.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=
!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};K.prototype.Initialize=function(a,b,d,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=this.bodyA.GetLocalVector(e);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint);C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;C.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_groundAnchor1=new l;this.m_groundAnchor2=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_u1=new l;this.m_u2=new l};C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};C.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new l(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)};C.prototype.GetReactionTorque=function(){return 0};
C.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor1);return a};C.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor2);return a};C.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(b*b+a*a)};C.prototype.GetLength2=function(){var a=
this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(b*b+a*a)};C.prototype.GetRatio=function(){return this.m_ratio};C.prototype.b2PulleyJoint=function(a){this.__super.b2Joint.call(this,a);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y;
this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_ratio=a.ratio;this.m_constant=a.lengthA+this.m_ratio*a.lengthB;this.m_maxLength1=h.Min(a.maxLengthA,this.m_constant-this.m_ratio*C.b2_minPulleyLength);this.m_maxLength2=h.Min(a.maxLengthB,(this.m_constant-C.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=
this.m_impulse=0};C.prototype.InitVelocityConstraints=function(b){var f=this.m_bodyA,d=this.m_bodyB,e;e=f.m_xf.R;var h=this.m_localAnchor1.x-f.m_sweep.localCenter.x,l=this.m_localAnchor1.y-f.m_sweep.localCenter.y,m=e.col1.x*h+e.col2.x*l,l=e.col1.y*h+e.col2.y*l,h=m;e=d.m_xf.R;var c=this.m_localAnchor2.x-d.m_sweep.localCenter.x,g=this.m_localAnchor2.y-d.m_sweep.localCenter.y,m=e.col1.x*c+e.col2.x*g,g=e.col1.y*c+e.col2.y*g,c=m;e=d.m_sweep.c.x+c;var m=d.m_sweep.c.y+g,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,
n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(f.m_sweep.c.x+h-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),f.m_sweep.c.y+l-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(e-p,m-n);e=this.m_u1.Length();m=this.m_u2.Length();e>a.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero();m>a.b2_linearSlop?this.m_u2.Multiply(1/m):this.m_u2.SetZero();0<this.m_constant-e-this.m_ratio*m?(this.m_state=v.e_inactiveLimit,this.m_impulse=0):this.m_state=v.e_atUpperLimit;
e<this.m_maxLength1?(this.m_limitState1=v.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=v.e_atUpperLimit;m<this.m_maxLength2?(this.m_limitState2=v.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=v.e_atUpperLimit;e=h*this.m_u1.y-l*this.m_u1.x;m=c*this.m_u2.y-g*this.m_u2.x;this.m_limitMass1=f.m_invMass+f.m_invI*e*e;this.m_limitMass2=d.m_invMass+d.m_invI*m*m;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=
1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;b.warmStarting?(this.m_impulse*=b.dtRatio,this.m_limitImpulse1*=b.dtRatio,this.m_limitImpulse2*=b.dtRatio,b=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,e=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,m=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,p=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,f.m_linearVelocity.x+=f.m_invMass*b,f.m_linearVelocity.y+=f.m_invMass*e,f.m_angularVelocity+=f.m_invI*
(h*e-l*b),d.m_linearVelocity.x+=d.m_invMass*m,d.m_linearVelocity.y+=d.m_invMass*p,d.m_angularVelocity+=d.m_invI*(c*p-g*m)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};C.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,d;d=a.m_xf.R;var e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,l=this.m_localAnchor1.y-a.m_sweep.localCenter.y,m=d.col1.x*e+d.col2.x*l,l=d.col1.y*e+d.col2.y*l,e=m;d=b.m_xf.R;var p=this.m_localAnchor2.x-b.m_sweep.localCenter.x,c=this.m_localAnchor2.y-
b.m_sweep.localCenter.y,m=d.col1.x*p+d.col2.x*c,c=d.col1.y*p+d.col2.y*c,p=m,g,r;this.m_state==v.e_atUpperLimit&&(d=a.m_linearVelocity.x+-a.m_angularVelocity*l,m=a.m_linearVelocity.y+a.m_angularVelocity*e,g=b.m_linearVelocity.x+-b.m_angularVelocity*c,r=b.m_linearVelocity.y+b.m_angularVelocity*p,d=-(this.m_u1.x*d+this.m_u1.y*m)-this.m_ratio*(this.m_u2.x*g+this.m_u2.y*r),r=this.m_pulleyMass*-d,d=this.m_impulse,this.m_impulse=h.Max(0,this.m_impulse+r),r=this.m_impulse-d,d=-r*this.m_u1.x,m=-r*this.m_u1.y,
g=-this.m_ratio*r*this.m_u2.x,r=-this.m_ratio*r*this.m_u2.y,a.m_linearVelocity.x+=a.m_invMass*d,a.m_linearVelocity.y+=a.m_invMass*m,a.m_angularVelocity+=a.m_invI*(e*m-l*d),b.m_linearVelocity.x+=b.m_invMass*g,b.m_linearVelocity.y+=b.m_invMass*r,b.m_angularVelocity+=b.m_invI*(p*r-c*g));this.m_limitState1==v.e_atUpperLimit&&(d=a.m_linearVelocity.x+-a.m_angularVelocity*l,m=a.m_linearVelocity.y+a.m_angularVelocity*e,d=-(this.m_u1.x*d+this.m_u1.y*m),r=-this.m_limitMass1*d,d=this.m_limitImpulse1,this.m_limitImpulse1=
h.Max(0,this.m_limitImpulse1+r),r=this.m_limitImpulse1-d,d=-r*this.m_u1.x,m=-r*this.m_u1.y,a.m_linearVelocity.x+=a.m_invMass*d,a.m_linearVelocity.y+=a.m_invMass*m,a.m_angularVelocity+=a.m_invI*(e*m-l*d));this.m_limitState2==v.e_atUpperLimit&&(g=b.m_linearVelocity.x+-b.m_angularVelocity*c,r=b.m_linearVelocity.y+b.m_angularVelocity*p,d=-(this.m_u2.x*g+this.m_u2.y*r),r=-this.m_limitMass2*d,d=this.m_limitImpulse2,this.m_limitImpulse2=h.Max(0,this.m_limitImpulse2+r),r=this.m_limitImpulse2-d,g=-r*this.m_u2.x,
r=-r*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*g,b.m_linearVelocity.y+=b.m_invMass*r,b.m_angularVelocity+=b.m_invI*(p*r-c*g))};C.prototype.SolvePositionConstraints=function(){var b=this.m_bodyA,d=this.m_bodyB,e,l=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,m=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,y=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c,g,r,n,u,w,x,z=0;this.m_state==v.e_atUpperLimit&&(e=b.m_xf.R,c=this.m_localAnchor1.x-
b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,u=e.col1.x*c+e.col2.x*g,g=e.col1.y*c+e.col2.y*g,c=u,e=d.m_xf.R,r=this.m_localAnchor2.x-d.m_sweep.localCenter.x,n=this.m_localAnchor2.y-d.m_sweep.localCenter.y,u=e.col1.x*r+e.col2.x*n,n=e.col1.y*r+e.col2.y*n,r=u,e=b.m_sweep.c.x+c,u=b.m_sweep.c.y+g,w=d.m_sweep.c.x+r,x=d.m_sweep.c.y+n,this.m_u1.Set(e-l,u-m),this.m_u2.Set(w-p,x-y),e=this.m_u1.Length(),u=this.m_u2.Length(),e>a.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero(),
u>a.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),e=this.m_constant-e-this.m_ratio*u,z=h.Max(z,-e),e=h.Clamp(e+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),x=-this.m_pulleyMass*e,e=-x*this.m_u1.x,u=-x*this.m_u1.y,w=-this.m_ratio*x*this.m_u2.x,x=-this.m_ratio*x*this.m_u2.y,b.m_sweep.c.x+=b.m_invMass*e,b.m_sweep.c.y+=b.m_invMass*u,b.m_sweep.a+=b.m_invI*(c*u-g*e),d.m_sweep.c.x+=d.m_invMass*w,d.m_sweep.c.y+=d.m_invMass*x,d.m_sweep.a+=d.m_invI*(r*x-n*w),b.SynchronizeTransform(),d.SynchronizeTransform());
this.m_limitState1==v.e_atUpperLimit&&(e=b.m_xf.R,c=this.m_localAnchor1.x-b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,u=e.col1.x*c+e.col2.x*g,g=e.col1.y*c+e.col2.y*g,c=u,e=b.m_sweep.c.x+c,u=b.m_sweep.c.y+g,this.m_u1.Set(e-l,u-m),e=this.m_u1.Length(),e>a.b2_linearSlop?(this.m_u1.x*=1/e,this.m_u1.y*=1/e):this.m_u1.SetZero(),e=this.m_maxLength1-e,z=h.Max(z,-e),e=h.Clamp(e+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),x=-this.m_limitMass1*e,e=-x*this.m_u1.x,u=-x*this.m_u1.y,
b.m_sweep.c.x+=b.m_invMass*e,b.m_sweep.c.y+=b.m_invMass*u,b.m_sweep.a+=b.m_invI*(c*u-g*e),b.SynchronizeTransform());this.m_limitState2==v.e_atUpperLimit&&(e=d.m_xf.R,r=this.m_localAnchor2.x-d.m_sweep.localCenter.x,n=this.m_localAnchor2.y-d.m_sweep.localCenter.y,u=e.col1.x*r+e.col2.x*n,n=e.col1.y*r+e.col2.y*n,r=u,w=d.m_sweep.c.x+r,x=d.m_sweep.c.y+n,this.m_u2.Set(w-p,x-y),u=this.m_u2.Length(),u>a.b2_linearSlop?(this.m_u2.x*=1/u,this.m_u2.y*=1/u):this.m_u2.SetZero(),e=this.m_maxLength2-u,z=h.Max(z,-e),
e=h.Clamp(e+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),x=-this.m_limitMass2*e,w=-x*this.m_u2.x,x=-x*this.m_u2.y,d.m_sweep.c.x+=d.m_invMass*w,d.m_sweep.c.y+=d.m_invMass*x,d.m_sweep.a+=d.m_invI*(r*x-n*w),d.SynchronizeTransform());return z<a.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(R,Box2D.Dynamics.Joints.b2JointDef);R.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;R.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.groundAnchorA=new l;this.groundAnchorB=new l;this.localAnchorA=new l;this.localAnchorB=new l};R.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};R.prototype.Initialize=function(a,b,d,e,h,l,m){void 0===m&&(m=0);this.bodyA=a;this.bodyB=
b;this.groundAnchorA.SetV(d);this.groundAnchorB.SetV(e);this.localAnchorA=this.bodyA.GetLocalPoint(h);this.localAnchorB=this.bodyB.GetLocalPoint(l);a=h.x-d.x;d=h.y-d.y;this.lengthA=Math.sqrt(a*a+d*d);d=l.x-e.x;e=l.y-e.y;this.lengthB=Math.sqrt(d*d+e*e);this.ratio=m;m=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=m-this.ratio*C.b2_minPulleyLength;this.maxLengthB=(m-C.b2_minPulleyLength)/this.ratio};Box2D.inherit(G,Box2D.Dynamics.Joints.b2Joint);G.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;
G.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new b;this.K1=new b;this.K2=new b;this.K3=new b;this.impulse3=new m;this.impulse2=new l;this.reduced=new l;this.m_localAnchor1=new l;this.m_localAnchor2=new l;this.m_impulse=new m;this.m_mass=new d};G.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};G.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};G.prototype.GetReactionForce=
function(a){void 0===a&&(a=0);return new l(a*this.m_impulse.x,a*this.m_impulse.y)};G.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.z};G.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};G.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};G.prototype.IsLimitEnabled=function(){return this.m_enableLimit};G.prototype.EnableLimit=function(a){this.m_enableLimit=
a};G.prototype.GetLowerLimit=function(){return this.m_lowerAngle};G.prototype.GetUpperLimit=function(){return this.m_upperAngle};G.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_lowerAngle=a;this.m_upperAngle=b};G.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};G.prototype.EnableMotor=function(a){this.m_enableMotor=a};G.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);
this.m_motorSpeed=a};G.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};G.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0);this.m_maxMotorTorque=a};G.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};G.prototype.b2RevoluteJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;
this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit};G.prototype.InitVelocityConstraints=function(b){var d=this.m_bodyA,e=this.m_bodyB,f,l;f=d.m_xf.R;var m=this.m_localAnchor1.x-d.m_sweep.localCenter.x,p=this.m_localAnchor1.y-d.m_sweep.localCenter.y;l=f.col1.x*m+f.col2.x*p;p=f.col1.y*m+f.col2.y*p;m=l;f=e.m_xf.R;var c=this.m_localAnchor2.x-e.m_sweep.localCenter.x,
g=this.m_localAnchor2.y-e.m_sweep.localCenter.y;l=f.col1.x*c+f.col2.x*g;g=f.col1.y*c+f.col2.y*g;c=l;f=d.m_invMass;l=e.m_invMass;var r=d.m_invI,n=e.m_invI;this.m_mass.col1.x=f+l+p*p*r+g*g*n;this.m_mass.col2.x=-p*m*r-g*c*n;this.m_mass.col3.x=-p*r-g*n;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=f+l+m*m*r+c*c*n;this.m_mass.col3.y=m*r+c*n;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=r+n;this.m_motorMass=1/(r+n);0==this.m_enableMotor&&(this.m_motorImpulse=
0);if(this.m_enableLimit){var u=e.m_sweep.a-d.m_sweep.a-this.m_referenceAngle;h.Abs(this.m_upperAngle-this.m_lowerAngle)<2*a.b2_angularSlop?this.m_limitState=v.e_equalLimits:u<=this.m_lowerAngle?(this.m_limitState!=v.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=v.e_atLowerLimit):u>=this.m_upperAngle?(this.m_limitState!=v.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=v.e_atUpperLimit):(this.m_limitState=v.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=v.e_inactiveLimit;
b.warmStarting?(this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio,b=this.m_impulse.x,u=this.m_impulse.y,d.m_linearVelocity.x-=f*b,d.m_linearVelocity.y-=f*u,d.m_angularVelocity-=r*(m*u-p*b+this.m_motorImpulse+this.m_impulse.z),e.m_linearVelocity.x+=l*b,e.m_linearVelocity.y+=l*u,e.m_angularVelocity+=n*(c*u-g*b+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};G.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,
d=this.m_bodyB,e,f,l,m,c,g=b.m_linearVelocity,p=b.m_angularVelocity,n=d.m_linearVelocity,u=d.m_angularVelocity,w=b.m_invMass,x=d.m_invMass,z=b.m_invI,B=d.m_invI;this.m_enableMotor&&this.m_limitState!=v.e_equalLimits&&(f=this.m_motorMass*-(u-p-this.m_motorSpeed),l=this.m_motorImpulse,m=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+f,-m,m),f=this.m_motorImpulse-l,p-=z*f,u+=B*f);if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){a=b.m_xf.R;f=this.m_localAnchor1.x-
b.m_sweep.localCenter.x;l=this.m_localAnchor1.y-b.m_sweep.localCenter.y;e=a.col1.x*f+a.col2.x*l;l=a.col1.y*f+a.col2.y*l;f=e;a=d.m_xf.R;m=this.m_localAnchor2.x-d.m_sweep.localCenter.x;c=this.m_localAnchor2.y-d.m_sweep.localCenter.y;e=a.col1.x*m+a.col2.x*c;c=a.col1.y*m+a.col2.y*c;m=e;a=n.x+-u*c-g.x- -p*l;var C=n.y+u*m-g.y-p*f;this.m_mass.Solve33(this.impulse3,-a,-C,-(u-p));this.m_limitState==v.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==v.e_atLowerLimit?(e=this.m_impulse.z+this.impulse3.z,
0>e&&(this.m_mass.Solve22(this.reduced,-a,-C),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==v.e_atUpperLimit&&(e=this.m_impulse.z+this.impulse3.z,0<e&&(this.m_mass.Solve22(this.reduced,-a,-C),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,
this.m_impulse.z=0));g.x-=w*this.impulse3.x;g.y-=w*this.impulse3.y;p-=z*(f*this.impulse3.y-l*this.impulse3.x+this.impulse3.z);n.x+=x*this.impulse3.x;n.y+=x*this.impulse3.y;u+=B*(m*this.impulse3.y-c*this.impulse3.x+this.impulse3.z)}else a=b.m_xf.R,f=this.m_localAnchor1.x-b.m_sweep.localCenter.x,l=this.m_localAnchor1.y-b.m_sweep.localCenter.y,e=a.col1.x*f+a.col2.x*l,l=a.col1.y*f+a.col2.y*l,f=e,a=d.m_xf.R,m=this.m_localAnchor2.x-d.m_sweep.localCenter.x,c=this.m_localAnchor2.y-d.m_sweep.localCenter.y,
e=a.col1.x*m+a.col2.x*c,c=a.col1.y*m+a.col2.y*c,m=e,this.m_mass.Solve22(this.impulse2,-(n.x+-u*c-g.x- -p*l),-(n.y+u*m-g.y-p*f)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,g.x-=w*this.impulse2.x,g.y-=w*this.impulse2.y,p-=z*(f*this.impulse2.y-l*this.impulse2.x),n.x+=x*this.impulse2.x,n.y+=x*this.impulse2.y,u+=B*(m*this.impulse2.y-c*this.impulse2.x);b.m_linearVelocity.SetV(g);b.m_angularVelocity=p;d.m_linearVelocity.SetV(n);d.m_angularVelocity=u};G.prototype.SolvePositionConstraints=
function(){var b,d,e=this.m_bodyA,l=this.m_bodyB,m=0,p,u,c;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){b=l.m_sweep.a-e.m_sweep.a-this.m_referenceAngle;var g=0;this.m_limitState==v.e_equalLimits?(b=h.Clamp(b-this.m_lowerAngle,-a.b2_maxAngularCorrection,a.b2_maxAngularCorrection),g=-this.m_motorMass*b,m=h.Abs(b)):this.m_limitState==v.e_atLowerLimit?(b-=this.m_lowerAngle,m=-b,b=h.Clamp(b+a.b2_angularSlop,-a.b2_maxAngularCorrection,0),g=-this.m_motorMass*b):this.m_limitState==v.e_atUpperLimit&&
(m=b-=this.m_upperAngle,b=h.Clamp(b-a.b2_angularSlop,0,a.b2_maxAngularCorrection),g=-this.m_motorMass*b);e.m_sweep.a-=e.m_invI*g;l.m_sweep.a+=l.m_invI*g;e.SynchronizeTransform();l.SynchronizeTransform()}d=e.m_xf.R;g=this.m_localAnchor1.x-e.m_sweep.localCenter.x;b=this.m_localAnchor1.y-e.m_sweep.localCenter.y;p=d.col1.x*g+d.col2.x*b;b=d.col1.y*g+d.col2.y*b;g=p;d=l.m_xf.R;var r=this.m_localAnchor2.x-l.m_sweep.localCenter.x,n=this.m_localAnchor2.y-l.m_sweep.localCenter.y;p=d.col1.x*r+d.col2.x*n;n=d.col1.y*
r+d.col2.y*n;r=p;u=l.m_sweep.c.x+r-e.m_sweep.c.x-g;c=l.m_sweep.c.y+n-e.m_sweep.c.y-b;var w=u*u+c*c;d=Math.sqrt(w);p=e.m_invMass;var x=l.m_invMass,z=e.m_invI,B=l.m_invI,C=10*a.b2_linearSlop;w>C*C&&(w=1/(p+x),u=w*-u,c=w*-c,e.m_sweep.c.x-=.5*p*u,e.m_sweep.c.y-=.5*p*c,l.m_sweep.c.x+=.5*x*u,l.m_sweep.c.y+=.5*x*c,u=l.m_sweep.c.x+r-e.m_sweep.c.x-g,c=l.m_sweep.c.y+n-e.m_sweep.c.y-b);this.K1.col1.x=p+x;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=p+x;this.K2.col1.x=z*b*b;this.K2.col2.x=-z*g*b;this.K2.col1.y=
-z*g*b;this.K2.col2.y=z*g*g;this.K3.col1.x=B*n*n;this.K3.col2.x=-B*r*n;this.K3.col1.y=-B*r*n;this.K3.col2.y=B*r*r;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(G.tImpulse,-u,-c);u=G.tImpulse.x;c=G.tImpulse.y;e.m_sweep.c.x-=e.m_invMass*u;e.m_sweep.c.y-=e.m_invMass*c;e.m_sweep.a-=e.m_invI*(g*c-b*u);l.m_sweep.c.x+=l.m_invMass*u;l.m_sweep.c.y+=l.m_invMass*c;l.m_sweep.a+=l.m_invI*(r*c-n*u);e.SynchronizeTransform();l.SynchronizeTransform();return d<=a.b2_linearSlop&&m<=a.b2_angularSlop};
Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new l});Box2D.inherit(I,Box2D.Dynamics.Joints.b2JointDef);I.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;I.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new l;this.localAnchorB=new l};I.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,
0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};I.prototype.Initialize=function(a,b,d){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint);S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;S.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_localAnchorA=new l;this.m_localAnchorB=new l;this.m_impulse=new m;this.m_mass=new d};S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};S.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new l(a*this.m_impulse.x,a*this.m_impulse.y)};S.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.z};S.prototype.b2WeldJoint=
function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_mass=new d};S.prototype.InitVelocityConstraints=function(a){var b,d,e=this.m_bodyA,f=this.m_bodyB;b=e.m_xf.R;var h=this.m_localAnchorA.x-e.m_sweep.localCenter.x,l=this.m_localAnchorA.y-e.m_sweep.localCenter.y;d=b.col1.x*h+b.col2.x*l;l=b.col1.y*h+b.col2.y*l;h=d;b=f.m_xf.R;var c=this.m_localAnchorB.x-f.m_sweep.localCenter.x,
g=this.m_localAnchorB.y-f.m_sweep.localCenter.y;d=b.col1.x*c+b.col2.x*g;g=b.col1.y*c+b.col2.y*g;c=d;b=e.m_invMass;d=f.m_invMass;var m=e.m_invI,n=f.m_invI;this.m_mass.col1.x=b+d+l*l*m+g*g*n;this.m_mass.col2.x=-l*h*m-g*c*n;this.m_mass.col3.x=-l*m-g*n;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+d+h*h*m+c*c*n;this.m_mass.col3.y=h*m+c*n;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+n;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=
a.dtRatio,this.m_impulse.z*=a.dtRatio,e.m_linearVelocity.x-=b*this.m_impulse.x,e.m_linearVelocity.y-=b*this.m_impulse.y,e.m_angularVelocity-=m*(h*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z),f.m_linearVelocity.x+=d*this.m_impulse.x,f.m_linearVelocity.y+=d*this.m_impulse.y,f.m_angularVelocity+=n*(c*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};S.prototype.SolveVelocityConstraints=function(){var a,b,d=this.m_bodyA,e=this.m_bodyB,h=d.m_linearVelocity,l=d.m_angularVelocity,
p=e.m_linearVelocity,c=e.m_angularVelocity,g=d.m_invMass,r=e.m_invMass,n=d.m_invI,u=e.m_invI;a=d.m_xf.R;var v=this.m_localAnchorA.x-d.m_sweep.localCenter.x,w=this.m_localAnchorA.y-d.m_sweep.localCenter.y;b=a.col1.x*v+a.col2.x*w;w=a.col1.y*v+a.col2.y*w;v=b;a=e.m_xf.R;var x=this.m_localAnchorB.x-e.m_sweep.localCenter.x,z=this.m_localAnchorB.y-e.m_sweep.localCenter.y;b=a.col1.x*x+a.col2.x*z;z=a.col1.y*x+a.col2.y*z;x=b;a=p.x-c*z-h.x+l*w;b=p.y+c*x-h.y-l*v;var B=c-l,C=new m;this.m_mass.Solve33(C,-a,-b,
-B);this.m_impulse.Add(C);h.x-=g*C.x;h.y-=g*C.y;l-=n*(v*C.y-w*C.x+C.z);p.x+=r*C.x;p.y+=r*C.y;c+=u*(x*C.y-z*C.x+C.z);d.m_angularVelocity=l;e.m_angularVelocity=c};S.prototype.SolvePositionConstraints=function(){var b,d,e=this.m_bodyA,l=this.m_bodyB;b=e.m_xf.R;var p=this.m_localAnchorA.x-e.m_sweep.localCenter.x,u=this.m_localAnchorA.y-e.m_sweep.localCenter.y;d=b.col1.x*p+b.col2.x*u;u=b.col1.y*p+b.col2.y*u;p=d;b=l.m_xf.R;var v=this.m_localAnchorB.x-l.m_sweep.localCenter.x,c=this.m_localAnchorB.y-l.m_sweep.localCenter.y;
d=b.col1.x*v+b.col2.x*c;c=b.col1.y*v+b.col2.y*c;v=d;b=e.m_invMass;d=l.m_invMass;var g=e.m_invI,r=l.m_invI,n=l.m_sweep.c.x+v-e.m_sweep.c.x-p,w=l.m_sweep.c.y+c-e.m_sweep.c.y-u,x=l.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,z=10*a.b2_linearSlop,B=Math.sqrt(n*n+w*w),C=h.Abs(x);B>z&&(g*=1,r*=1);this.m_mass.col1.x=b+d+u*u*g+c*c*r;this.m_mass.col2.x=-u*p*g-c*v*r;this.m_mass.col3.x=-u*g-c*r;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+d+p*p*g+v*v*r;this.m_mass.col3.y=p*g+v*r;this.m_mass.col1.z=
this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=g+r;z=new m;this.m_mass.Solve33(z,-n,-w,-x);e.m_sweep.c.x-=b*z.x;e.m_sweep.c.y-=b*z.y;e.m_sweep.a-=g*(p*z.y-u*z.x+z.z);l.m_sweep.c.x+=d*z.x;l.m_sweep.c.y+=d*z.y;l.m_sweep.a+=r*(v*z.y-c*z.x+z.z);e.SynchronizeTransform();l.SynchronizeTransform();return B<=a.b2_linearSlop&&C<=a.b2_angularSlop};Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef);M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;M.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new l;this.localAnchorB=new l};M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_weldJoint;this.referenceAngle=0};M.prototype.Initialize=function(a,b,d){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();
(function(){var a=Box2D.Dynamics.b2DebugDraw;a.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var a=this;this.m_sprite={graphics:{clear:function(){a.m_ctx.clearRect(0,0,a.m_ctx.canvas.width,a.m_ctx.canvas.height)}}}};a.prototype._color=function(a,d){return"rgba("+((a&16711680)>>16)+","+((a&65280)>>8)+","+(a&255)+","+d+")"};a.prototype.b2DebugDraw=function(){this.m_drawFlags=0};a.prototype.SetFlags=function(a){void 0===a&&(a=0);this.m_drawFlags=
a};a.prototype.GetFlags=function(){return this.m_drawFlags};a.prototype.AppendFlags=function(a){void 0===a&&(a=0);this.m_drawFlags|=a};a.prototype.ClearFlags=function(a){void 0===a&&(a=0);this.m_drawFlags&=~a};a.prototype.SetSprite=function(a){this.m_ctx=a};a.prototype.GetSprite=function(){return this.m_ctx};a.prototype.SetDrawScale=function(a){void 0===a&&(a=0);this.m_drawScale=a};a.prototype.GetDrawScale=function(){return this.m_drawScale};a.prototype.SetLineThickness=function(a){void 0===a&&(a=
0);this.m_lineThickness=a;this.m_ctx.strokeWidth=a};a.prototype.GetLineThickness=function(){return this.m_lineThickness};a.prototype.SetAlpha=function(a){void 0===a&&(a=0);this.m_alpha=a};a.prototype.GetAlpha=function(){return this.m_alpha};a.prototype.SetFillAlpha=function(a){void 0===a&&(a=0);this.m_fillAlpha=a};a.prototype.GetFillAlpha=function(){return this.m_fillAlpha};a.prototype.SetXFormScale=function(a){void 0===a&&(a=0);this.m_xformScale=a};a.prototype.GetXFormScale=function(){return this.m_xformScale};
a.prototype.DrawPolygon=function(a,d,h){if(d){var b=this.m_ctx,m=this.m_drawScale;b.beginPath();b.strokeStyle=this._color(h.color,this.m_alpha);b.moveTo(a[0].x*m,a[0].y*m);for(h=1;h<d;h++)b.lineTo(a[h].x*m,a[h].y*m);b.lineTo(a[0].x*m,a[0].y*m);b.closePath();b.stroke()}};a.prototype.DrawSolidPolygon=function(a,d,h){if(d){var b=this.m_ctx,m=this.m_drawScale;b.beginPath();b.strokeStyle=this._color(h.color,this.m_alpha);b.fillStyle=this._color(h.color,this.m_fillAlpha);b.moveTo(a[0].x*m,a[0].y*m);for(h=
1;h<d;h++)b.lineTo(a[h].x*m,a[h].y*m);b.lineTo(a[0].x*m,a[0].y*m);b.closePath();b.fill();b.stroke()}};a.prototype.DrawCircle=function(a,d,h){if(d){var b=this.m_ctx,m=this.m_drawScale;b.beginPath();b.strokeStyle=this._color(h.color,this.m_alpha);b.arc(a.x*m,a.y*m,d*m,0,2*Math.PI,!0);b.closePath();b.stroke()}};a.prototype.DrawSolidCircle=function(a,d,h,l){if(d){var b=this.m_ctx,w=this.m_drawScale,p=a.x*w,u=a.y*w;b.moveTo(0,0);b.beginPath();b.strokeStyle=this._color(l.color,this.m_alpha);b.fillStyle=
this._color(l.color,this.m_fillAlpha);b.arc(p,u,d*w,0,2*Math.PI,!0);b.moveTo(p,u);b.lineTo((a.x+h.x*d)*w,(a.y+h.y*d)*w);b.closePath();b.fill();b.stroke()}};a.prototype.DrawSegment=function(a,d,h){var b=this.m_ctx,m=this.m_drawScale;b.strokeStyle=this._color(h.color,this.m_alpha);b.beginPath();b.moveTo(a.x*m,a.y*m);b.lineTo(d.x*m,d.y*m);b.closePath();b.stroke()};a.prototype.DrawTransform=function(a){var b=this.m_ctx,h=this.m_drawScale;b.beginPath();b.strokeStyle=this._color(16711680,this.m_alpha);
b.moveTo(a.position.x*h,a.position.y*h);b.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*h,(a.position.y+this.m_xformScale*a.R.col1.y)*h);b.strokeStyle=this._color(65280,this.m_alpha);b.moveTo(a.position.x*h,a.position.y*h);b.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*h,(a.position.y+this.m_xformScale*a.R.col2.y)*h);b.closePath();b.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;b2Vec2=Box2D.Common.Math.b2Vec2;b2BodyDef=Box2D.Dynamics.b2BodyDef;
b2Body=Box2D.Dynamics.b2Body;b2FixtureDef=Box2D.Dynamics.b2FixtureDef;b2Fixture=Box2D.Dynamics.b2Fixture;b2World=Box2D.Dynamics.b2World;b2MassData=Box2D.Collision.Shapes.b2MassData;b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape;b2CircleShape=Box2D.Collision.Shapes.b2CircleShape;b2DebugDraw=Box2D.Dynamics.b2DebugDraw;b2Listener=Box2D.Dynamics.b2ContactListener;
var PhysicsEngine=function(){this.bodies=[];this.destroyList=[];this.fixtures=[];this.world=new b2World(new b2Vec2(0,0),!1);var a=new b2Listener;a.BeginContact=function(a){var b=a.GetFixtureA().GetBody().GetUserData(),h=a.GetFixtureB().GetBody().GetUserData(),l=b.getComponent(Script),m=h.getComponent(Script);if(null!==l)l.onEnterCollision(h,a);if(null!==m)m.onEnterCollision(b,a)};a.EndContact=function(a){var b=a.GetFixtureA().GetBody().GetUserData(),h=a.GetFixtureB().GetBody().GetUserData(),l=b.getComponent(Script),
m=h.getComponent(Script);if(null!==l)l.onExitCollision(h,a);if(null!==m)m.onExitCollision(b,a)};this.world.SetContactListener(a)};PhysicsEngine.prototype.setGravity=function(a){this.world.SetGravity(new b2Vec2(a.x,a.y))};PhysicsEngine.prototype.getBox2dWorld=function(){return this.world};PhysicsEngine.prototype.addBodies=function(a){for(var b=0;b<a.length;b++)this.addBody(a[b])};PhysicsEngine.prototype.addBody=function(a){this.bodies.push(a);a.adapt(this.world)};
PhysicsEngine.prototype.clear=function(){this.bodies=[];for(var a=0;a<this.bodies.length;a++)this.world.DestroyBody(this.bodies[a].getBox2dBody())};
PhysicsEngine.prototype.update=function(a){this.world.Step(a,6,4);for(a=0;a<this.bodies.length;a++){var b=this.bodies[a];if(b.isStatic()||!b.isEnabled()||b.isDestroyed())b.isDestroyed()&&this.destroyList.push(b);else{b.getBox2dBody().GetLinearVelocity();var d=b.getBox2dBody().GetPosition().x,h=b.getBox2dBody().GetPosition().y,l=b.getBox2dBody().GetAngle();b.gameObject.getTransform().setPosition(new Vector2(d,h));b.gameObject.getTransform().setRotation(new Vector3(0,0,l))}}for(a=0;a<this.destroyList.length;a++)b=
this.destroyList[a],this.world.DestroyBody(b.getBox2dBody());this.world.ClearForces();this.destroyList=[]};var RigidBody=function(a,b,d){Component.call(this);this.fixDef=new b2FixtureDef;this.fixDef.density=a;this.fixDef.friction=b;this.fixDef.restitution=d;this.bodyDef=new b2BodyDef;this.bodyDef.type=b2Body.b2_dynamicBody;this.world=this.body=this.fixture=null};RigidBody.prototype=new Component;RigidBody.prototype.constructor=RigidBody;
RigidBody.prototype.adapt=function(a){this.world=a;this.gameObject.getComponent(Collider).adapt(this.fixDef);this.isStatic()?this.bodyDef.type=b2Body.b2_staticBody:this.bodyDef.type=b2Body.b2_dynamicBody;this.bodyDef.fixedRotation=this.isStatic();a=this.gameObject.getTransform();this.bodyDef.position.x=a.position.x;this.bodyDef.position.y=a.position.y;this.bodyDef.angle=a.rotation.z;this.body=this.world.CreateBody(this.bodyDef);this.body.SetUserData(this.gameObject);this.fixture=this.body.CreateFixture(this.fixDef)};
RigidBody.prototype.getBox2dBody=function(){return this.body};RigidBody.prototype.getCollider=function(){return this.gameObject.getComponent(Collider)};RigidBody.prototype.isStatic=function(){return this.gameObject.isStatic()};var Collider=function(a){Component.call(this);this.sensor=a};Collider.prototype=new Component;Collider.prototype.constructor=Collider;Collider.prototype.isSensor=function(){return this.sensor};Collider.prototype.adapt=function(a){a.isSensor=this.isSensor()};
var AABBCollider=function(a,b,d){Collider.call(this,d);this.width=a;this.height=b};AABBCollider.prototype=new Collider;AABBCollider.prototype.constructor=AABBCollider;AABBCollider.prototype.adapt=function(a){Collider.prototype.adapt.call(this,a);a.shape=new b2PolygonShape;a.shape.SetAsBox(this.width/2,this.height/2)};var CircleCollider=function(a,b){Collider.call(this,b);this.radius=a};CircleCollider.prototype=new Collider;CircleCollider.prototype.constructor=CircleCollider;
CircleCollider.prototype.adapt=function(a){Collider.prototype.adapt.call(this,a);a.shape=new b2CircleShape;a.shape.SetRadius(this.radius)};var Scene=function(a){this.name=a;this.root=new GameObject;this.renderContext=this.camera=null;this.newsRoot=new GameObject;this.loaded=this.newObjects=!1;this.trash=[]};Scene.prototype.getName=function(){return this.name};Scene.prototype.setLoaded=function(a){this.loaded=a};Scene.prototype.isLoaded=function(){return this.loaded};Scene.prototype.getRoot=function(){return this.root};
Scene.prototype.getNewsRoot=function(){return this.newsRoot};Scene.prototype.flush=function(){this.root.setChildren(this.root.getChildren().concat(this.newsRoot.getChildren()));this.newsRoot.setChildren([]);this.newObjects=!1};Scene.prototype.hasNewObjects=function(){return this.newObjects};Scene.prototype.addObject=function(a){this.newObjects=!0;a.setScene(this);a.getTransform().initMatrix();this.newsRoot.addChild(a)};Scene.prototype.deleteObject=function(a){this.trash.push(a)};
Scene.prototype.cleanTrash=function(){for(var a=0;a<this.trash.length;a++){var b=this.trash[a].getComponent(Script);if(null!==b)b.onDestroy()}this.trash=[]};Scene.prototype.getRenderContext=function(){return this.renderContext};Scene.prototype.setRenderContext=function(a){this.renderContext=a};Scene.prototype.getCamera=function(){return this.camera};Scene.prototype.setCamera=function(a){this.camera=a};
var Transform=function(){Component.call(this);this.position=new Vector3(0,0,0);this.rotation=new Vector3(0,0,0);this.scale=new Vector3(1,1,1);this.right=new Vector3(1,0,0);this.up=new Vector3(0,1,0);this.forward=new Vector3(0,0,1);this.matrix=Matrix4.identity();this.translationMatrix=Matrix4.identity();this.rotationMatrix=Matrix4.identity();this.scaleMatrix=Matrix4.identity();this.target=this.forward.cpy();this.dirty=!0};Transform.prototype=new Component;Transform.prototype.constructor=Transform;
Transform.prototype.isStatic=function(){return this.gameObject.isStatic()};Transform.prototype.isDirty=function(){return this.dirty};
Transform.prototype.generateLocalSpaceMatrix=function(){this.rotationMatrix=Matrix4.identity();this.scaleMatrix=Matrix4.scale(this.scale);this.translationMatrix=Matrix4.translation(this.position);0!==this.rotation.x&&(this.rotationMatrix=Matrix4.mulMM(this.rotationMatrix,Matrix4.rotation(new Vector3(this.rotation.x,0,0))));0!==this.rotation.y&&(this.rotationMatrix=Matrix4.mulMM(this.rotationMatrix,Matrix4.rotation(new Vector3(0,this.rotation.y,0))));0!==this.rotation.z&&(this.rotationMatrix=Matrix4.mulMM(this.rotationMatrix,
Matrix4.rotation(new Vector3(0,0,this.rotation.z))));this.matrix=Matrix4.mulMM(Matrix4.mulMM(this.scaleMatrix,this.translationMatrix),this.rotationMatrix)};Transform.prototype.initMatrix=function(){this.generateLocalSpaceMatrix();var a=this.getParent();null!==a&&(this.matrix=Matrix4.mulMM(this.matrix,a.getMatrix()));for(var a=this.getChildren(),a=$jscomp.makeIterator(a),b=a.next();!b.done;b=a.next())b.value.initMatrix()};Transform.prototype.getMatrix=function(){return this.matrix};
Transform.prototype.generateMatrix=function(){if(!this.isStatic()){var a=this.getParent();null!==a&&a.isDirty()?(this.generateLocalSpaceMatrix(),this.matrix=Matrix4.mulMM(a.getMatrix(),this.matrix)):this.dirty&&this.generateLocalSpaceMatrix()}for(var a=$jscomp.makeIterator(this.getChildren()),b=a.next();!b.done;b=a.next())b.value.generateMatrix();this.dirty=!1;DebugRenderer.setTransformationMatrix(this.matrix);DebugRenderer.drawLine(new Vector3(0,0,0),new Vector3(1,0,0),Color.BLUE);DebugRenderer.drawLine(new Vector3(0,
0,0),new Vector3(0,1,0),Color.RED);DebugRenderer.setTransformationMatrix(null)};Transform.prototype.setMatrix=function(a){this.matrix=a;this.dirty=!0};Transform.prototype.setPosition=function(a){this.position.equals(a)||(this.dirty=!0,this.position.set(a))};Transform.prototype.setRotation=function(a){this.rotation.equals(a)||(this.dirty=!0,this.rotation.set(a))};Transform.prototype.setScale=function(a){this.scale.equals(a)||(this.dirty=!0,this.scale.set(a))};
Transform.prototype.getPosition=function(){var a=this.getParent();return null!==a?(this.position.w=1,Matrix4.mulMV(Matrix4.mulMM(this.translationMatrix,Matrix4.mulMM(a.translationMatrix,a.rotationMatrix)),this.position)):this.position};Transform.prototype.getRotation=function(){return this.rotation};Transform.prototype.getScale=function(){return this.scale};Transform.prototype.translate=function(a){0<a.len()&&this.setPosition(this.position.cpy().add(a))};
Transform.prototype.rotate=function(a){0<a.len()&&(this.rotation.add(a),this.dirty=!0)};var MeshRenderer=function(){Component.call(this);this.material=this.mesh=null;this.regionPosition=new Vector2(0,0);this.regionHeight=this.regionWidth=1;this.alphaColor=new Color(-1,-1,-1,-1);this.layer=0};MeshRenderer.prototype=new Component;MeshRenderer.prototype.constructor=MeshRenderer;MeshRenderer.prototype.getLayer=function(){return this.layer};
MeshRenderer.prototype.setLayer=function(a){this.layer=0>a?0:a};MeshRenderer.prototype.getMesh=function(){return this.mesh};MeshRenderer.prototype.setMesh=function(a){this.mesh=a};MeshRenderer.prototype.getMaterial=function(){return this.material};MeshRenderer.prototype.setMaterial=function(a){this.material=a};MeshRenderer.prototype.getRadius=function(){var a=this.gameObject.getTransform().getScale(),b=this.mesh.getMax(),d=b.x*a.x,h=b.y*a.y,a=b.z*a.z;return Math.sqrt(d*d+h*h+a*a)/2};
MeshRenderer.prototype.getAlphaColor=function(){return this.alphaColor};MeshRenderer.prototype.setAlphaColor=function(a){this.alphaColor=a};MeshRenderer.prototype.setRegion=function(a,b,d){this.regionPosition=a;this.regionWidth=b;this.regionHeight=d};MeshRenderer.prototype.getRegionPosition=function(){return this.regionPosition};MeshRenderer.prototype.getRegionWidth=function(){return this.regionWidth};MeshRenderer.prototype.getRegionHeight=function(){return this.regionHeight};
MeshRenderer.prototype.updateMaterial=function(a){if(null!==a.getTexture()&&(a=a.getShader(),a.addFloatVector(this.alphaColor.toArray(),"alphacolor"),a.addFloat(this.getRegionPosition().x,"regionX"),a.addFloat(this.getRegionPosition().y,"regionY"),a.addFloat(this.getRegionWidth(),"regionWidth"),a.addFloat(this.getRegionHeight(),"regionHeight"),null!==this.animation)){var b=this.animation.getNextFrame();a.addFloat(b.getPosition().x,"animationX");a.addFloat(b.getPosition().y,"animationY");a.addFloat(b.getWidth(),
"animationWidth");a.addFloat(b.getHeight(),"animationHeight")}};var LineRenderer=function(a,b,d,h,l){this.shader=a;this.color=h;this.modelMatrix=l;this.start=b.cpy();this.end=d.cpy();this.start.w=1;this.end.w=1;this.vertices=this.start.toArray().concat(this.end.toArray());this.colors=this.color.toArray().concat(this.color.toArray());this.elem=[0,1];this.vao=this.vboElemIndices=this.vboColor=this.vboPosition=0};
LineRenderer.prototype.bind=function(){this.vao=vao_ext.createVertexArrayOES();vao_ext.bindVertexArrayOES(this.vao);gl.enableVertexAttribArray(0);this.vboPosition=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vboPosition);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.vertices),gl.STATIC_DRAW);gl.vertexAttribPointer(0,4,gl.FLOAT,!1,0,0);gl.enableVertexAttribArray(1);this.vboColor=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vboColor);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(this.colors),
gl.STATIC_DRAW);gl.vertexAttribPointer(1,4,gl.FLOAT,!1,0,0);this.vboElemIndices=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.vboElemIndices);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.elem),gl.STATIC_DRAW);vao_ext.bindVertexArrayOES(null)};
LineRenderer.prototype.render=function(){this.shader.enable();this.shader.addMatrix(this.modelMatrix,"modelMatrix");vao_ext.bindVertexArrayOES(this.vao);gl.enableVertexAttribArray(0);gl.enableVertexAttribArray(1);gl.drawElements(gl.LINES,2,gl.UNSIGNED_SHORT,0);this.shader.disable();gl.disableVertexAttribArray(0);gl.disableVertexAttribArray(1)};var SpriteRenderer=function(){MeshRenderer.call(this);this.setMesh(new RectangleMesh);this.animations=[];this.animation=null};SpriteRenderer.prototype=new MeshRenderer;
SpriteRenderer.prototype.constructor=SpriteRenderer;SpriteRenderer.prototype.setAnimation=function(a){this.animation=this.animations[a]};SpriteRenderer.prototype.addAnimation=function(a,b){this.animations[a]=b};var Frustum=function(a){this.camera=a;this.planes=Array(6);for(a=0;a<this.planes.length;a++)this.planes[a]=new Vector3(0,0,0);this.VPmatrix=Matrix4.identity()};
Frustum.prototype.testSphere=function(a,b){for(var d=0;d<this.planes.length;d++)if(this.planes[d].x*a.x+this.planes[d].y*a.y+this.planes[d].z*a.z+this.planes[d].w<=-b)return!1;return!0};
Frustum.prototype.build=function(){if(this.camera.getGameObject().getTransform().isDirty()){this.VPmatrix=Matrix4.mulMM(this.camera.getViewMatrix().transpose(),this.camera.getProjectionMatrix().transpose());this.VPmatrix=this.VPmatrix.transpose();var a=Array(6);this.planes[0].x=this.VPmatrix.get(0,0)+this.VPmatrix.get(3,0);this.planes[0].y=this.VPmatrix.get(0,1)+this.VPmatrix.get(3,1);this.planes[0].z=this.VPmatrix.get(0,2)+this.VPmatrix.get(3,2);a[0]=this.VPmatrix.get(0,3)+this.VPmatrix.get(3,3);
this.planes[1].x=-this.VPmatrix.get(0,0)+this.VPmatrix.get(3,0);this.planes[1].y=-this.VPmatrix.get(0,1)+this.VPmatrix.get(3,1);this.planes[1].z=-this.VPmatrix.get(0,2)+this.VPmatrix.get(3,2);a[1]=-this.VPmatrix.get(0,3)+this.VPmatrix.get(3,3);this.planes[2].x=this.VPmatrix.get(1,0)+this.VPmatrix.get(3,0);this.planes[2].y=this.VPmatrix.get(1,1)+this.VPmatrix.get(3,1);this.planes[2].z=this.VPmatrix.get(1,2)+this.VPmatrix.get(3,2);a[2]=this.VPmatrix.get(1,3)+this.VPmatrix.get(3,3);this.planes[3].x=
-this.VPmatrix.get(1,0)+this.VPmatrix.get(3,0);this.planes[3].y=-this.VPmatrix.get(1,1)+this.VPmatrix.get(3,1);this.planes[3].z=-this.VPmatrix.get(1,2)+this.VPmatrix.get(3,2);a[3]=-this.VPmatrix.get(1,3)+this.VPmatrix.get(3,3);this.planes[4].x=this.VPmatrix.get(2,0)+this.VPmatrix.get(3,0);this.planes[4].y=this.VPmatrix.get(2,1)+this.VPmatrix.get(3,1);this.planes[4].z=this.VPmatrix.get(2,2)+this.VPmatrix.get(3,2);a[4]=this.VPmatrix.get(2,3)+this.VPmatrix.get(3,3);this.planes[5].x=-this.VPmatrix.get(2,
0)+this.VPmatrix.get(3,0);this.planes[5].y=-this.VPmatrix.get(2,1)+this.VPmatrix.get(3,1);this.planes[5].z=-this.VPmatrix.get(2,2)+this.VPmatrix.get(3,2);a[5]=-this.VPmatrix.get(2,3)+this.VPmatrix.get(3,3);for(var b=0;b<this.planes.length;b++)0<this.planes[b].len()&&(a[b]/=this.planes[b].len(),this.planes[b]=this.planes[b].nor(),this.planes[b].w=a[b])}};var Camera=function(a){Component.call(this);this.target=null;this.projectionMatrix=a;this.frustum=new Frustum(this);this.viewMatrix=Matrix4.identity()};
Camera.prototype=new Component;Camera.prototype.constructor=Camera;Camera.prototype.getFrustum=function(){return this.frustum};Camera.prototype.setProjection=function(a){this.projectionMatrix=a};Camera.prototype.getProjectionMatrix=function(){return this.projectionMatrix};
Camera.prototype.getViewMatrix=function(){var a=this.gameObject.getTransform();if(a.isDirty()){var b=new Matrix4(a.right,a.up,a.forward,new Vector4(0,0,0,1)),a=Matrix4.translation(a.getPosition().cpy().mulScl(-1));this.viewMatrix=Matrix4.mulMM(a,b)}return this.viewMatrix};var OrthoCamera=function(a,b,d,h,l,m){Camera.call(this,Matrix4.ortho(a,b,d,h,l,m));this.left=a;this.right=b;this.bottom=d;this.top=h;this.near=l;this.far=m};OrthoCamera.prototype=new Camera;OrthoCamera.prototype.constructor=OrthoCamera;
var PerspectiveCamera=function(a,b,d,h){Camera.call(this,Matrix4.perspective(a,b,d,h));this.near=a;this.far=b;this.aspect=d;this.fov=h};PerspectiveCamera.prototype=new Camera;PerspectiveCamera.prototype.constructor=PerspectiveCamera;var Time=function(){};Time.lastTime=0;Time.delta=0;Time.deltaInSeconds=0;Time.lastTimeInSeconds=0;Time.init=function(){Time.lastTime=Date.now()};
Time.tick=function(){var a=Date.now();Time.delta=a-Time.lastTime;Time.deltaInSeconds=Time.delta/1E3;Time.lastTime=a;Time.lastTimeInSeconds=Time.lastTime/1E3};Time.now=function(){return Time.lastTimeInSeconds};Time.deltaTime=function(){return Time.deltaInSeconds};var Engine=function(){this.fps=30;this.currentScene=this.scriptEngine=this.physicsEngine=this.renderEngine=null;this.scenes={};this.input=new Input;this.loaded=!1;this.physicsEnabled=!0};Engine.prototype.getCurrentScene=function(){return this.currentScene};
Engine.prototype.addScene=function(a){this.scenes[a.getName()]=a};Engine.prototype.setCurrentScene=function(a){null!==this.currentScene&&this.currentScene.setLoaded(!1);this.currentScene=this.scenes[a]};Engine.prototype.getScenes=function(){return this.scenes};Engine.prototype.setClearColor=function(a){this.renderEngine.setClearColor(a)};Engine.prototype.enablePhysics=function(){this.physicsEnabled=!0};Engine.prototype.setGravity=function(a){this.physicsEngine.setGravity(a)};
Engine.prototype.disablePhysics=function(){this.physicsEnabled=!1};Engine.prototype.setFPS=function(a){this.fps=a};Engine.prototype.init=function(){this.renderEngine=new RenderEngine;this.physicsEngine=new PhysicsEngine;this.scriptEngine=new ScriptEngine};
Engine.prototype.updateScene=function(){var a=this.currentScene.getNewsRoot(),b=a.getComponentsInChildren(MeshRenderer),d=a.getComponentsInChildren(RigidBody),a=a.getComponentsInChildren(Script);this.currentScene.setLoaded(!0);this.currentScene.flush();this.renderEngine.addRenderers(b);this.renderEngine.setRenderContext(this.currentScene.getRenderContext());this.physicsEngine.addBodies(d);this.scriptEngine.addScripts(a)};
Engine.prototype.loadScene=function(){this.renderEngine.clear();this.physicsEngine.clear();this.scriptEngine.clear();this.updateScene()};
Engine.prototype.run=function(){window.requestAnimFrame=function(){return function(a){window.setTimeout(a,1/this.fps*1E3)}}();var a=this.renderEngine,b=this.physicsEngine,d=this.scriptEngine,h=this.currentScene,l=this,m=function(){Time.tick();gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);h.isLoaded()||l.loadScene();h.hasNewObjects()&&l.updateScene();Loader.isDone()&&(l.loaded=!0,a.bind(),Loader.reset());if(l.loaded){for(var w=l.fps-Time.deltaTime()*l.fps*l.fps,w=Math.floor(Math.min(w,5));0<w;)d.update(),
l.physicsEnabled&&b.update(1/l.fps/w),w--;a.update();a.render();h.cleanTrash()}window.requestAnimFrame(m)};Time.init();window.requestAnimFrame(m)};var Loader=function(){};Loader.images={};Loader.textures={};Loader.materials={};Loader.requests=0;Loader.loaded=0;Loader.done=!1;Loader.hasImageRequests=!1;Loader.isDone=function(){return Loader.hasImageRequests?Loader.done:!0};Loader.reset=function(){Loader.done=!1};
Loader.loadImageFile=function(a){Loader.hasImageRequests=!0;if(!(a in Loader.images)){Loader.requests++;var b=new Image;Loader.images[a]=b;b.src=a;b.onload=function(){Loader.loaded++;Loader.done=Loader.requests==Loader.loaded?!0:!1}}return Loader.images[a]};Loader.loadTexture=function(a){if(!(a in Loader.textures)){var b=Loader.loadImageFile(a),b=new Texture(a,b);Loader.textures[a]=b}return Loader.textures[a]};
var Input=function(){document.addEventListener("keydown",function(a){for(var b=!1,h=0;h<Input.stack.length&&!b;h++)Input.stack[h]===a.keyCode&&(b=!0);b||Input.stack.push(a.keyCode)},!1);document.addEventListener("keyup",function(a){for(var b=[],h=0;h<Input.stack.length;h++)Input.stack[h]!==a.keyCode&&b.push();Input.stack=b},!1);var a=document.getElementById("glcanvas");a.addEventListener("mousedown",function(a){Input.button=a.button},!1);a.addEventListener("mouseup",function(a){Input.button=-1},!1);
a.addEventListener("mousemove",function(a){var b=document.getElementById("glcanvas");Input.cursorPos.x=a.clientX;Input.cursorPos.y=-1*a.clientY;Input.cursorPos.x-=b.width/2;Input.cursorPos.y+=b.height/2},!1);a.addEventListener("contextmenu",function(a){a.preventDefault();return!1},!1)};Input.key=-1;Input.stack=[];Input.button=-1;Input.cursorPos=new Vector2(0,0);Input.getKey=function(){return Input.key};
Input.isKeyPressed=function(a){for(var b=!1,d=0;d<Input.stack.length&&!b;d++)a===Input.stack[d]&&(b=!0);return b};Input.getButton=function(){return Input.button};Input.getCursorPosition=function(){return Input.cursorPos};var Script=function(){Component.call(this)};Script.prototype=new Component;Script.prototype.constructor=Script;Script.prototype.start=function(){throw Error("Abstract method!");};Script.prototype.update=function(){for(var a=this.getChildren(),b=0;b<a.length;b++)a[b].update()};
Script.prototype.onEnterCollision=function(a,b){throw Error("Abstract method!");};Script.prototype.onExitCollision=function(a,b){throw Error("Abstract method!");};Script.prototype.onDestroy=function(){throw Error("Abstract method!");};var ScriptEngine=function(){this.scripts=[]};ScriptEngine.prototype.getScripts=function(){return this.scripts};ScriptEngine.prototype.addScripts=function(a){for(var b=0;b<a.length;b++)a[b].start(),this.scripts.push(a[b])};
ScriptEngine.prototype.clear=function(){this.scripts=[]};ScriptEngine.prototype.update=function(){for(var a=$jscomp.makeIterator(this.scripts),b=a.next();!b.done;b=a.next())script=b.value,!script.isDestroyed()&&script.isEnabled()&&script.update()};var Random=function(a){this.seed=a};Random.prototype.seededRandom=function(a,b){this.seed=(9301*this.seed+49297)%233280;return this.seed/233280};
var PerlinNoise=function(a,b){this.random=new Random(b);this.n=a;this.gradients=Array(this.n);for(var d=0;d<this.n;d++){this.gradients[d]=new Vector2(0,0);this.gradients[d].x=2*this.random.seededRandom()-1;this.gradients[d].y=2*this.random.seededRandom()-1;var h=Math.sqrt(this.gradients[d].x*this.gradients[d].x+this.gradients[d].y*this.gradients[d].y);this.gradients[d].x/=h;this.gradients[d].y/=h}this.permutation=Array(this.n);for(d=0;d<this.n;d++)this.permutation.push(d);for(var d=this.permutation,
h=this.random,l=d.length,m,w;0!==l;)w=Math.floor(h.seededRandom()*l),--l,m=d[l],d[l]=d[w],d[w]=m;this.permutation=d};PerlinNoise.prototype.getGradient=function(a){var b=a.y&this.n-1,b=a.x+this.permutation[b]&this.n-1;return this.gradients[b]};PerlinNoise.prototype.lerp=function(a,b,d){return(1-d)*a+d*b};PerlinNoise.prototype.dotGridGradient=function(a,b,d,h){d=new Vector2(d-a,h-b);return this.getGradient(new Vector2(a,b)).dot(d)};
PerlinNoise.prototype.generate=function(a,b){a+=this.random.seededRandom();b+=this.random.seededRandom();var d=Math.floor(a),h=Math.floor(b),l=0<d?d:d-1,m=l+1,w=0<h?h:h-1,p=w+1,d=d-l,h=h-w,u,J;u=this.dotGridGradient(l,w,a,b);J=this.dotGridGradient(m,w,a,b);w=this.lerp(u,J,d);u=this.dotGridGradient(l,p,a,b);J=this.dotGridGradient(m,p,a,b);l=this.lerp(u,J,d);return this.lerp(w,l,h)};var GameObjectBuilder=function(){this.tmpObj=null};
GameObjectBuilder.empty=function(){var a=new GameObject,b=new Transform;a.addComponent(b);return a};GameObjectBuilder.prototype.begin=function(){this.tmpObj=GameObjectBuilder.empty();return this};GameObjectBuilder.prototype.setName=function(a){this.tmpObj.setName(a);return this};GameObjectBuilder.prototype.setStatic=function(a){this.tmpObj.setStatic(a);return this};GameObjectBuilder.prototype.setTransform=function(a){obj.addComponent(a);return this};
GameObjectBuilder.prototype.setPosition=function(a){this.tmpObj.getTransform().setPosition(a);return this};GameObjectBuilder.prototype.setRotation=function(a){this.tmpObj.getTransform().setRotation(a);return this};GameObjectBuilder.prototype.setScale=function(a){this.tmpObj.getTransform().setScale(a);return this};GameObjectBuilder.prototype.setRigidBody=function(a,b,d){a=new RigidBody(a,b,d);this.tmpObj.addComponent(a);return this};
GameObjectBuilder.prototype.setCollider=function(a){this.tmpObj.addComponent(a);return this};GameObjectBuilder.prototype.setRenderer=function(a){this.tmpObj.addComponent(a);return this};GameObjectBuilder.prototype.setMesh=function(a){this.tmpObj.getComponent(MeshRenderer).setMesh(a);return this};GameObjectBuilder.prototype.setLayer=function(a){this.tmpObj.getComponent(MeshRenderer).setLayer(a);return this};
GameObjectBuilder.prototype.setMaterial=function(a){this.tmpObj.getComponent(MeshRenderer).setMaterial(a);return this};GameObjectBuilder.prototype.setColor=function(a){this.tmpObj.getComponent(MeshRenderer).getMaterial().setColor(a);return this};GameObjectBuilder.prototype.setAlphaColor=function(a){this.tmpObj.getComponent(MeshRenderer).setAlphaColor(a);return this};GameObjectBuilder.prototype.setTextureRegion=function(a,b,d){this.tmpObj.getComponent(MeshRenderer).setRegion(a,b,d);return this};
GameObjectBuilder.prototype.addAnimation=function(a,b,d,h,l,m,w,p){b=Animation.create(b,d,h,l,m,w,p);this.tmpObj.getComponent(MeshRenderer).addAnimation(a,b);return this};GameObjectBuilder.prototype.setAnimation=function(a){this.tmpObj.getComponent(MeshRenderer).setAnimation(a);return this};GameObjectBuilder.prototype.addScript=function(a){this.tmpObj.addComponent(a);return this};GameObjectBuilder.prototype.end=function(){return this.tmpObj};var SpriteBuilder=function(){GameObjectBuilder.call(this)};
SpriteBuilder.prototype=new GameObjectBuilder;SpriteBuilder.prototype.constructor=SpriteBuilder;SpriteBuilder.prototype.begin=function(a){GameObjectBuilder.prototype.begin.call(this);this.setRenderer(new SpriteRenderer);var b=new Material;null!==a&&""!==a&&b.setTexture(Loader.loadTexture(a));this.setMaterial(b);return this};SpriteBuilder.prototype.setSize=function(a){this.setScale(new Vector2(a,a));return this};var CameraBuilder=function(){GameObjectBuilder.call(this)};CameraBuilder.prototype=new GameObjectBuilder;
CameraBuilder.prototype.constructor=CameraBuilder;CameraBuilder.prototype.setOrtho=function(a,b,d,h){this.cam=new OrthoCamera(-a,a,-b,b,d,h);this.tmpObj.addComponent(this.cam);return this};CameraBuilder.prototype.setPerspective=function(a,b,d,h){this.cam=new PerspectiveCamera(a,b,d,h);this.tmpObj.addComponent(this.cam);return this};var Thief=function(){};Thief.engine=null;Thief.currentScene=null;Thief.init=function(){Thief.engine=new Engine;Thief.engine.init()};
Thief.empty=function(){var a=new GameObject,b=new Transform;a.addComponent(b);return a};Thief.setClearColor=function(a){Thief.engine.setClearColor(a)};Thief.setGravity=function(a){Thief.engine.setGravity(a)};Thief.enablePhysics=function(){Thief.engine.enablePhysics()};Thief.disablePhysics=function(){Thief.engine.disablePhysics()};Thief.run=function(){Thief.engine.run()};Thief.createScene=function(a){Thief.currentScene=new Scene(a);Thief.engine.addScene(this.currentScene)};Thief.setScene=function(a){Thief.engine.setCurrentScene(a)};
Thief.getScene=function(){return Thief.engine.getCurrentScene()};Thief.createAndSetScene=function(a){Thief.createScene(a);Thief.setScene(a)};Thief.setCamera=function(a){var b=new RenderContext;b.setCamera(a.getComponent(Camera));Thief.getScene().setRenderContext(b)};Thief.addGameObjectToScene=function(a){Thief.currentScene.addObject(a)};
